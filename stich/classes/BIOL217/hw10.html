<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>hw10.utf8</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<!DOCTYPE html>
<head>
<!-- Favicon for various operating systems -->
<link rel="apple-touch-icon" sizes="180x180" href="./favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="./favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="./favicon/favicon-16x16.png">
<!-- <link rel="manifest" href="./favicon/site.webmanifest"> -->
<link rel="mask-icon" href="./favicon/safari-pinned-tab.svg" color="#603cba">
<link rel="shortcut icon" href="./favicon/favicon.ico">
<meta name="msapplication-TileColor" content="#603cba">
<meta name="msapplication-config" content="./favicon/browserconfig.xml">
<meta name="theme-color" content="#382121">
</head>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">BIOL 217</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="software.html">Getting started</a>
</li>
<li>
  <a href="content.html">Course content</a>
</li>
<li>
  <a href="survival.html">Survival guide</a>
</li>
<li>
  <a href="resources.html">Additional resources</a>
</li>
<li>
  <a href="contact.html">Contact</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://danstich.github.io/worst-r/">worst-r</a>
</li>
<li>
  <a href="https://github.com/danStich">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<style>
pre code, pre, code {
  white-space: pre !important;
  overflow-x: scroll !important;
  word-break: keep-all !important;
  word-wrap: initial !important;
}

.column {
    float: left;
    padding: 15px;
}

.clearfix::after {
    content: "";
    clear: both;
    display: table;
}

.content {
    width: 75%;
}

</style>
<div id="generalized-linear-mixed-models" class="section level1">
<h1>Generalized linear mixed models</h1>
<p><img src="../../images/matrixSmolt.jpg" alt=""></p>
<h2 id="multi">
Introduction
</h2>
<p>This week we extended the analytical framework that we have been working with to include both fixed and random effects. We have discussed why we might want to use it and how to interpret the results of these tools. The purpose of this lab is to get you comfortable using GLMM with real data.</p>
<p>By the end of this lab, you should 1) understand why we use mixed effects models, 2) be comfortable specifying general linear mixed models in R and applying the tool to analyze data from start to finish, and 3) be able to diagnose and interpret the results of these models.</p>
<div id="exercises" class="section level2">
<h2>Exercises</h2>
<div id="linear-mixed-models-lmm--a-special-case-of-glmm" class="section level3">
<h3>Linear mixed models (LMM- a special case of GLMM)</h3>
<p>We have looked at the GLMM initially this week because of it’s utility for handling the combination of fixed and random effects for the types of data that we commonly encounter in biology and ecology. But, as a special case of the GLMM, we could look at using a Gaussian (normal) error distribution or any suite of transformed distributions for our models, too! The advantage of doing this is that the models tend to be fit a little more easily (i.e. reliably) under the arguably unstable engines and ever-changing optimization algorithms for this model class. This special case of the GLMM goes by a variety of names depending on uses. For example, we might refer to them as ‘repeated measures’ ANOVA, ‘nested’ or ‘factorial’ ANOVA, or ‘linear mixed models’ (LMM).</p>
<p>Let’s take a look at a new data set for this example. Read in the data file called <code>est.mvmt.txt</code>, either from the course website or from your working directory.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Read in the data</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>  est.mvmt =<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;est.mvmt.txt&#39;</span>)</span></code></pre></div>
<p>These data are from endangered Atlantic salmon <em>Salmo salar</em> smolts. The response in the data is <code>Rate</code> and is a measure of the movement rate of individual fish (in body lengths per second). Federal fisheries managers were interested in how this movement rate was affected by seasonal changes in environmental factors, but also characteristics of the individual fish (as rearing history [hatchery or wild], length and mass, gill NKA activity) and factors related to the conservation hatchery practices (many of these same characteristics, but also release date and release site in the river[distance from ocean]).</p>
<p>A brief description of the data follows:</p>
<pre><code>  TagID: individual fish ID
  FL: forklength of fish
  Mass: mass of individual fish
  ATP: gill Na+,K+-ATPase activity
  RelSite: release site
  RelDate: release date (ordinal)
  Org: rearing history (hatchery or wild)
  Year: year of the study
  SW: indicator for salt water for each relocation
  RelKM: river kilometer of release site
  Dams: the number of dams passed by individual fish
  RKM_Loc: river kilometer of detections following release
  Rate: movement rate of individual fish in various reaches
  MovDate: the date on which movement occurred
  k: fish condition (a measure of rotundity or plumpness)
  MovDate2: a quadratic term for movement date
  RKM: the river kilometer of relocation
  RKM2: a quadratic term for each relocation
  Dis: mean river discharge over movement period
  Phs: photoperiod (daylength) for the movement period
  Ph2s: a quadratic term for daylength for movement period</code></pre>
<p>All of the covariates (potential explanatory variables) for this data set were standardized (centered and scaled) prior to analysis in an effort to facilitate comparison between effects of various explanatory variables. The full citation for the study can be found <a href="http://www.bioone.org/doi/pdf/10.1080/19425120.2015.1007185">here</a></p>
<p>Your charge will be to fit a series of models and analyze them within the context of a linear mixed effects model.</p>
<p>First, build a candidate model set based on your own interests or the model selection table in the paper provided. There are a lot of covariates in this data set, and many of them are highly colinear, so you will need to put some thought into how you choose your variables. You will need to make a minimum of 5 models and a maximum of 10.</p>
<p>I will place two stipulations on this:</p>
<ol style="list-style-type: decimal">
<li><p>you need to account for repeat measurements of movement rates from individual fish in this study because there are varying numbers of measurements for each individual, and this lack of balance has the potential to bias the results if not accounted for. That means you need to include a random effect of individual on the intercept.</p></li>
<li><p>Use the log of movement rate as the response. Movement rate is constrained to be greater than zero. While we are fairly robust to assumptions of normality within this framework, we do not want to allow negative predictions of movement rate.</p></li>
</ol>
<p>Make a list object of the models that you chose to test so you can do model selection later. If you have forgotten how to do this, see the lecture notes.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Here is an example of ONE FORM of the syntax we might use to</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co"># fit a linear mixed model in the &quot;lme4&quot; package using lme4::lmer</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>  Mov.mod =<span class="st"> </span><span class="kw">lmer</span>(<span class="kw">log</span>(Rate) <span class="op">~</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>TagID) <span class="op">+</span><span class="st">  </span>RKM <span class="op">+</span><span class="st"> </span>RKM2 <span class="op">+</span><span class="st"> </span>Dis <span class="op">+</span><span class="st"> </span>PhS <span class="op">+</span><span class="st"> </span>Ph2S,</span>
<span id="cb3-4"><a href="#cb3-4"></a>                <span class="dt">data =</span> est.mvmt)</span></code></pre></div>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Note that this doesn&#39;t look much different that the specification that </span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co"># we used for generalized linear mixed effects models earlier in the</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co"># within lme4. The only difference is that we have dropped the &#39;g&#39; from</span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co"># the front-end of the function.</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>  </span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co"># PLEASE </span><span class="al">NOTE</span><span class="co">: you do not need to build this model for the exercise. It </span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="co"># just happened to be the first in the list of candidate models from the</span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="co"># R script that we used to analyze these data for the study.</span></span></code></pre></div>
<p><strong>Question 1.</strong> Why did you choose to test this model set? What factors did you consider in their development?</p>
<p>Next we will use an information-theoretic approach to model selection based on Akaike’s information criterion. <strong>Another great example of how fast this field is moving forward</strong>: the last time I taught this class, I wrote <em>…we cannot rely on the canned functions from <code>AICcmodavg</code> package that have been so convenient for the past several weeks. The functions in that package have still not been adapted for use with linear mixed effects models or generalized linear models in <code>lme4</code>. Part of this reason lies in the philosophical debate within the statistical community about how many degrees of freedom we should use for the estimation of the random effect in these models. I won’t torture you with the gory details, but suffice it to say that this is yet another hotly contested issue in statistics that has not seen much resolution. Like I’ve been saying all week- this is what happens when you work on the bleeding edge of the razor. Luckily, we can write our own set of calculations, wrapped in a function called <code>aic.tableR</code> that we will <code>source</code> from a separate file.</em></p>
<p>Let’s take a look at the function so we know how it works. <strong>Note</strong> that you will not be able to source the file because you don’t have it.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Just typing the name of any function in R (and running the code) </span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co"># will allow us to see how it works!</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="kw">source</span>(<span class="st">&quot;aic.tableR.R&quot;</span>)</span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co"># Like this:    </span></span>
<span id="cb6-5"><a href="#cb6-5"></a>  aic.tableR</span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co">## function(x, y=NULL){</span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co">##       # Create a column to hold number of parameters for our model</span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co">##         k &lt;- c()</span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co">##       # Get number of parameters for each ith model in our candidate model set</span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co">##         for (i in 1:length(x)){</span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co">##         # Note that we are adding a one to the number of parameters in each</span></span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="co">##         # model. This is to account for the df needed to estimate the random</span></span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="co">##         # effect. I suppose we could use a different number or a series of</span></span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="co">##         # numbers if we were interested in evaluating the sensitivity of</span></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="co">##         # model selection statistics to the</span></span>
<span id="cb6-16"><a href="#cb6-16"></a><span class="co">##           k[i]&lt;-nrow(data.frame(summary(x[[i]])[10]))+1</span></span>
<span id="cb6-17"><a href="#cb6-17"></a><span class="co">##         }</span></span>
<span id="cb6-18"><a href="#cb6-18"></a><span class="co">##       # Make blank columns to hold statistics</span></span>
<span id="cb6-19"><a href="#cb6-19"></a><span class="co">##         AICc &lt;- c(rep(0, length(k)))        # AICc score</span></span>
<span id="cb6-20"><a href="#cb6-20"></a><span class="co">##         DeltaAIC &lt;- c(rep(0, length(k)))    # Delta AICc</span></span>
<span id="cb6-21"><a href="#cb6-21"></a><span class="co">##         AICWeight &lt;- c(rep(0, length(k)))   # Wi</span></span>
<span id="cb6-22"><a href="#cb6-22"></a><span class="co">##         Deviance &lt;- c(rep(0, length(k)))    # Model deviance</span></span>
<span id="cb6-23"><a href="#cb6-23"></a><span class="co">##         R.lik&lt;-c(rep(0, length(k)))         # Rel. likelihood for wi</span></span>
<span id="cb6-24"><a href="#cb6-24"></a><span class="co">##       # Make a dataframe to hold results of model selection</span></span>
<span id="cb6-25"><a href="#cb6-25"></a><span class="co">##         if(is.null(y)){ y=rep(&quot;&quot;, length(x))}</span></span>
<span id="cb6-26"><a href="#cb6-26"></a><span class="co">## </span></span>
<span id="cb6-27"><a href="#cb6-27"></a><span class="co">##         ranks&lt;-data.frame(y, k, AICc, DeltaAIC, AICWeight)</span></span>
<span id="cb6-28"><a href="#cb6-28"></a><span class="co">##         names(ranks)[1] &lt;- &quot;Model&quot;</span></span>
<span id="cb6-29"><a href="#cb6-29"></a><span class="co">##       # Get AICc for each model</span></span>
<span id="cb6-30"><a href="#cb6-30"></a><span class="co">##         for(i in 1:nrow(ranks)){</span></span>
<span id="cb6-31"><a href="#cb6-31"></a><span class="co">##           # Note that we are penalizing the likelihood of each model based on</span></span>
<span id="cb6-32"><a href="#cb6-32"></a><span class="co">##           # the number of parameters in each model in addition to sample size</span></span>
<span id="cb6-33"><a href="#cb6-33"></a><span class="co">##           ranks$AICc[i] &lt;- AIC(x[[i]])+(((2*k[i])*(k[i]+1))/</span></span>
<span id="cb6-34"><a href="#cb6-34"></a><span class="co">##             (nrow(est.mvmt)-k[i]-1))</span></span>
<span id="cb6-35"><a href="#cb6-35"></a><span class="co">##         }</span></span>
<span id="cb6-36"><a href="#cb6-36"></a><span class="co">##       # Sort the table by AICc to get them in order for calculations</span></span>
<span id="cb6-37"><a href="#cb6-37"></a><span class="co">##         ranks &lt;- ranks[with(ranks, order(AICc)), ]</span></span>
<span id="cb6-38"><a href="#cb6-38"></a><span class="co">##       # Calculate delta AIC</span></span>
<span id="cb6-39"><a href="#cb6-39"></a><span class="co">##         for(i in 1:nrow(ranks)){</span></span>
<span id="cb6-40"><a href="#cb6-40"></a><span class="co">##           ranks$DeltaAIC[i] &lt;- ranks$AICc[i]-ranks$AICc[1]</span></span>
<span id="cb6-41"><a href="#cb6-41"></a><span class="co">##         }</span></span>
<span id="cb6-42"><a href="#cb6-42"></a><span class="co">##       # Calculate the relative likelihood for each of the models</span></span>
<span id="cb6-43"><a href="#cb6-43"></a><span class="co">##         for(i in 1:nrow(ranks)){</span></span>
<span id="cb6-44"><a href="#cb6-44"></a><span class="co">##           R.lik[i] &lt;- exp(-.5*ranks$DeltaAIC[i])</span></span>
<span id="cb6-45"><a href="#cb6-45"></a><span class="co">##         }</span></span>
<span id="cb6-46"><a href="#cb6-46"></a><span class="co">##       # Calculate AIC weight for each of the models based on the relative</span></span>
<span id="cb6-47"><a href="#cb6-47"></a><span class="co">##       # likelihood</span></span>
<span id="cb6-48"><a href="#cb6-48"></a><span class="co">##         for(i in 1:length(R.lik)){</span></span>
<span id="cb6-49"><a href="#cb6-49"></a><span class="co">##           ranks$AICWeight[i] &lt;- R.lik[i]/sum(R.lik[1:length(R.lik)])</span></span>
<span id="cb6-50"><a href="#cb6-50"></a><span class="co">##         }</span></span>
<span id="cb6-51"><a href="#cb6-51"></a><span class="co">##       # Round off the calculated columns to two decimal places because that is</span></span>
<span id="cb6-52"><a href="#cb6-52"></a><span class="co">##       # really all we need for wi and we want the rest to be standardized.</span></span>
<span id="cb6-53"><a href="#cb6-53"></a><span class="co">##         ranks[ , 3:5] &lt;- round(ranks[ , 3:5], 2)</span></span>
<span id="cb6-54"><a href="#cb6-54"></a><span class="co">##       # Print the model selection results</span></span>
<span id="cb6-55"><a href="#cb6-55"></a><span class="co">##         return(ranks)</span></span>
<span id="cb6-56"><a href="#cb6-56"></a><span class="co">##   }</span></span></code></pre></div>
<p>Fast forward a couple of years, and now model selection for GLMM has been implemented in the <code>AICcmodavg</code> package. So, you can now use the <code>aictab</code> function in the <code>AICcmodavg</code> package instead of the <code>aic.tableR</code> function we have defined above to calculate model selection statistics for your model list (thank goodness because I am having a heck of a time trying to source this through the web over the campus network). Go ahead: do it.</p>
<p><strong>Question 2.</strong> According to your model selection statistics, which of your models was the top model? Is there clear evidence for a <em>best</em> model?</p>
<!-- What is the probability that your top model is the best in the candidate set? Using the $w_i$ ratio that we introduced a few weeks back, how many times better supported is your best model compared to your second best model? -->
<p><strong>Question 3.</strong> Were there any variables that were clearly more important than others in your candidate set?</p>
<p>Before you go any further (i.e., before you look at any of the model summaries) have a look at the model diagnostics for your best model using the <code>plot()</code> function.</p>
<p>Does the distribution appear to be (more or less) normal with a mean of zero with respect to the fitted values? Notice that there is only one plot for the diagnostics here. This is because we are pretty much only concerned with the fact that the residuals of the random effect are normally distributed. Now that’s what I call flexibility.</p>
<p>Now go ahead and look at the summary of your best model.</p>
<p><strong>Food for thought</strong>: What factors were included in your best model? Are they all considered significant at <span class="math inline">\(alpha\)</span> = 0.05?</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Note that if you have factors in your model,</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="co"># you can still get an overall significance</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co"># level for your variables for GLMM and LMM using</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co"># car::Anova. Here is the first one from the model</span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="co"># list from the paper:</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>  <span class="kw">library</span>(car)</span>
<span id="cb7-7"><a href="#cb7-7"></a>  <span class="kw">Anova</span>(Mov.mods[[<span class="dv">1</span>]], <span class="dt">Type=</span><span class="st">&#39;III&#39;</span>)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table (Type II Wald chisquare tests)
## 
## Response: log(Rate)
##        Chisq Df Pr(&gt;Chisq)    
## RKM  29.5398  1  5.478e-08 ***
## RKM2  1.6987  1     0.1925    
## Dis   5.2070  1     0.0225 *  
## PhS  24.7536  1  6.515e-07 ***
## Ph2S  0.5392  1     0.4628    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><strong>Question 4.</strong> Using the standardized regression coefficients, which variable included in your best model has the strongest effect on movement rate? Is this supported by your model selection results?</p>
<p>Finally, let’s actually look at the interpretation of our random effect. We can interpret this term as the amount of variability that exists between individuals in these models. In general, if the variance for our error term (<code>TagID</code> in this case) is larger than the residual variance, then the random effect can be thought of as ‘important’. That is, a model that does not include the random effect should result in a much poorer fit than the model that includes the random effect.</p>
<p>Philosophically, there is some reasonable opposition to the comparison of mixed effects models with their fixed effects counterparts, namely that exclusion of the fixed effect (if part of experimental design) is pseudo-replication (more specifically, it is ‘sacrificial pseudoreplication’ according to <a href = "www.masterenbiodiversidad.org/docs/asig3/Hurlbert_1984_Pseudoreplication.pdf">Hurlbert (1984)</a>.</p>
<p>The <em>point</em> of all of this is that we included the random effect in order to account for issues with experimental design, so we might want to use it to temper our predictions to improve the accuracy of estimating population-level means.</p>
<p>For the example model I have been using we can get a 95% CI on the mean movement rate of individuals as follows:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Get coefficients and ses</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>  cc =<span class="st"> </span><span class="kw">fixef</span>(Mov.mods[[<span class="dv">1</span>]])[<span class="dv">1</span>]                   <span class="co"># Intercept</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>  ss =<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">unlist</span>(<span class="kw">VarCorr</span>(Mov.mods[[<span class="dv">1</span>]])))      <span class="co"># Random effects SD</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>  se =<span class="st"> </span><span class="kw">summary</span>(Mov.mods[[<span class="dv">1</span>]])<span class="op">$</span>coefficients[<span class="dv">1</span>,<span class="dv">2</span>]  <span class="co"># Intercept se</span></span>
<span id="cb9-5"><a href="#cb9-5"></a></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co"># Print the mean movement rate for</span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co"># smolts (in body lengths per second). </span></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="co"># Note that we need to use exp() because</span></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="co"># the analysis was on the log scale.</span></span>
<span id="cb9-10"><a href="#cb9-10"></a>  <span class="kw">exp</span>(cc)</span></code></pre></div>
<pre><code>## (Intercept) 
##    1.352833</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Now we can ask R to give us a 95% CI on the estimate Note that we</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="co"># need to use exp() because the analysis was on the log scale.</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="kw">exp</span>(<span class="kw">qnorm</span>(<span class="kw">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>), <span class="dt">mean=</span>cc,<span class="dt">sd=</span>ss<span class="op">+</span>se)) </span></code></pre></div>
<pre><code>## [1] 1.303878 1.403625</code></pre>
<p><strong>Question 5.</strong> Using the code above, do the same thing for your best model and report the model-predicted mean and 95% CI for smolt movement through the estuary. How does this compare to the median movement rate of of smolts in the data set? Why do you suppose this is? I will take one of two answers, only one is correct though.</p>
</div>
</div>
</div>

<!DOCTYPE html>

<br>

<hr>

<p style="color:gray; text-align:center">This work is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/legalcode">Creative Commons Attribution 4.0 International License</a>. Data are provided for educational purposes only unless otherwise noted.</p>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
