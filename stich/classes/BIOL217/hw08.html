<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>hw08.utf8</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<!DOCTYPE html>
<head>
<!-- Favicon for various operating systems -->
<link rel="apple-touch-icon" sizes="180x180" href="./favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="./favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="./favicon/favicon-16x16.png">
<!-- <link rel="manifest" href="./favicon/site.webmanifest"> -->
<link rel="mask-icon" href="./favicon/safari-pinned-tab.svg" color="#603cba">
<link rel="shortcut icon" href="./favicon/favicon.ico">
<meta name="msapplication-TileColor" content="#603cba">
<meta name="msapplication-config" content="./favicon/browserconfig.xml">
<meta name="theme-color" content="#382121">
</head>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="..\..\styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">BIOL 217</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="content.html">Course content</a>
</li>
<li>
  <a href="software.html">Software needs</a>
</li>
<li>
  <a href="resources.html">Additional Resources</a>
</li>
<li>
  <a href="contact.html">Contact</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/danStich">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<div id="generalized-linear-models-logistic-regression" class="section level1">
<h1>Generalized linear models: logistic regression</h1>
<p><img src="../../images/veligers.jpg" alt=""></p>
<h2 id="multi">
Introduction
</h2>
<p>This week in lab, we will start to take a closer look at generalized linear models (GLM) through the lens of logisitic regression. This is an family that includes multiple types of analyses depending on the data. For example, we might have binary data (0, 1), binomial data (number of success per some number of trials), or multinomial data (group membership as a response). We will look at the simplest of these cases, binary logistic regression, this week.</p>
<div id="the-data" class="section level2">
<h2>The data</h2>
<p>For our exercise this week, we will work with a data set from a Biological Field Station intern project. The purpose of the project was to test the efficacy of Virkon as a molluscicide for dissinfecting equipment following exposure to zebra mussels <em>Dreissena polymorpha</em>. The study examined the effects of exposure time and concentration on mortality. The response in this data set is <code>dead</code>, a 1/0 variable indicating whether or not a zebra mussel was dead. Usually, with this kind of data, we use a <code>1</code> to indicate survival, but it seemed like too much fun to pass up the opportunity to model mortality as a success. So, for this data set a <code>1</code> indicates dead.</p>
<p>Start by reading in the data.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>vd =<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;veligers.csv&#39;</span>)</span></code></pre></div>
<p>This data set contains a <em>pile</em> of variables, which of course makes it very fun to play with. We will work with some, but not all, of these variable this week for lab.</p>
<p>Explanations of variables are as follows:</p>
<p><code>Date</code>: calendar date for start of each lab test</p>
<p><code>Location</code>: the location in Otsego Lake, NY from which mussels were collected</p>
<p><code>SolnAge</code>: the age of the Virkon solution</p>
<p><code>Concentration</code>: concentration of Virkon in solution</p>
<p><code>Time</code>: exposure time</p>
<p>We will treat concentration as a categorical variable because we only have a few different concentrations, although the argument could be made either way.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>vd<span class="op">$</span>Concentration =<span class="st"> </span><span class="kw">as.factor</span>(vd<span class="op">$</span>Concentration)</span></code></pre></div>
<p>The remaining variables are physical and chemical parameters of water measured either in Otsego Lake, or in the Virkon solution. We will come back to these.</p>
</div>
<div id="exercises" class="section level2">
<h2>Exercises</h2>
<h3 id="multi">
A worked example
</h3>
<p>Let’s start with a simple example to get you moving along. First, we are interested in determining the effects of <code>Concentration</code> and <code>Time</code> on the probability of zebra mussel death (<code>dead</code>) following exposure. If you have been following closely during the past few weeks, you will recognize that with a categorical variable (<code>Concentration</code>) and a continuous variable (<code>Time</code>) we are looking at something that should resemble ANCOVA to you. <strong>But</strong>, our response, <code>dead</code>, can only take on values of 0 and 1, so we know that we need to use a GLM to accommodate this.</p>
<div id="analysis" class="section level4">
<h4>Analysis</h4>
<p>To fit this model we will use the <code>glm</code> function in R, being sure to specify <code>family = 'binomial'</code> in our call:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Fit the model</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>  v.mod =<span class="st"> </span><span class="kw">glm</span>(dead<span class="op">~</span>Concentration<span class="op">+</span>Time, <span class="dt">family=</span><span class="st">&#39;binomial&#39;</span>, <span class="dt">data=</span>vd)</span></code></pre></div>
<p>Cool, that was easy!</p>
</div>
<div id="results" class="section level4">
<h4>Results</h4>
<p>Let’s have a look at what the model tells us about our biological questions of interest now. Remember, we need to work with the <code>Anova()</code> function in the <code>car</code> package to use the correct calculations because we have continuous and categorical variables. The only difference is that we are now using an analysis of deviance to summarize significance, which requires the use of a Type-II test instead of a Type-III test.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Load the car library so we can get a </span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co"># meaningful ANOVA table for our model</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="kw">library</span>(car)</span>
<span id="cb4-4"><a href="#cb4-4"></a></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co"># Print the summary of the model</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>  <span class="kw">Anova</span>(v.mod, <span class="dt">Type=</span><span class="st">&#39;II&#39;</span>)</span>
<span id="cb4-7"><a href="#cb4-7"></a>Analysis of Deviance <span class="kw">Table</span> (Type II tests)</span>
<span id="cb4-8"><a href="#cb4-8"></a></span>
<span id="cb4-9"><a href="#cb4-9"></a>Response<span class="op">:</span><span class="st"> </span>dead</span>
<span id="cb4-10"><a href="#cb4-10"></a>              LR Chisq Df <span class="kw">Pr</span>(<span class="op">&gt;</span>Chisq)    </span>
<span id="cb4-11"><a href="#cb4-11"></a>Concentration   <span class="fl">8885.8</span>  <span class="dv">5</span>  <span class="op">&lt;</span><span class="st"> </span><span class="fl">2.2e-16</span> <span class="op">**</span><span class="er">*</span></span>
<span id="cb4-12"><a href="#cb4-12"></a>Time            <span class="fl">4501.7</span>  <span class="dv">1</span>  <span class="op">&lt;</span><span class="st"> </span><span class="fl">2.2e-16</span> <span class="op">**</span><span class="er">*</span></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="op">---</span></span>
<span id="cb4-14"><a href="#cb4-14"></a>Signif. codes<span class="op">:</span><span class="st">  </span><span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span></code></pre></div>
<p><strong>Question 1.</strong> At the default confidence level (<span class="math inline">\(\alpha\)</span> = 0.05), what can you determine about effects of <code>Concentration</code> and <code>Time</code> with respect to statistical significance? Answer in sentence form, stating the null hypotheses and supporting statistics.</p>
<p>Just as with all of our other models, we can use the <code>summary()</code> function to get the output from R.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Print the summary of the model</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="kw">summary</span>(v.mod)</span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a>Call<span class="op">:</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="kw">glm</span>(<span class="dt">formula =</span> dead <span class="op">~</span><span class="st"> </span>Concentration <span class="op">+</span><span class="st"> </span>Time, <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb5-6"><a href="#cb5-6"></a>    <span class="dt">data =</span> vd)</span>
<span id="cb5-7"><a href="#cb5-7"></a></span>
<span id="cb5-8"><a href="#cb5-8"></a>Deviance Residuals<span class="op">:</span><span class="st"> </span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="st">    </span>Min       1Q   Median       3Q      Max  </span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="fl">-4.3208</span>  <span class="fl">-0.0218</span>   <span class="fl">0.0214</span>   <span class="fl">0.2047</span>   <span class="fl">5.0817</span>  </span>
<span id="cb5-11"><a href="#cb5-11"></a></span>
<span id="cb5-12"><a href="#cb5-12"></a>Coefficients<span class="op">:</span></span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="st">                    </span>Estimate Std. Error z value <span class="kw">Pr</span>(<span class="op">&gt;</span><span class="er">|</span>z<span class="op">|</span>)    </span>
<span id="cb5-14"><a href="#cb5-14"></a>(Intercept)       <span class="fl">-13.825053</span>   <span class="fl">0.355912</span>  <span class="fl">-38.84</span>   <span class="op">&lt;</span><span class="fl">2e-16</span> <span class="op">**</span><span class="er">*</span></span>
<span id="cb5-15"><a href="#cb5-15"></a>Concentration0<span class="fl">.25</span>  <span class="fl">11.252573</span>   <span class="fl">0.311103</span>   <span class="fl">36.17</span>   <span class="op">&lt;</span><span class="fl">2e-16</span> <span class="op">**</span><span class="er">*</span></span>
<span id="cb5-16"><a href="#cb5-16"></a>Concentration0<span class="fl">.5</span>   <span class="fl">12.201641</span>   <span class="fl">0.325214</span>   <span class="fl">37.52</span>   <span class="op">&lt;</span><span class="fl">2e-16</span> <span class="op">**</span><span class="er">*</span></span>
<span id="cb5-17"><a href="#cb5-17"></a>Concentration1     <span class="fl">13.407026</span>   <span class="fl">0.344278</span>   <span class="fl">38.94</span>   <span class="op">&lt;</span><span class="fl">2e-16</span> <span class="op">**</span><span class="er">*</span></span>
<span id="cb5-18"><a href="#cb5-18"></a>Concentration2     <span class="fl">13.527866</span>   <span class="fl">0.342963</span>   <span class="fl">39.44</span>   <span class="op">&lt;</span><span class="fl">2e-16</span> <span class="op">**</span><span class="er">*</span></span>
<span id="cb5-19"><a href="#cb5-19"></a>Concentration3     <span class="fl">13.464877</span>   <span class="fl">0.345367</span>   <span class="fl">38.99</span>   <span class="op">&lt;</span><span class="fl">2e-16</span> <span class="op">**</span><span class="er">*</span></span>
<span id="cb5-20"><a href="#cb5-20"></a>Time                <span class="fl">0.182631</span>   <span class="fl">0.005109</span>   <span class="fl">35.75</span>   <span class="op">&lt;</span><span class="fl">2e-16</span> <span class="op">**</span><span class="er">*</span></span>
<span id="cb5-21"><a href="#cb5-21"></a><span class="op">---</span></span>
<span id="cb5-22"><a href="#cb5-22"></a>Signif. codes<span class="op">:</span><span class="st">  </span><span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb5-23"><a href="#cb5-23"></a></span>
<span id="cb5-24"><a href="#cb5-24"></a>(Dispersion parameter <span class="cf">for</span> binomial family taken to be <span class="dv">1</span>)</span>
<span id="cb5-25"><a href="#cb5-25"></a></span>
<span id="cb5-26"><a href="#cb5-26"></a>    Null deviance<span class="op">:</span><span class="st"> </span><span class="fl">15731.0</span>  on <span class="dv">12108</span>  degrees of freedom</span>
<span id="cb5-27"><a href="#cb5-27"></a>Residual deviance<span class="op">:</span><span class="st">  </span><span class="fl">4989.6</span>  on <span class="dv">12102</span>  degrees of freedom</span>
<span id="cb5-28"><a href="#cb5-28"></a>AIC<span class="op">:</span><span class="st"> </span><span class="fl">5003.6</span></span>
<span id="cb5-29"><a href="#cb5-29"></a></span>
<span id="cb5-30"><a href="#cb5-30"></a>Number of Fisher Scoring iterations<span class="op">:</span><span class="st"> </span><span class="dv">8</span></span></code></pre></div>
<p>The summary of the model gives us the estimated coefficients <strong>on the logit scale</strong>, along with our usual significance codes and an AIC score (now in the default output because we are using maximum likelihood estimation).</p>
<p>Even though these parameters are on the logit scale, we can still make limited inference about the directionality of relationships as we would with linear models used earlier in the semester.</p>
<p><strong>Question 2.</strong> What, if any, is the direction of the relationship between <code>Time</code> and zebra mussel mortality?</p>
<p><strong>Question 3.</strong> What is the general trend in mortality with the different concentrations listed in the <code>summary</code> of <code>vmod</code>? This may take a little thought, but remember that even as categorical variables, factor levels are listed alphanumerically in the output. If <code>Concentration == 0</code> (“control”) is in the intercept, then the remaining coefficients are directly comparable.</p>
<!-- Here, we see that the coefficient for `Time` is positive (0.183), meaning that we would predict probability of `dead` to be directly proportional to `Time` (higher probability of death following increased exposure time). This, of course, seems perfectly reasonable. -->
<p>One thing that you’ll notice is missing from this output is the R<sup>2</sup> value that we have become familiar with during the past several weeks while working with linear models. There is no R<sup>2</sup> value because we are no longer estimating these models using ordinary least squares, but rather maximum likelihood estimation. If we wanted to get an analagous metric of variance explained by our model, we could estimate a <em>pseudo-R<sup>2</sup></em>. There are many of these available depending on the model and nature of our data. The simplest, and arguably most common is the <strong>McFadden R<sup>2</sup></strong>. To estimate this one, we compare the deviance of our model to the deviance of an intercept-only (i.e. “null”) model using the output from the <code>summary</code> function above:</p>
<p><span class="math display">\[McFadden R^2 = 1 - \frac{Deviance_{residual}}{Deviance_{null}}\]</span></p>
<p>In R, the residual deviance is stored in <code>v.mod$deviance</code> and the null deviance is stored in <code>v.mod$null.deviance</code>. So,</p>
<!-- Here, we can see that the model only explains about 68% of the variation in the response of interest: -->
<p><span class="math display">\[R^2 = 1 - \frac{4989.599}{1.5731041\times 10^{4}} = ?\]</span></p>
<p><strong>Question 4.</strong> How much of the variation in zebra mussel mortality is explained by the additive effects of <code>Concentration</code> and <code>Time</code>?</p>
<p>Now that we have a feel for just how much variability this model explains, the next step in reporting our results here is to extract some information about how <code>dead</code> changes with <code>Time</code> beyond simply stating that it was either “inversely” or “proportionally” related to <code>Time</code>. We will include <code>Concentration</code> in our predictions to account for changes between doses.</p>
<p>Recall that we can make predictions from our model either by hand or by using the <code>predict</code> function in R. <strong>Note</strong> that if we use the <code>predict</code> function for <code>glm</code> objects in R, we no longer have the ability to set the <code>interval</code> argument as we did for objects resulting from the <code>lm()</code> function (well, we can- it will just be ignored). But, we can get standard error estimates if we make predictions on the link scale. Therefore, if we want confidence intervals on our predictions, we will need to do it by hand (well, in the computer).</p>
<p>Start by making some new data that we can use for predictions. Recall from <a href="06_diagnosticsAndEffects.html">lecture module 6</a> that this gets a little more complicated when we have multiple explanatory variables. The <code>predict</code> function requires a <code>data.frame</code> with <code>names</code> that match the <code>names</code> of explanatory variables from our original data set, <code>vd</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Start with Time by making a sequence from the minimum</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co"># observed Time to the maximum observed Time in equal</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co"># increments of 1 hour</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>  Time =<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from=</span><span class="kw">min</span>(vd<span class="op">$</span>Time), <span class="dt">to=</span><span class="kw">max</span>(vd<span class="op">$</span>Time), <span class="dt">by=</span><span class="dv">1</span>)</span>
<span id="cb6-5"><a href="#cb6-5"></a></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co"># Now, make a column for each Concentration that is the same length</span></span>
<span id="cb6-7"><a href="#cb6-7"></a>  Concentration =<span class="st"> </span><span class="kw">rep</span>(<span class="kw">unique</span>(vd<span class="op">$</span>Concentration), <span class="kw">length</span>(Time))</span>
<span id="cb6-8"><a href="#cb6-8"></a>  </span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co"># Now, duplicate the Time column so it is repeated </span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co"># for all Concentrationes</span></span>
<span id="cb6-11"><a href="#cb6-11"></a>  Time =<span class="st"> </span><span class="kw">rep</span>(Time, <span class="kw">length</span>(<span class="kw">unique</span>(Concentration)))</span>
<span id="cb6-12"><a href="#cb6-12"></a>  </span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="co"># Put it all together in a dataframe</span></span>
<span id="cb6-14"><a href="#cb6-14"></a>  newD =<span class="st"> </span><span class="kw">data.frame</span>(Concentration, Time)</span>
<span id="cb6-15"><a href="#cb6-15"></a>  newD =<span class="st"> </span>newD[<span class="kw">with</span>(newD, <span class="kw">order</span>(Concentration, Time)), ]</span></code></pre></div>
<p>Now that we have new data for making predictions, let’s go ahead and do it!</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Calculate mean predicted value and SE for the predictions</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="co"># on the link scale</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>  preds =<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb7-4"><a href="#cb7-4"></a>    <span class="kw">predict</span>(v.mod, newD, <span class="dt">type=</span><span class="st">&#39;link&#39;</span>, <span class="dt">se.fit =</span> <span class="ot">TRUE</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]</span>
<span id="cb7-5"><a href="#cb7-5"></a>  )</span>
<span id="cb7-6"><a href="#cb7-6"></a></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co"># Now get lower and upper CIs</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>  preds<span class="op">$</span>lwr =<span class="st"> </span>preds<span class="op">$</span>fit <span class="op">+</span><span class="st"> </span>preds<span class="op">$</span>se.fit<span class="op">*</span><span class="kw">qnorm</span>(<span class="fl">0.025</span>)</span>
<span id="cb7-9"><a href="#cb7-9"></a>  preds<span class="op">$</span>upr =<span class="st"> </span>preds<span class="op">$</span>fit <span class="op">+</span><span class="st"> </span>preds<span class="op">$</span>se.fit<span class="op">*</span><span class="kw">qnorm</span>(<span class="fl">0.975</span>)</span></code></pre></div>
<p>Now, we need to define a function to invert the logit link function if we want to get our predictions back on the probability scale (and we do).</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>inv.logit =<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="kw">exp</span>(x)<span class="op">/</span>(<span class="dv">1</span><span class="op">+</span><span class="kw">exp</span>(x))</span>
<span id="cb8-3"><a href="#cb8-3"></a>}</span></code></pre></div>
<p>Now we can convert our predictions to the probability scale. Here, we loop over columns 1, 3, and 4 of our <code>preds</code> dataframe using the <code>apply</code> function because the second column is just the standard errors for our predicted fit at each point. This gives us mean and 95% CI on the probability scale.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Convert the predictions to the probability scale</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>  preds[ , <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">4</span>)] =<span class="st"> </span><span class="kw">apply</span>(<span class="dt">X=</span>preds[ , <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">4</span>)],</span>
<span id="cb9-3"><a href="#cb9-3"></a>                             <span class="dt">MARGIN=</span><span class="dv">2</span>,</span>
<span id="cb9-4"><a href="#cb9-4"></a>                             <span class="dt">FUN=</span>inv.logit</span>
<span id="cb9-5"><a href="#cb9-5"></a>                             )</span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co"># Add our new data to the dataframe</span></span>
<span id="cb9-7"><a href="#cb9-7"></a>  preds =<span class="st"> </span><span class="kw">data.frame</span>(preds, newD)</span></code></pre></div>
<p>Finally, let’s plot our predictions. Note that we do not plot our raw data here because it is a huge number of ones and zeros that do not lend themselves to visual interpretation (I tried), but this is generally good practice. We could go through and plot these one at a time (see lecture content), but here I will demonstrate how one might do this using a loop, followed by a number of conditionals for axis labeling. All in the name of gross overkill (oh, wait, I mean responsive programming and data visualization!).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Plot the predictions</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="co"># Set graphical parameters</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>  <span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">2</span>), <span class="dt">oma=</span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,.<span class="dv">5</span>,.<span class="dv">5</span>))</span>
<span id="cb10-4"><a href="#cb10-4"></a></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="co"># Loop over the different doses to plot probability</span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="co"># of mortality by exposure time</span></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">unique</span>(preds<span class="op">$</span>Concentration))){</span>
<span id="cb10-8"><a href="#cb10-8"></a>  <span class="co"># Plot the mean</span></span>
<span id="cb10-9"><a href="#cb10-9"></a>    <span class="kw">plot</span>(<span class="dt">y=</span>preds<span class="op">$</span>fit[preds<span class="op">$</span>Concentration<span class="op">==</span><span class="kw">unique</span>(preds<span class="op">$</span>Concentration)[i]],</span>
<span id="cb10-10"><a href="#cb10-10"></a>         <span class="dt">x=</span>preds<span class="op">$</span>Time[preds<span class="op">$</span>Concentration<span class="op">==</span><span class="kw">unique</span>(preds<span class="op">$</span>Concentration)[i]],</span>
<span id="cb10-11"><a href="#cb10-11"></a>         <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&#39;black&#39;</span>),</span>
<span id="cb10-12"><a href="#cb10-12"></a>         <span class="dt">type=</span><span class="st">&#39;l&#39;</span>,</span>
<span id="cb10-13"><a href="#cb10-13"></a>         <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">lwd=</span><span class="dv">1</span>,</span>
<span id="cb10-14"><a href="#cb10-14"></a>         <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb10-15"><a href="#cb10-15"></a>         <span class="dt">ylab =</span> <span class="st">&#39;&#39;</span>,</span>
<span id="cb10-16"><a href="#cb10-16"></a>         <span class="dt">xlab =</span> <span class="st">&#39;&#39;</span>,</span>
<span id="cb10-17"><a href="#cb10-17"></a>         <span class="dt">yaxt=</span><span class="st">&#39;n&#39;</span>, <span class="dt">xaxt=</span><span class="st">&#39;n&#39;</span></span>
<span id="cb10-18"><a href="#cb10-18"></a>         )</span>
<span id="cb10-19"><a href="#cb10-19"></a>  <span class="co"># Lower 95% CI</span></span>
<span id="cb10-20"><a href="#cb10-20"></a>    <span class="kw">lines</span>(preds<span class="op">$</span>lwr[preds<span class="op">$</span>Concentration<span class="op">==</span><span class="kw">unique</span>(preds<span class="op">$</span>Concentration)[i]], </span>
<span id="cb10-21"><a href="#cb10-21"></a>          <span class="dt">x=</span>preds<span class="op">$</span>Time[preds<span class="op">$</span>Concentration<span class="op">==</span><span class="kw">unique</span>(preds<span class="op">$</span>Concentration)[i]],</span>
<span id="cb10-22"><a href="#cb10-22"></a>          <span class="dt">col=</span><span class="st">&#39;red&#39;</span>, <span class="dt">lty=</span><span class="dv">2</span>)</span>
<span id="cb10-23"><a href="#cb10-23"></a>  <span class="co"># Upper 95% CI</span></span>
<span id="cb10-24"><a href="#cb10-24"></a>    <span class="kw">lines</span>(preds<span class="op">$</span>upr[preds<span class="op">$</span>Concentration<span class="op">==</span><span class="kw">unique</span>(preds<span class="op">$</span>Concentration)[i]], </span>
<span id="cb10-25"><a href="#cb10-25"></a>          <span class="dt">x=</span>preds<span class="op">$</span>Time[preds<span class="op">$</span>Concentration<span class="op">==</span><span class="kw">unique</span>(preds<span class="op">$</span>Concentration)[i]],</span>
<span id="cb10-26"><a href="#cb10-26"></a>          <span class="dt">col=</span><span class="st">&#39;red&#39;</span>, <span class="dt">lty=</span><span class="dv">2</span>)</span>
<span id="cb10-27"><a href="#cb10-27"></a>    </span>
<span id="cb10-28"><a href="#cb10-28"></a>  <span class="co"># Add the name of the metric to the plots  </span></span>
<span id="cb10-29"><a href="#cb10-29"></a>    <span class="kw">text</span>(<span class="dt">x =</span> <span class="dv">60</span>, <span class="dt">y =</span> <span class="fl">0.25</span>,</span>
<span id="cb10-30"><a href="#cb10-30"></a>         <span class="dt">labels =</span> <span class="kw">paste</span>(<span class="st">&quot;Concentration =&quot;</span>, <span class="kw">unique</span>(preds<span class="op">$</span>Concentration)[i]),</span>
<span id="cb10-31"><a href="#cb10-31"></a>         <span class="dt">adj =</span> <span class="dv">1</span>)</span>
<span id="cb10-32"><a href="#cb10-32"></a>    </span>
<span id="cb10-33"><a href="#cb10-33"></a>    <span class="co"># Add x(side=1) and y (side=2) tick marks to all plots </span></span>
<span id="cb10-34"><a href="#cb10-34"></a>    <span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">labels =</span> <span class="ot">FALSE</span>, <span class="dt">tick =</span> <span class="ot">TRUE</span>)</span>
<span id="cb10-35"><a href="#cb10-35"></a>    <span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">2</span>, <span class="dt">at =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.25</span>),</span>
<span id="cb10-36"><a href="#cb10-36"></a>         <span class="dt">labels =</span> <span class="ot">FALSE</span>, <span class="dt">tick =</span> <span class="ot">TRUE</span>)</span>
<span id="cb10-37"><a href="#cb10-37"></a>    </span>
<span id="cb10-38"><a href="#cb10-38"></a>  <span class="co"># Add x-axis tick labels only if plot 11 or 12</span></span>
<span id="cb10-39"><a href="#cb10-39"></a>    <span class="cf">if</span>((i<span class="op">==</span><span class="dv">5</span>) <span class="op">||</span><span class="st"> </span>(i<span class="op">==</span><span class="dv">6</span>)){</span>
<span id="cb10-40"><a href="#cb10-40"></a>      <span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">at =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="kw">round</span>(<span class="kw">max</span>(preds<span class="op">$</span>Time)), <span class="dv">10</span>),</span>
<span id="cb10-41"><a href="#cb10-41"></a>           <span class="dt">labels =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="kw">round</span>(<span class="kw">max</span>(preds<span class="op">$</span>Time)), <span class="dv">10</span>))  </span>
<span id="cb10-42"><a href="#cb10-42"></a>    }     </span>
<span id="cb10-43"><a href="#cb10-43"></a>    </span>
<span id="cb10-44"><a href="#cb10-44"></a>  <span class="co"># Add y-axis tick labels only if plot number is even  </span></span>
<span id="cb10-45"><a href="#cb10-45"></a>    <span class="cf">if</span>((i <span class="op">%%</span><span class="st"> </span><span class="dv">2</span>) <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) {</span>
<span id="cb10-46"><a href="#cb10-46"></a>      <span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">2</span>, <span class="dt">at =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.25</span>),</span>
<span id="cb10-47"><a href="#cb10-47"></a>           <span class="dt">labels =</span> <span class="kw">format</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.25</span>),<span class="dt">digits =</span> <span class="dv">2</span>), <span class="dt">las=</span><span class="dv">2</span>)  </span>
<span id="cb10-48"><a href="#cb10-48"></a>    }    </span>
<span id="cb10-49"><a href="#cb10-49"></a>    </span>
<span id="cb10-50"><a href="#cb10-50"></a>}</span>
<span id="cb10-51"><a href="#cb10-51"></a></span>
<span id="cb10-52"><a href="#cb10-52"></a><span class="co"># Add x and y-axis labels to the plot    </span></span>
<span id="cb10-53"><a href="#cb10-53"></a><span class="kw">mtext</span>(<span class="dt">text=</span><span class="st">&quot;Probability of mortality&quot;</span>,</span>
<span id="cb10-54"><a href="#cb10-54"></a>      <span class="dt">side=</span><span class="dv">2</span>, <span class="dt">line=</span><span class="fl">2.75</span>, <span class="dt">cex=</span><span class="dv">1</span>,</span>
<span id="cb10-55"><a href="#cb10-55"></a>      <span class="dt">adj=</span>.<span class="dv">5</span>, <span class="dt">outer=</span><span class="ot">TRUE</span></span>
<span id="cb10-56"><a href="#cb10-56"></a>      )</span>
<span id="cb10-57"><a href="#cb10-57"></a><span class="kw">mtext</span>(<span class="dt">text=</span><span class="st">&quot;Time (h)&quot;</span>,</span>
<span id="cb10-58"><a href="#cb10-58"></a>      <span class="dt">side=</span><span class="dv">1</span>, <span class="dt">line=</span><span class="dv">2</span>, <span class="dt">cex=</span><span class="dv">1</span>,</span>
<span id="cb10-59"><a href="#cb10-59"></a>      <span class="dt">adj=</span>.<span class="dv">5</span>, <span class="dt">outer=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="hw08_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>Using either the graph or the estimates in the <code>fit</code> column of <code>preds</code>, we can estimate about how much <code>dead</code> changes across the range of <code>Time</code> observed. We can report this by <code>Time</code> to convey more information.</p>
<p><strong>Question 5.</strong> Use the graph you have created, along with the model results to describe how zebra mussel mortality changed with <code>Concentration</code> and <code>Time</code>.</p>
<p>If you have been paying close attention this semester, you may be wondering why we don’t fit an interaction that would allow the effect of exposure time to vary across <code>Concentration</code>, and indeed that is a fair question. Unfortunately, the degree of mortality that results after short exposure to the higher concentrations is so high that variance estimation in the model becomes unstable and we predict confidence intervals from zero to one (despite increasing the R<sup>2</sup> to 0.94 and producing much more intuitive curves).</p>
</div>
</div>
</div>

<!DOCTYPE html>

<br>

<hr>

<p style="color:gray; text-align:center">This work is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/legalcode">Creative Commons Attribution 4.0 International License</a>. Data are provided for educational purposes only unless otherwise noted.</p>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
