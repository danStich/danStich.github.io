<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>08_glm_logistic.utf8.md</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<!DOCTYPE html>
<head>
<!-- Favicon for various operating systems -->
<link rel="apple-touch-icon" sizes="180x180" href="./favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="./favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="./favicon/favicon-16x16.png">
<!-- <link rel="manifest" href="./favicon/site.webmanifest"> -->
<link rel="mask-icon" href="./favicon/safari-pinned-tab.svg" color="#603cba">
<link rel="shortcut icon" href="./favicon/favicon.ico">
<meta name="msapplication-TileColor" content="#603cba">
<meta name="msapplication-config" content="./favicon/browserconfig.xml">
<meta name="theme-color" content="#382121">
</head>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { background-color: #f8f8f8; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="..\..\styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<div class="container-fluid main-container">

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->





<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">BIOL 678</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Teaching
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../../teaching.html">Teaching home</a>
    </li>
    <li>
      <a href="../../classes/BIOL217/index.html">BIOL 217</a>
    </li>
    <li>
      <a href="../../classes/BIOL678/index.html">BIOL 678</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../research.html">Research</a>
</li>
<li>
  <a href="../../studentProjects.html">Current Students</a>
</li>
<li>
  <a href="../../publications.html">Publications</a>
</li>
<li>
  <a href="../../cv.html">CV</a>
</li>
<li>
  <a href="../../contact.html">Contact</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/danStich">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<div id="generalized-linear-models-logistic-regression" class="section level1">
<h1>Generalized linear models: logistic regression</h1>
<p><img src="../../images/veligers.jpg" alt=""></p>
<h2 id="multi">
Introduction
</h2>
<p>This week we will start to dive into the world of generalized linear models and their implementation and interpretation in R. Before we can do that, we will talk about why we might like to use these methods, and the fact that the GLM actually represents a broad class of models that are highly flexible and incredibly useful. By the end of this week, we want you to be thinking of this as a kind of “go-to” tool for modeling complex, real-world (a.k.a. “messy”) data. Then, we will continue to layer complexity on this framework to extend it further over the next couple of weeks before we leave linearized modeling behind for a while.</p>
<div id="assumptions-of-linear-models" class="section level2">
<h2>Assumptions of linear models</h2>
<p>Wait, what? I thought we were talking about GLMs this week? We are. The first thing you need to know is that linear models are just a special case of the GLM. That is, the linear model assumes a certain error distribution (the normal) that helps things work smoothly and correctly. The next few weeks of class are all about relaxing the assumptions of linear models so we can actually use them in the real world.</p>
<p>Let’s take another look at the assumptions of linear models:</p>
<p>Here are the basic assumptions that we explicitly make when we use linear models, just in case you’ve forgotten them:</p>

<ol style="list-style-type: decimal">
<li>Residuals are normally distributed with a mean of zero</li>
</ol>

<ol start="2" style="list-style-type: decimal">
<li>Independence of observations (residuals)
<ul>
<li>Colinearity</li>
<li>Auto correlation of errors (e.g., spatial &amp; temporal)</li>
</ul></li>
</ol>

<ol start="3" style="list-style-type: decimal">
<li>Homoscedasticity</li>
</ol>

<ol start="4" style="list-style-type: decimal">
<li>Linear relationship between X and Y</li>
</ol>
<div id="assumption-1-normality-of-residuals" class="section level3">
<h3>Assumption 1: normality of residuals</h3>
<p>We’ve seen these before, but let’s recap. For assumption 1, we are assuming a couple of implicit things: 1. The variable is <em>continuous</em> (it must be if it’s error structure is normal), and 2. The error in our model is normally distributed. In reality, this is probably the least important assumption of linear models, and really only matters if we are trying to make predictions from the models that we make. Of course, we are often concerned with making predictions from the models that we make, so we can see why this might be important. However, more often we are in extreme violation of this assumption in some combination with assumption 4 above to such a degree that it actually does matter. For example, a response variable that is binomial (1 or zero) or multinomial in nature cannot possibly have normally distributed errors with respect to x unless there is absolutely no relationship between X and Y, right? So, if we wanted to predict the probability of patients dying from some medical treatment, or the presence/absence of species across a landscape then we <em>can’t</em> use linear models.</p>
</div>
<div id="assumption-2-independence-of-observations" class="section level3">
<h3>Assumption 2: independence of observations</h3>
<p>This time we’ve broken assumption 2 into two components: colinearity and autocorrelation of errors. Remember that the manifestation of these problems is in the precision of our coefficient estimates, and this has the potential to change the Type-I/II error rates in our models, causing us to draw false conclusions about which variables are important. As we discussed earlier in the course we expect to see some colinearity between observations, and we can deal with balancing this in our modeling through the use of model selection techniques to reduce Type-I and Type-II error. In the next couple of weeks, we will examine tools that will help us determine whether or not colinearity is actually causing problems in our models that go beyond minor nuisances. As for the second part, autocorrelation, we can actually look at formulations of the GLM that use ‘generalized least squares’ to include auto-regressive correlation matrices in our analysis that will allow us to relax this assumption of linear models and improve the precision of our parameter estimates.</p>
</div>
<div id="assumption-3-homoscedasticity" class="section level3">
<h3>Assumption 3: homoscedasticity</h3>
<p>Previously, we looked at ways to reduce this issue by introducing blocking (categorical) variables to our models. During the coming weeks, we will look at models that allow us to relax this assumption further through the use of weighted least squares and random effects, which can be applied to a wide range of regression methods from linear models to GLMs and GLMMs.</p>
</div>
<div id="assumption-4-linearity-and-additivity" class="section level3">
<h3>Assumption 4: linearity and additivity</h3>
<p>We’ve already looked at a couple of ways to deal with violations of these two assumptions such as data transformation and/or polynomial formulations of the linear model. We will continue to apply these concepts during the next several weeks.</p>
</div>
</div>
<div id="introducing-the-glm" class="section level2">
<h2>Introducing the GLM</h2>
<p>There are a number of situations that should just scream “<strong>GLM!!!</strong>” at you. The majority of these are easy to identify because you will know right away that the response variable in which you are interested is clearly not a continuous or normally distributed variable. This is the number one reason for moving into the GLM framework for most people.</p>
<p>The standard GLM consists of three major components:</p>

<ol style="list-style-type: decimal">
<li>A random variable (Y) that is our response of interest,</li>
</ol>

<ol start="2" style="list-style-type: decimal">
<li>Linear predictor(s) of Y, called X, and</li>
</ol>

<ol start="3" style="list-style-type: decimal">
<li>A invertible “link function” that transforms the expectation of Y to the linear predictor(s)</li>
</ol>
<p>The first two components are familiar to us. They are the EXACT SAME basic components of ANY regression formula that takes the following form:</p>
<p><span class="math inline">\(Y_{i,j} = \beta_0 + \beta_j \cdot X_{i,j}\)</span>, or <span class="math inline">\(Y = mX + b\)</span>, if you prefer</p>
<p>So, this much should be familiar. The major change from the linear models with which we have been working is the addition of this invertible linearizing link function, and it is the component from which the GLM inherits its name. The link function is just a way for us to put the expectation of the response within the context of an asymptotically normal distribution so that we can relax the assumptions of the linear model to accomodate new data types. In essence, it is very similar to the kinds of transformations that we talked about earlier in the semester, but is used during estimation rather than before hand.</p>
<p>To solve for the coefficients (betas) of a GLM, we move fully into the realm of maximum likelihood, with which you are all familiar. A given link function is used for the corresponding distribution that we assume for our data set, and a likelihood for that distribution can be defined such that we can calculate the likelihood of the data given our parameter estimates in a manner similar to the method we used for the standard normal distribution earlier this semester. Within this framework, we input different values (or guesses) about the parameter values that maximize the likelihood of our data one step at a time. Once the change in likelihood becomes sufficiently small, we accept that the algorithm has ‘converged’ on the optimal estimates for our model parameters (our <span class="math inline">\(\beta_{i,j}\)</span>), and the algorithm stops. You do not need to be able to do this by hand (thank goodness for R!), but you do need to understand what is going on so you can troubleshoot when R says that the model failed to converge…it will happen.</p>
<p>Let’s take a look at a few variable types that we might consider to be common applications for GLM in biology and ecology. We will cover each of these below in detail, here is a list so you know what is coming:</p>

<ol style="list-style-type: decimal">
<li>Binary response</li>
</ol>

<ol start="2" style="list-style-type: decimal">
<li>Count data (Poisson)</li>
</ol>

<ol start="3" style="list-style-type: decimal">
<li>Overdispersed count data (negative binomial)</li>
</ol>
</div>
<div id="binary-logistic-regression" class="section level2">
<h2>Binary (logistic) regression</h2>
<p>Logistic regression generally is reserved for the case in which we have a binary response that, by definition, can take on values of 1 or 0. These values can be expressed as outcoms of individual trials (Bernoulli) or as outcomes of some number of trials (Binomial- last week). These data types are common in biological and ecological data analyses, and thus it is important that you understand how to analyze these data when you encounter them- <strong>linear models will not accommodate this data type</strong>. The easiest way to look at what is going on is to use a worked example.</p>
<p>Let’s read in another smolt data set that we have not yet played with</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">choice =<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;StillwaterChoiceData.csv&#39;</span>)</a></code></pre></div>
<p>Look at the first few rows of data</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">head</span>(choice)</a>
<a class="sourceLine" id="cb2-2" title="2">  path year hatchery length mass date flow</a>
<a class="sourceLine" id="cb2-3" title="3"><span class="dv">1</span>    <span class="dv">0</span> <span class="dv">2010</span>        <span class="dv">1</span>    <span class="dv">176</span>   <span class="dv">57</span>  <span class="dv">118</span>  <span class="dv">345</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="dv">2</span>    <span class="dv">0</span> <span class="dv">2005</span>        <span class="dv">1</span>    <span class="dv">205</span>  <span class="dv">101</span>  <span class="dv">128</span> <span class="dv">1093</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="dv">3</span>    <span class="dv">0</span> <span class="dv">2010</span>        <span class="dv">1</span>    <span class="dv">180</span>   <span class="dv">56</span>  <span class="dv">118</span>  <span class="dv">345</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="dv">4</span>    <span class="dv">0</span> <span class="dv">2010</span>        <span class="dv">1</span>    <span class="dv">193</span>   <span class="dv">74</span>  <span class="dv">118</span>  <span class="dv">345</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="dv">5</span>    <span class="dv">0</span> <span class="dv">2005</span>        <span class="dv">1</span>    <span class="dv">189</span>   <span class="dv">76</span>  <span class="dv">128</span> <span class="dv">1093</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="dv">6</span>    <span class="dv">0</span> <span class="dv">2010</span>        <span class="dv">1</span>    <span class="dv">180</span>   <span class="dv">65</span>  <span class="dv">118</span>  <span class="dv">345</span></a></code></pre></div>
<div id="data-explanation" class="section level3">
<h3>Data Explanation</h3>
<p>These data are from a study that examined factors affecting path choice by wild and hatchery-reared endangered Atlantic salmon smolts during seaward migration in the Penobscot River, Maine. State, local, and federal fishery managers were interested in understanding what factors affected migratory routing through the lower river because there were different numbers of dams, with different estimated smolt mortality rates, on either side of a large island hydropower project in this system. If managers could understand factors influencing migratory route, they might be able to manipulate flows, stocking dates, and dam operation to improve survival of these endangered fish. Furthermore, the results of the study were used to predict the effects of dam removal, and hydropower re-allocation in the lower river on population-level consequences for these fish. These data were part of a larger analysis:</p>
<p>Stich, D. S., M. M. Bailey, and J. D. Zydlewski. 2014. Survival of Atlantic salmon (<em>Salmo salar</em>) smolts through a hydropower complex. Journal of Fish Biology 85:1074-1096.</p>
<p>The data consist of the following variables:</p>
<pre><code>path:     The migratory route used by individual fish. The choices were
          main-stem of the river (0) or the Stillwater Branch (1) around the
          island.
year:     The year in which individual fish were tagged and relocated using
          acoustic telemetry.
hatchery: An indicator describing if fish were reared in the wild (0) or in
          the federal conservation hatchery (1)
length:   Fish length (in mm)
mass:     Fish mass (in grams)
date:     Ordinal date on which the fish entered the hydrocomplex determined
          from time-stamps on acoustic receivers
flow:     Discharge recorded at the USGS gauge in the headpond of the dam
          several kilometers upstream of the hydropower complex.</code></pre>
<p><strong>NOTE:</strong> the results of this analysis won’t look like the results from the paper just yet. We will talk about why in a couple of weeks when we introduce generalized linear mixed models.</p>
</div>
<div id="data-analysis" class="section level3">
<h3>Data analysis</h3>
<h4 id="multi">
Maximum likelihood estimation
</h4>
<p>We are going to use the 1/0 binary data to estimate the effects of a number of covariates of interest on the probability that an individual fish used the Stillwater Branch for migration in each year of this study using logistic regression.</p>
<p>In order to do this, we will use the ‘logit’ link function, which can be defined as:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">logit =<span class="st"> </span><span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb4-2" title="2">  <span class="kw">log</span>(x <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>x))</a>
<a class="sourceLine" id="cb4-3" title="3">}</a></code></pre></div>
<p>The inverse of the logit function is:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">invlogit =<span class="st"> </span><span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb5-2" title="2">  <span class="kw">exp</span>(x) <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(x))</a>
<a class="sourceLine" id="cb5-3" title="3">}</a></code></pre></div>
<p>Since we are interested in the fixed effects of year, and not the linear trend through time, we need to convert year to factor</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">choice<span class="op">$</span>year =<span class="st"> </span><span class="kw">as.factor</span>(choice<span class="op">$</span>year)</a></code></pre></div>
<p>Define a set of models based on <em>a priori</em> combinations of explanatory variables.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># First, make an empty list to hold the models</span></a>
<a class="sourceLine" id="cb7-2" title="2">  mods=<span class="kw">list</span>()</a>
<a class="sourceLine" id="cb7-3" title="3">  </a>
<a class="sourceLine" id="cb7-4" title="4"><span class="co"># Now, fill the list with several a priori models</span></a>
<a class="sourceLine" id="cb7-5" title="5">  mods[[<span class="dv">1</span>]]=<span class="kw">glm</span>(path<span class="op">~</span>year<span class="op">+</span>hatchery<span class="op">+</span>length<span class="op">+</span>flow,<span class="dt">family=</span>binomial, <span class="dt">data=</span>choice)</a>
<a class="sourceLine" id="cb7-6" title="6">  mods[[<span class="dv">2</span>]]=<span class="kw">glm</span>(path<span class="op">~</span>year<span class="op">+</span>flow,<span class="dt">family=</span>binomial, <span class="dt">data=</span>choice)</a>
<a class="sourceLine" id="cb7-7" title="7">  mods[[<span class="dv">3</span>]]=<span class="kw">glm</span>(path<span class="op">~</span>year<span class="op">+</span>hatchery,<span class="dt">family=</span>binomial, <span class="dt">data=</span>choice)</a>
<a class="sourceLine" id="cb7-8" title="8">  mods[[<span class="dv">4</span>]]=<span class="kw">glm</span>(path<span class="op">~</span>year<span class="op">+</span>length,<span class="dt">family=</span>binomial, <span class="dt">data=</span>choice)</a>
<a class="sourceLine" id="cb7-9" title="9">  mods[[<span class="dv">5</span>]]=<span class="kw">glm</span>(path<span class="op">~</span>year<span class="op">+</span>length<span class="op">+</span>hatchery,<span class="dt">family=</span>binomial, <span class="dt">data=</span>choice)</a>
<a class="sourceLine" id="cb7-10" title="10">  mods[[<span class="dv">6</span>]]=<span class="kw">glm</span>(path<span class="op">~</span>year<span class="op">+</span>length<span class="op">+</span>flow,<span class="dt">family=</span>binomial, <span class="dt">data=</span>choice)</a>
<a class="sourceLine" id="cb7-11" title="11">  mods[[<span class="dv">7</span>]]=<span class="kw">glm</span>(path<span class="op">~</span>year<span class="op">+</span>hatchery<span class="op">+</span>flow,<span class="dt">family=</span>binomial, <span class="dt">data=</span>choice)</a></code></pre></div>
<p>Give the models some names using the formulas for each of the models. <strong>Remember</strong>: models are stored as list objects in R, and each of those list objects (models) has names. We can reference those names using the <code>$</code> notation:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="st"> </span><span class="kw">length</span>(mods)){</a>
<a class="sourceLine" id="cb8-2" title="2">  <span class="kw">names</span>(mods)[i] =<span class="st"> </span><span class="kw">as.character</span>(mods[[i]]<span class="op">$</span>call<span class="op">$</span>formula)[<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb8-3" title="3">}</a></code></pre></div>
<p>Now, we use the <code>AICcmodavg</code> package to make a model selection table like we did last week:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co"># Load the library</span></a>
<a class="sourceLine" id="cb9-2" title="2">  <span class="kw">library</span>(AICcmodavg)</a>
<a class="sourceLine" id="cb9-3" title="3"></a>
<a class="sourceLine" id="cb9-4" title="4"><span class="co"># Make the model selection table</span></a>
<a class="sourceLine" id="cb9-5" title="5">  table =<span class="st"> </span><span class="kw">aictab</span>( <span class="dt">cand.set =</span> mods, <span class="dt">modnames =</span> <span class="kw">names</span>(mods) )</a></code></pre></div>
<div id="interpreting-the-results" class="section level5">
<h5>Interpreting the results</h5>
<p>This pretty much proceeds the same way for GLM as it does for linear models until we get to making predictions of the response based on our best model.</p>
<p>Our model selection table is an object in R (<em>right</em>?), and we can reference that object using <code>$</code> notation, matrix notation <code>[ , ]</code>, or by calling rownames to get the index for each of the models. Let’s use this approach to get the best model from our candidate set. Here is a worked example in the code that follows:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="co"># Print the table</span></a>
<a class="sourceLine" id="cb10-2" title="2">  table</a>
<a class="sourceLine" id="cb10-3" title="3"></a>
<a class="sourceLine" id="cb10-4" title="4">Model selection based on AICc<span class="op">:</span></a>
<a class="sourceLine" id="cb10-5" title="5"></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="st">                                </span>K   AICc Delta_AICc AICcWt Cum.Wt      LL</a>
<a class="sourceLine" id="cb10-7" title="7">year <span class="op">+</span><span class="st"> </span>flow                     <span class="dv">7</span> <span class="fl">565.16</span>       <span class="fl">0.00</span>   <span class="fl">0.31</span>   <span class="fl">0.31</span> <span class="fl">-275.51</span></a>
<a class="sourceLine" id="cb10-8" title="8">year <span class="op">+</span><span class="st"> </span>hatchery <span class="op">+</span><span class="st"> </span>flow          <span class="dv">8</span> <span class="fl">565.23</span>       <span class="fl">0.07</span>   <span class="fl">0.30</span>   <span class="fl">0.61</span> <span class="fl">-274.52</span></a>
<a class="sourceLine" id="cb10-9" title="9">year <span class="op">+</span><span class="st"> </span>length <span class="op">+</span><span class="st"> </span>flow            <span class="dv">8</span> <span class="fl">565.91</span>       <span class="fl">0.75</span>   <span class="fl">0.21</span>   <span class="fl">0.82</span> <span class="fl">-274.86</span></a>
<a class="sourceLine" id="cb10-10" title="10">year <span class="op">+</span><span class="st"> </span>hatchery <span class="op">+</span><span class="st"> </span>length <span class="op">+</span><span class="st"> </span>flow <span class="dv">9</span> <span class="fl">567.12</span>       <span class="fl">1.96</span>   <span class="fl">0.12</span>   <span class="fl">0.93</span> <span class="fl">-274.44</span></a>
<a class="sourceLine" id="cb10-11" title="11">year <span class="op">+</span><span class="st"> </span>hatchery                 <span class="dv">7</span> <span class="fl">569.50</span>       <span class="fl">4.34</span>   <span class="fl">0.04</span>   <span class="fl">0.97</span> <span class="fl">-277.68</span></a>
<a class="sourceLine" id="cb10-12" title="12">year <span class="op">+</span><span class="st"> </span>length                   <span class="dv">7</span> <span class="fl">570.80</span>       <span class="fl">5.64</span>   <span class="fl">0.02</span>   <span class="fl">0.99</span> <span class="fl">-278.33</span></a>
<a class="sourceLine" id="cb10-13" title="13">year <span class="op">+</span><span class="st"> </span>length <span class="op">+</span><span class="st"> </span>hatchery        <span class="dv">8</span> <span class="fl">571.37</span>       <span class="fl">6.21</span>   <span class="fl">0.01</span>   <span class="fl">1.00</span> <span class="fl">-277.59</span></a>
<a class="sourceLine" id="cb10-14" title="14"><span class="co"># Look at the structure just to show that it is, indeed, an object:</span></a>
<a class="sourceLine" id="cb10-15" title="15">  <span class="kw">str</span>(table)</a>
<a class="sourceLine" id="cb10-16" title="16">Classes <span class="st">&#39;aictab&#39;</span> and <span class="st">&#39;data.frame&#39;</span><span class="op">:</span><span class="st">  </span><span class="dv">7</span> obs. of  <span class="dv">8</span> variables<span class="op">:</span></a>
<a class="sourceLine" id="cb10-17" title="17"><span class="st"> </span><span class="er">$</span><span class="st"> </span>Modnames  <span class="op">:</span><span class="st"> </span>Factor w<span class="op">/</span><span class="st"> </span><span class="dv">7</span> levels <span class="st">&quot;year + flow&quot;</span>,..<span class="op">:</span><span class="st"> </span><span class="dv">1</span> <span class="dv">3</span> <span class="dv">6</span> <span class="dv">4</span> <span class="dv">2</span> <span class="dv">5</span> <span class="dv">7</span></a>
<a class="sourceLine" id="cb10-18" title="18"> <span class="op">$</span><span class="st"> </span>K         <span class="op">:</span><span class="st"> </span>num  <span class="dv">7</span> <span class="dv">8</span> <span class="dv">8</span> <span class="dv">9</span> <span class="dv">7</span> <span class="dv">7</span> <span class="dv">8</span></a>
<a class="sourceLine" id="cb10-19" title="19"> <span class="op">$</span><span class="st"> </span>AICc      <span class="op">:</span><span class="st"> </span>num  <span class="dv">565</span> <span class="dv">565</span> <span class="dv">566</span> <span class="dv">567</span> <span class="dv">570</span> ...</a>
<a class="sourceLine" id="cb10-20" title="20"> <span class="op">$</span><span class="st"> </span>Delta_AICc<span class="op">:</span><span class="st"> </span>num  <span class="dv">0</span> <span class="fl">0.0674</span> <span class="fl">0.7506</span> <span class="fl">1.9557</span> <span class="fl">4.3408</span> ...</a>
<a class="sourceLine" id="cb10-21" title="21"> <span class="op">$</span><span class="st"> </span>ModelLik  <span class="op">:</span><span class="st"> </span>num  <span class="dv">1</span> <span class="fl">0.967</span> <span class="fl">0.687</span> <span class="fl">0.376</span> <span class="fl">0.114</span> ...</a>
<a class="sourceLine" id="cb10-22" title="22"> <span class="op">$</span><span class="st"> </span>AICcWt    <span class="op">:</span><span class="st"> </span>num  <span class="fl">0.3078</span> <span class="fl">0.2976</span> <span class="fl">0.2115</span> <span class="fl">0.1158</span> <span class="fl">0.0351</span> ...</a>
<a class="sourceLine" id="cb10-23" title="23"> <span class="op">$</span><span class="st"> </span>LL        <span class="op">:</span><span class="st"> </span>num  <span class="dv">-276</span> <span class="dv">-275</span> <span class="dv">-275</span> <span class="dv">-274</span> <span class="dv">-278</span> ...</a>
<a class="sourceLine" id="cb10-24" title="24"> <span class="op">$</span><span class="st"> </span>Cum.Wt    <span class="op">:</span><span class="st"> </span>num  <span class="fl">0.308</span> <span class="fl">0.605</span> <span class="fl">0.817</span> <span class="fl">0.933</span> <span class="fl">0.968</span> ...</a></code></pre></div>
<p>Look at the rownames of the table. These rownames are the index for each of our models as they appear in the <code>mods</code> object, and we can use the index to reference objects inside of the <code>mods</code> list…</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">rownames</span>(table)</a>
<a class="sourceLine" id="cb11-2" title="2">[<span class="dv">1</span>] <span class="st">&quot;2&quot;</span> <span class="st">&quot;7&quot;</span> <span class="st">&quot;6&quot;</span> <span class="st">&quot;1&quot;</span> <span class="st">&quot;3&quot;</span> <span class="st">&quot;4&quot;</span> <span class="st">&quot;5&quot;</span></a></code></pre></div>
<p>This tells us that the rowname for the best model (the one at the top of the table) is #2. That means that our best model is stored in position 2 of our model list that we named ‘mods’. Let’s double check it to make sure:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">mods[[<span class="dv">2</span>]]</a>
<a class="sourceLine" id="cb12-2" title="2"></a>
<a class="sourceLine" id="cb12-3" title="3">Call<span class="op">:</span><span class="st">  </span><span class="kw">glm</span>(<span class="dt">formula =</span> path <span class="op">~</span><span class="st"> </span>year <span class="op">+</span><span class="st"> </span>flow, <span class="dt">family =</span> binomial, <span class="dt">data =</span> choice)</a>
<a class="sourceLine" id="cb12-4" title="4"></a>
<a class="sourceLine" id="cb12-5" title="5">Coefficients<span class="op">:</span></a>
<a class="sourceLine" id="cb12-6" title="6">(Intercept)     year2006     year2009     year2010     year2011     year2012         flow  </a>
<a class="sourceLine" id="cb12-7" title="7">  <span class="fl">-2.911624</span>    <span class="fl">-0.518632</span>     <span class="fl">0.243194</span>    <span class="fl">-0.043979</span>    <span class="fl">-0.814334</span>    <span class="fl">-0.764289</span>     <span class="fl">0.001642</span>  </a>
<a class="sourceLine" id="cb12-8" title="8"></a>
<a class="sourceLine" id="cb12-9" title="9">Degrees of Freedom<span class="op">:</span><span class="st"> </span><span class="dv">758</span> <span class="kw">Total</span> (i.e. Null);  <span class="dv">752</span> Residual</a>
<a class="sourceLine" id="cb12-10" title="10">Null Deviance<span class="op">:</span><span class="st">      </span><span class="fl">580.2</span> </a>
<a class="sourceLine" id="cb12-11" title="11">Residual Deviance<span class="op">:</span><span class="st"> </span><span class="dv">551</span>  AIC<span class="op">:</span><span class="st"> </span><span class="dv">565</span></a></code></pre></div>
<p>This looks pretty darn good! We could also do a summary of the model to get the coefficient estimates and the significance codes for the estimated coefficients:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">summary</span>(mods[[<span class="dv">2</span>]])</a>
<a class="sourceLine" id="cb13-2" title="2"></a>
<a class="sourceLine" id="cb13-3" title="3">Call<span class="op">:</span></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="kw">glm</span>(<span class="dt">formula =</span> path <span class="op">~</span><span class="st"> </span>year <span class="op">+</span><span class="st"> </span>flow, <span class="dt">family =</span> binomial, <span class="dt">data =</span> choice)</a>
<a class="sourceLine" id="cb13-5" title="5"></a>
<a class="sourceLine" id="cb13-6" title="6">Deviance Residuals<span class="op">:</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-7" title="7"><span class="st">    </span>Min       1Q   Median       3Q      Max  </a>
<a class="sourceLine" id="cb13-8" title="8"><span class="fl">-1.2183</span>  <span class="fl">-0.5757</span>  <span class="fl">-0.4401</span>  <span class="fl">-0.3564</span>   <span class="fl">2.4577</span>  </a>
<a class="sourceLine" id="cb13-9" title="9"></a>
<a class="sourceLine" id="cb13-10" title="10">Coefficients<span class="op">:</span></a>
<a class="sourceLine" id="cb13-11" title="11"><span class="st">              </span>Estimate Std. Error z value <span class="kw">Pr</span>(<span class="op">&gt;</span><span class="er">|</span>z<span class="op">|</span>)    </a>
<a class="sourceLine" id="cb13-12" title="12">(Intercept) <span class="fl">-2.9116243</span>  <span class="fl">0.7981931</span>  <span class="fl">-3.648</span> <span class="fl">0.000265</span> <span class="op">**</span><span class="er">*</span></a>
<a class="sourceLine" id="cb13-13" title="13">year2006    <span class="fl">-0.5186319</span>  <span class="fl">0.6237029</span>  <span class="fl">-0.832</span> <span class="fl">0.405671</span>    </a>
<a class="sourceLine" id="cb13-14" title="14">year2009     <span class="fl">0.2431939</span>  <span class="fl">0.4615202</span>   <span class="fl">0.527</span> <span class="fl">0.598235</span>    </a>
<a class="sourceLine" id="cb13-15" title="15">year2010    <span class="fl">-0.0439789</span>  <span class="fl">0.6525993</span>  <span class="fl">-0.067</span> <span class="fl">0.946271</span>    </a>
<a class="sourceLine" id="cb13-16" title="16">year2011    <span class="fl">-0.8143343</span>  <span class="fl">0.4029438</span>  <span class="fl">-2.021</span> <span class="fl">0.043284</span> <span class="op">*</span><span class="st">  </span></a>
<a class="sourceLine" id="cb13-17" title="17">year2012    <span class="fl">-0.7642890</span>  <span class="fl">0.5137641</span>  <span class="fl">-1.488</span> <span class="fl">0.136849</span>    </a>
<a class="sourceLine" id="cb13-18" title="18">flow         <span class="fl">0.0016416</span>  <span class="fl">0.0006195</span>   <span class="fl">2.650</span> <span class="fl">0.008052</span> <span class="op">**</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-19" title="19"><span class="op">---</span></a>
<a class="sourceLine" id="cb13-20" title="20">Signif. codes<span class="op">:</span><span class="st">  </span><span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb13-21" title="21"></a>
<a class="sourceLine" id="cb13-22" title="22">(Dispersion parameter <span class="cf">for</span> binomial family taken to be <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb13-23" title="23"></a>
<a class="sourceLine" id="cb13-24" title="24">    Null deviance<span class="op">:</span><span class="st"> </span><span class="fl">580.15</span>  on <span class="dv">758</span>  degrees of freedom</a>
<a class="sourceLine" id="cb13-25" title="25">Residual deviance<span class="op">:</span><span class="st"> </span><span class="fl">551.01</span>  on <span class="dv">752</span>  degrees of freedom</a>
<a class="sourceLine" id="cb13-26" title="26">AIC<span class="op">:</span><span class="st"> </span><span class="fl">565.01</span></a>
<a class="sourceLine" id="cb13-27" title="27"></a>
<a class="sourceLine" id="cb13-28" title="28">Number of Fisher Scoring iterations<span class="op">:</span><span class="st"> </span><span class="dv">5</span></a></code></pre></div>
<p>Cool!! But, what if we wanted the script to always grab the summary of the top model in our model selection table no matter what the rowname was? That is, what if the rowname was subject to change with collection of further data in the future and we want our code to be flexible? Well, in that case, we could do this:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">summary</span>( mods[[ <span class="kw">as.numeric</span>(<span class="kw">rownames</span>(table[<span class="dv">1</span>, ])) ]] )</a>
<a class="sourceLine" id="cb14-2" title="2"></a>
<a class="sourceLine" id="cb14-3" title="3">Call<span class="op">:</span></a>
<a class="sourceLine" id="cb14-4" title="4"><span class="kw">glm</span>(<span class="dt">formula =</span> path <span class="op">~</span><span class="st"> </span>year <span class="op">+</span><span class="st"> </span>flow, <span class="dt">family =</span> binomial, <span class="dt">data =</span> choice)</a>
<a class="sourceLine" id="cb14-5" title="5"></a>
<a class="sourceLine" id="cb14-6" title="6">Deviance Residuals<span class="op">:</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-7" title="7"><span class="st">    </span>Min       1Q   Median       3Q      Max  </a>
<a class="sourceLine" id="cb14-8" title="8"><span class="fl">-1.2183</span>  <span class="fl">-0.5757</span>  <span class="fl">-0.4401</span>  <span class="fl">-0.3564</span>   <span class="fl">2.4577</span>  </a>
<a class="sourceLine" id="cb14-9" title="9"></a>
<a class="sourceLine" id="cb14-10" title="10">Coefficients<span class="op">:</span></a>
<a class="sourceLine" id="cb14-11" title="11"><span class="st">              </span>Estimate Std. Error z value <span class="kw">Pr</span>(<span class="op">&gt;</span><span class="er">|</span>z<span class="op">|</span>)    </a>
<a class="sourceLine" id="cb14-12" title="12">(Intercept) <span class="fl">-2.9116243</span>  <span class="fl">0.7981931</span>  <span class="fl">-3.648</span> <span class="fl">0.000265</span> <span class="op">**</span><span class="er">*</span></a>
<a class="sourceLine" id="cb14-13" title="13">year2006    <span class="fl">-0.5186319</span>  <span class="fl">0.6237029</span>  <span class="fl">-0.832</span> <span class="fl">0.405671</span>    </a>
<a class="sourceLine" id="cb14-14" title="14">year2009     <span class="fl">0.2431939</span>  <span class="fl">0.4615202</span>   <span class="fl">0.527</span> <span class="fl">0.598235</span>    </a>
<a class="sourceLine" id="cb14-15" title="15">year2010    <span class="fl">-0.0439789</span>  <span class="fl">0.6525993</span>  <span class="fl">-0.067</span> <span class="fl">0.946271</span>    </a>
<a class="sourceLine" id="cb14-16" title="16">year2011    <span class="fl">-0.8143343</span>  <span class="fl">0.4029438</span>  <span class="fl">-2.021</span> <span class="fl">0.043284</span> <span class="op">*</span><span class="st">  </span></a>
<a class="sourceLine" id="cb14-17" title="17">year2012    <span class="fl">-0.7642890</span>  <span class="fl">0.5137641</span>  <span class="fl">-1.488</span> <span class="fl">0.136849</span>    </a>
<a class="sourceLine" id="cb14-18" title="18">flow         <span class="fl">0.0016416</span>  <span class="fl">0.0006195</span>   <span class="fl">2.650</span> <span class="fl">0.008052</span> <span class="op">**</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-19" title="19"><span class="op">---</span></a>
<a class="sourceLine" id="cb14-20" title="20">Signif. codes<span class="op">:</span><span class="st">  </span><span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb14-21" title="21"></a>
<a class="sourceLine" id="cb14-22" title="22">(Dispersion parameter <span class="cf">for</span> binomial family taken to be <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb14-23" title="23"></a>
<a class="sourceLine" id="cb14-24" title="24">    Null deviance<span class="op">:</span><span class="st"> </span><span class="fl">580.15</span>  on <span class="dv">758</span>  degrees of freedom</a>
<a class="sourceLine" id="cb14-25" title="25">Residual deviance<span class="op">:</span><span class="st"> </span><span class="fl">551.01</span>  on <span class="dv">752</span>  degrees of freedom</a>
<a class="sourceLine" id="cb14-26" title="26">AIC<span class="op">:</span><span class="st"> </span><span class="fl">565.01</span></a>
<a class="sourceLine" id="cb14-27" title="27"></a>
<a class="sourceLine" id="cb14-28" title="28">Number of Fisher Scoring iterations<span class="op">:</span><span class="st"> </span><span class="dv">5</span></a></code></pre></div>
<p>Here we are asking for the rowname of the first row in our model selection table. We have to convert that to a number from a character string to reference the index in the mods list, and then we can summarize the best model. Another way to do this is:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="co"># First, get the number corresponding to the list index for the best</span></a>
<a class="sourceLine" id="cb15-2" title="2"><span class="co"># model in the candidate set</span></a>
<a class="sourceLine" id="cb15-3" title="3">  best =<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">rownames</span>(table[<span class="dv">1</span>, ]))</a>
<a class="sourceLine" id="cb15-4" title="4"></a>
<a class="sourceLine" id="cb15-5" title="5"><span class="co"># Now, get the summary for the model in mods that was the best</span></a>
<a class="sourceLine" id="cb15-6" title="6">  <span class="kw">summary</span>( mods[[best]] )</a>
<a class="sourceLine" id="cb15-7" title="7"></a>
<a class="sourceLine" id="cb15-8" title="8">Call<span class="op">:</span></a>
<a class="sourceLine" id="cb15-9" title="9"><span class="kw">glm</span>(<span class="dt">formula =</span> path <span class="op">~</span><span class="st"> </span>year <span class="op">+</span><span class="st"> </span>flow, <span class="dt">family =</span> binomial, <span class="dt">data =</span> choice)</a>
<a class="sourceLine" id="cb15-10" title="10"></a>
<a class="sourceLine" id="cb15-11" title="11">Deviance Residuals<span class="op">:</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-12" title="12"><span class="st">    </span>Min       1Q   Median       3Q      Max  </a>
<a class="sourceLine" id="cb15-13" title="13"><span class="fl">-1.2183</span>  <span class="fl">-0.5757</span>  <span class="fl">-0.4401</span>  <span class="fl">-0.3564</span>   <span class="fl">2.4577</span>  </a>
<a class="sourceLine" id="cb15-14" title="14"></a>
<a class="sourceLine" id="cb15-15" title="15">Coefficients<span class="op">:</span></a>
<a class="sourceLine" id="cb15-16" title="16"><span class="st">              </span>Estimate Std. Error z value <span class="kw">Pr</span>(<span class="op">&gt;</span><span class="er">|</span>z<span class="op">|</span>)    </a>
<a class="sourceLine" id="cb15-17" title="17">(Intercept) <span class="fl">-2.9116243</span>  <span class="fl">0.7981931</span>  <span class="fl">-3.648</span> <span class="fl">0.000265</span> <span class="op">**</span><span class="er">*</span></a>
<a class="sourceLine" id="cb15-18" title="18">year2006    <span class="fl">-0.5186319</span>  <span class="fl">0.6237029</span>  <span class="fl">-0.832</span> <span class="fl">0.405671</span>    </a>
<a class="sourceLine" id="cb15-19" title="19">year2009     <span class="fl">0.2431939</span>  <span class="fl">0.4615202</span>   <span class="fl">0.527</span> <span class="fl">0.598235</span>    </a>
<a class="sourceLine" id="cb15-20" title="20">year2010    <span class="fl">-0.0439789</span>  <span class="fl">0.6525993</span>  <span class="fl">-0.067</span> <span class="fl">0.946271</span>    </a>
<a class="sourceLine" id="cb15-21" title="21">year2011    <span class="fl">-0.8143343</span>  <span class="fl">0.4029438</span>  <span class="fl">-2.021</span> <span class="fl">0.043284</span> <span class="op">*</span><span class="st">  </span></a>
<a class="sourceLine" id="cb15-22" title="22">year2012    <span class="fl">-0.7642890</span>  <span class="fl">0.5137641</span>  <span class="fl">-1.488</span> <span class="fl">0.136849</span>    </a>
<a class="sourceLine" id="cb15-23" title="23">flow         <span class="fl">0.0016416</span>  <span class="fl">0.0006195</span>   <span class="fl">2.650</span> <span class="fl">0.008052</span> <span class="op">**</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-24" title="24"><span class="op">---</span></a>
<a class="sourceLine" id="cb15-25" title="25">Signif. codes<span class="op">:</span><span class="st">  </span><span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb15-26" title="26"></a>
<a class="sourceLine" id="cb15-27" title="27">(Dispersion parameter <span class="cf">for</span> binomial family taken to be <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb15-28" title="28"></a>
<a class="sourceLine" id="cb15-29" title="29">    Null deviance<span class="op">:</span><span class="st"> </span><span class="fl">580.15</span>  on <span class="dv">758</span>  degrees of freedom</a>
<a class="sourceLine" id="cb15-30" title="30">Residual deviance<span class="op">:</span><span class="st"> </span><span class="fl">551.01</span>  on <span class="dv">752</span>  degrees of freedom</a>
<a class="sourceLine" id="cb15-31" title="31">AIC<span class="op">:</span><span class="st"> </span><span class="fl">565.01</span></a>
<a class="sourceLine" id="cb15-32" title="32"></a>
<a class="sourceLine" id="cb15-33" title="33">Number of Fisher Scoring iterations<span class="op">:</span><span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb15-34" title="34">  </a>
<a class="sourceLine" id="cb15-35" title="35"><span class="co"># Since this is really THE SAME THING AS ANCOVA we can use the Anova</span></a>
<a class="sourceLine" id="cb15-36" title="36"><span class="co"># function from the &#39;car&#39; library to get an ANCOVA summary for the</span></a>
<a class="sourceLine" id="cb15-37" title="37"><span class="co"># model to look at significance of our main effects:</span></a>
<a class="sourceLine" id="cb15-38" title="38">  <span class="kw">library</span>(car)</a>
<a class="sourceLine" id="cb15-39" title="39">  <span class="kw">Anova</span>(mods[[best]], <span class="dt">Type=</span><span class="st">&#39;III&#39;</span>)</a>
<a class="sourceLine" id="cb15-40" title="40">Analysis of Deviance <span class="kw">Table</span> (Type II tests)</a>
<a class="sourceLine" id="cb15-41" title="41"></a>
<a class="sourceLine" id="cb15-42" title="42">Response<span class="op">:</span><span class="st"> </span>path</a>
<a class="sourceLine" id="cb15-43" title="43">     LR Chisq Df <span class="kw">Pr</span>(<span class="op">&gt;</span>Chisq)   </a>
<a class="sourceLine" id="cb15-44" title="44">year  <span class="fl">12.8043</span>  <span class="dv">5</span>   <span class="fl">0.025283</span> <span class="op">*</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-45" title="45">flow   <span class="fl">7.4471</span>  <span class="dv">1</span>   <span class="fl">0.006354</span> <span class="op">**</span></a>
<a class="sourceLine" id="cb15-46" title="46"><span class="op">---</span></a>
<a class="sourceLine" id="cb15-47" title="47">Signif. codes<span class="op">:</span><span class="st">  </span><span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></a></code></pre></div>
<p>Here, we see that there are signigicant effects of both year and flow on our response, path choice.</p>
</div>
<div id="making-predictions-about-the-effect-of-x-on-y." class="section level5">
<h5>Making predictions about the effect of x on y.</h5>
<p>The first thing to remember here is that we have used a link function to estimate this model, so we cannot use the same method as before to make predictions about our response from the model coefficients.</p>
<p>The second thing to remember here is that by definition we have used an <em>invertible</em> link function to estimate this model so the previous statement is a lie and we actually can use the same method as before to make predictions about our response from the model coefficients. We just need to add an extra step so that we can invert our predictions about the expected value of Y with respect to X.</p>
<p>Confused? Yeah, it’s a little confusing. A worked example always goes a long way…</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="co"># Let&#39;s start by grabbing the summary for our best model</span></a>
<a class="sourceLine" id="cb16-2" title="2">  c.res =<span class="st"> </span><span class="kw">data.frame</span>( <span class="kw">summary</span>(mods[[best]])<span class="op">$</span>coefficients )</a>
<a class="sourceLine" id="cb16-3" title="3"></a>
<a class="sourceLine" id="cb16-4" title="4"><span class="co"># Now we can look at the coefficient estimates</span></a>
<a class="sourceLine" id="cb16-5" title="5">  c.res</a>
<a class="sourceLine" id="cb16-6" title="6">                Estimate   Std..Error     z.value     Pr...z..</a>
<a class="sourceLine" id="cb16-7" title="7">(Intercept) <span class="fl">-2.911624325</span> <span class="fl">0.7981931477</span> <span class="fl">-3.64776913</span> <span class="fl">0.0002645272</span></a>
<a class="sourceLine" id="cb16-8" title="8">year2006    <span class="fl">-0.518631856</span> <span class="fl">0.6237029032</span> <span class="fl">-0.83153670</span> <span class="fl">0.4056705026</span></a>
<a class="sourceLine" id="cb16-9" title="9">year2009     <span class="fl">0.243193850</span> <span class="fl">0.4615202282</span>  <span class="fl">0.52694083</span> <span class="fl">0.5982346820</span></a>
<a class="sourceLine" id="cb16-10" title="10">year2010    <span class="fl">-0.043978930</span> <span class="fl">0.6525992875</span> <span class="fl">-0.06739041</span> <span class="fl">0.9462709073</span></a>
<a class="sourceLine" id="cb16-11" title="11">year2011    <span class="fl">-0.814334317</span> <span class="fl">0.4029437518</span> <span class="fl">-2.02096276</span> <span class="fl">0.0432836201</span></a>
<a class="sourceLine" id="cb16-12" title="12">year2012    <span class="fl">-0.764288967</span> <span class="fl">0.5137640800</span> <span class="fl">-1.48762632</span> <span class="fl">0.1368494687</span></a>
<a class="sourceLine" id="cb16-13" title="13">flow         <span class="fl">0.001641583</span> <span class="fl">0.0006194926</span>  <span class="fl">2.64988401</span> <span class="fl">0.0080519409</span></a>
<a class="sourceLine" id="cb16-14" title="14"></a>
<a class="sourceLine" id="cb16-15" title="15"><span class="co"># Then, we can make some predictions</span></a>
<a class="sourceLine" id="cb16-16" title="16"><span class="co"># First, let&#39;s just look at the effect of flow.</span></a>
<a class="sourceLine" id="cb16-17" title="17"><span class="co"># We will do this by hand.</span></a>
<a class="sourceLine" id="cb16-18" title="18">  <span class="co"># Make a new sequence of flow along</span></a>
<a class="sourceLine" id="cb16-19" title="19">  <span class="co"># which we will make our predictions</span></a>
<a class="sourceLine" id="cb16-20" title="20">    newFlow =<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="kw">min</span>(choice<span class="op">$</span>flow),</a>
<a class="sourceLine" id="cb16-21" title="21">                  <span class="dt">to =</span> <span class="kw">max</span>(choice<span class="op">$</span>flow),</a>
<a class="sourceLine" id="cb16-22" title="22">                  <span class="dt">by =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb16-23" title="23"></a>
<a class="sourceLine" id="cb16-24" title="24">  <span class="co"># Now make predictions for the year 2005 using flow:</span></a>
<a class="sourceLine" id="cb16-25" title="25">    c.pred =<span class="st"> </span>c.res[<span class="dv">1</span>, <span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>c.res[<span class="dv">7</span>, <span class="dv">1</span>]<span class="op">*</span>newFlow</a>
<a class="sourceLine" id="cb16-26" title="26"></a>
<a class="sourceLine" id="cb16-27" title="27">  <span class="co"># Let&#39;s look at these predictions:</span></a>
<a class="sourceLine" id="cb16-28" title="28">    <span class="kw">hist</span>(c.pred)</a></code></pre></div>
<p><img src="08_glm_logistic_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>Well, this does not look very informative does it? And, actually, it should not. What we <em>should</em> take away from this is that these cannot possibly be predictions about the probability of using the Stillwater Branch because there are numbers that are less than zero! Why is this? It is because we need to transform these estimates back on to the probability scale from the logit scale on which we are working. We will use the <code>invlogit</code> function that we defined above to put these estimates back on the probability scale.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="co"># Invert the logit on our predictions</span></a>
<a class="sourceLine" id="cb17-2" title="2">  c.pred  =<span class="st"> </span><span class="kw">invlogit</span>(c.pred)</a>
<a class="sourceLine" id="cb17-3" title="3"></a>
<a class="sourceLine" id="cb17-4" title="4"><span class="co"># Now, let&#39;s take a look:</span></a>
<a class="sourceLine" id="cb17-5" title="5">  <span class="kw">hist</span>(c.pred)</a></code></pre></div>
<p><img src="08_glm_logistic_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1"></a>
<a class="sourceLine" id="cb18-2" title="2"><span class="co"># You can see that, in general, there is a relatively low probability of</span></a>
<a class="sourceLine" id="cb18-3" title="3"><span class="co"># an individual fish using the Stillwater branch, now let&#39;s make a</span></a>
<a class="sourceLine" id="cb18-4" title="4"><span class="co"># figure that shows how this changes with flow:</span></a>
<a class="sourceLine" id="cb18-5" title="5">  <span class="kw">plot</span>(<span class="dt">x=</span>choice<span class="op">$</span>flow, <span class="dt">y=</span>choice<span class="op">$</span>path,</a>
<a class="sourceLine" id="cb18-6" title="6">       <span class="dt">xlab=</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&#39;Flow (&#39;</span>,<span class="st">&#39;ft&#39;</span><span class="op">^</span><span class="st">&#39;3&#39;</span>,<span class="st">&#39;\u00b7&#39;</span>,<span class="st">&#39;s&#39;</span><span class="op">^</span><span class="st">&#39;-1&#39;</span>,<span class="st">&#39; )&#39;</span>)),</a>
<a class="sourceLine" id="cb18-7" title="7">       <span class="dt">ylab =</span> <span class="st">&quot;p(Stillwater Branch | flow)&quot;</span>,</a>
<a class="sourceLine" id="cb18-8" title="8">       <span class="dt">yaxt=</span><span class="st">&#39;n&#39;</span>)</a>
<a class="sourceLine" id="cb18-9" title="9">  <span class="kw">lines</span>(<span class="dt">x=</span>newFlow, <span class="dt">y=</span>c.pred, <span class="dt">type=</span><span class="st">&#39;l&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>,  <span class="dt">yaxt=</span><span class="st">&#39;n&#39;</span>)</a>
<a class="sourceLine" id="cb18-10" title="10">  <span class="kw">axis</span>(<span class="dv">2</span>, <span class="dt">las=</span><span class="dv">2</span>)</a></code></pre></div>
<p><img src="08_glm_logistic_files/figure-html/unnamed-chunk-18-2.png" width="672" /></p>
<p>Now, you can see that there is an increasing probability of using the Stillwater Branch with increasing flow. Looking at the plot of the raw data, you can see 1) why we need models to look at trends like these, and 2) why it is important to provide visual aids to assist with the interpretation of your results.</p>
<p>If we wanted to, we could go on to make predictions like we did with linear models, one for each year with respect to flow, or we could use our fitted data to show trends. We could do this either using the method I have just demonstrated, or…</p>
<p>We could do this using the <code>predict</code> function in R like we did with linear models.</p>
<p><strong>Example</strong>: predict effect of flow on mean probability of using Stillwater Branch by year.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="co"># Create new flow data:</span></a>
<a class="sourceLine" id="cb19-2" title="2">  flow =<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from=</span><span class="kw">min</span>(choice<span class="op">$</span>flow), <span class="dt">to=</span><span class="kw">max</span>(choice<span class="op">$</span>flow), <span class="dt">by=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb19-3" title="3"></a>
<a class="sourceLine" id="cb19-4" title="4"><span class="co"># Create new data for years:</span></a>
<a class="sourceLine" id="cb19-5" title="5">  year =<span class="st"> </span><span class="kw">sort</span>( <span class="kw">rep</span>(<span class="kw">unique</span>(choice<span class="op">$</span>year), <span class="kw">length</span>(newFlow)) )</a>
<a class="sourceLine" id="cb19-6" title="6">  </a>
<a class="sourceLine" id="cb19-7" title="7"><span class="co"># Now repeat the flow vector for each year</span></a>
<a class="sourceLine" id="cb19-8" title="8">  flow=<span class="kw">rep</span>(flow, <span class="kw">length</span>(<span class="kw">unique</span>(year)))</a>
<a class="sourceLine" id="cb19-9" title="9">  </a>
<a class="sourceLine" id="cb19-10" title="10"><span class="co"># Smoosh them together into a dataframe for prediction</span></a>
<a class="sourceLine" id="cb19-11" title="11">  newD =<span class="st"> </span><span class="kw">data.frame</span>(flow, year)</a>
<a class="sourceLine" id="cb19-12" title="12"></a>
<a class="sourceLine" id="cb19-13" title="13"><span class="co"># Make predictions: WE DON&#39;T NEED TO INVERT THE PREDICTIONS FROM THE</span></a>
<a class="sourceLine" id="cb19-14" title="14"><span class="co"># PREDICT.GLM FUNCTION IF WE SPECIFY &quot; type = &#39;response&#39; &quot;</span></a>
<a class="sourceLine" id="cb19-15" title="15">  predicted =<span class="st"> </span><span class="kw">predict</span>(<span class="dt">object =</span> mods[[best]],</a>
<a class="sourceLine" id="cb19-16" title="16">                      <span class="dt">newdata =</span> newD,</a>
<a class="sourceLine" id="cb19-17" title="17">                      <span class="dt">type=</span><span class="st">&#39;response&#39;</span>)</a></code></pre></div>
<p>Now, plot the predictions by year:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1"><span class="co"># Add the raw data</span></a>
<a class="sourceLine" id="cb20-2" title="2">  <span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb20-3" title="3">  <span class="kw">plot</span>(<span class="dt">x=</span>choice<span class="op">$</span>flow,</a>
<a class="sourceLine" id="cb20-4" title="4">       <span class="dt">y=</span>choice<span class="op">$</span>path,</a>
<a class="sourceLine" id="cb20-5" title="5">       <span class="dt">xlab=</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&#39;Flow ( &#39;</span>,<span class="st">&#39;m&#39;</span><span class="op">^</span><span class="st">&#39;3&#39;</span>,<span class="st">&#39;\u00b7&#39;</span>,<span class="st">&#39;s&#39;</span><span class="op">^</span><span class="st">&#39;-1&#39;</span>,<span class="st">&#39; )&#39;</span>)),</a>
<a class="sourceLine" id="cb20-6" title="6">       <span class="dt">ylab =</span> <span class="st">&quot;p(Stillwater Branch | flow)&quot;</span>,</a>
<a class="sourceLine" id="cb20-7" title="7">       <span class="dt">yaxt=</span><span class="st">&#39;n&#39;</span>,</a>
<a class="sourceLine" id="cb20-8" title="8">       <span class="dt">pch=</span><span class="dv">21</span>,</a>
<a class="sourceLine" id="cb20-9" title="9">       <span class="dt">col=</span> <span class="kw">heat.colors</span>(<span class="kw">length</span>(<span class="kw">unique</span>(choice<span class="op">$</span>year)))[choice<span class="op">$</span>year]</a>
<a class="sourceLine" id="cb20-10" title="10">  )</a>
<a class="sourceLine" id="cb20-11" title="11">  <span class="kw">axis</span>(<span class="dv">2</span>, <span class="dt">las=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb20-12" title="12">  </a>
<a class="sourceLine" id="cb20-13" title="13"><span class="co"># Then we could use a loop to go through each year and plot</span></a>
<a class="sourceLine" id="cb20-14" title="14"><span class="co"># the predictions:</span></a>
<a class="sourceLine" id="cb20-15" title="15">    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">unique</span>(year))){</a>
<a class="sourceLine" id="cb20-16" title="16">      <span class="kw">lines</span>(<span class="dt">x =</span> flow[year<span class="op">==</span><span class="kw">unique</span>(year)[i]],</a>
<a class="sourceLine" id="cb20-17" title="17">            <span class="dt">y =</span> predicted[year<span class="op">==</span><span class="kw">unique</span>(year)[i]],</a>
<a class="sourceLine" id="cb20-18" title="18">            <span class="dt">col=</span> <span class="kw">heat.colors</span>(<span class="kw">length</span>(<span class="kw">unique</span>(year)))[i]</a>
<a class="sourceLine" id="cb20-19" title="19">            )</a>
<a class="sourceLine" id="cb20-20" title="20">    }</a></code></pre></div>
<p><img src="08_glm_logistic_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>Alternatively, we could plot these one year at a time so we can show the uncertainty in our estimates, like this:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1"><span class="co"># Make predictions from the model and the new data defined above,</span></a>
<a class="sourceLine" id="cb21-2" title="2"><span class="co"># this time specifying that we would also like to get standard</span></a>
<a class="sourceLine" id="cb21-3" title="3"><span class="co"># errors for our estimates (se.fit = TRUE)</span></a>
<a class="sourceLine" id="cb21-4" title="4">  predicted =<span class="st"> </span><span class="kw">predict</span>(<span class="dt">object =</span> mods[[best]],</a>
<a class="sourceLine" id="cb21-5" title="5">                      <span class="dt">newdata =</span> newD,</a>
<a class="sourceLine" id="cb21-6" title="6">                      <span class="dt">type=</span><span class="st">&#39;link&#39;</span>,</a>
<a class="sourceLine" id="cb21-7" title="7">                      <span class="dt">se.fit =</span> <span class="ot">TRUE</span>)  </a></code></pre></div>
<p>The resulting object is a list. Our prediction (fit) and the SE for those predictions are in the first and second elements of that list. We can turn them into a dataframe like this:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1">  preds =<span class="st"> </span><span class="kw">data.frame</span>(predicted[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>])</a>
<a class="sourceLine" id="cb22-2" title="2"></a>
<a class="sourceLine" id="cb22-3" title="3"><span class="co"># Then, using our dataframe, we can calculate Wald 95%</span></a>
<a class="sourceLine" id="cb22-4" title="4"><span class="co"># confidence intervals around our predictions by multiplying</span></a>
<a class="sourceLine" id="cb22-5" title="5"><span class="co"># by the critical values for our quantiles and we store them</span></a>
<a class="sourceLine" id="cb22-6" title="6"><span class="co"># in new columns in our dataframe</span></a>
<a class="sourceLine" id="cb22-7" title="7">  preds<span class="op">$</span>lwr =<span class="st"> </span>preds<span class="op">$</span>fit <span class="op">+</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.025</span>)<span class="op">*</span>preds<span class="op">$</span>se.fit</a>
<a class="sourceLine" id="cb22-8" title="8">  preds<span class="op">$</span>upr =<span class="st"> </span>preds<span class="op">$</span>fit <span class="op">+</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.975</span>)<span class="op">*</span>preds<span class="op">$</span>se.fit</a>
<a class="sourceLine" id="cb22-9" title="9"></a>
<a class="sourceLine" id="cb22-10" title="10"><span class="co"># We just need to convert these to the probability scale now</span></a>
<a class="sourceLine" id="cb22-11" title="11"><span class="co"># using our invlogit function that we defined above</span></a>
<a class="sourceLine" id="cb22-12" title="12">  preds[ , <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">4</span>)] &lt;-<span class="st"> </span><span class="kw">apply</span>(<span class="dt">X=</span>preds[ , <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">4</span>)],</a>
<a class="sourceLine" id="cb22-13" title="13">                              <span class="dt">MARGIN=</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb22-14" title="14">                              <span class="dt">FUN=</span>invlogit)</a>
<a class="sourceLine" id="cb22-15" title="15"></a>
<a class="sourceLine" id="cb22-16" title="16"><span class="co"># We can combine this dataframe with our newD dataframe:</span></a>
<a class="sourceLine" id="cb22-17" title="17">  preds =<span class="st"> </span><span class="kw">data.frame</span>(newD, preds)</a>
<a class="sourceLine" id="cb22-18" title="18">  </a>
<a class="sourceLine" id="cb22-19" title="19"><span class="co"># Now, we make predictions for a specific year of interest</span></a>
<a class="sourceLine" id="cb22-20" title="20">  </a>
<a class="sourceLine" id="cb22-21" title="21">  pred05 &lt;-<span class="st"> </span>preds[<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(preds[preds<span class="op">$</span>year<span class="op">==</span><span class="dv">2005</span>, ]) , ]</a>
<a class="sourceLine" id="cb22-22" title="22">  </a>
<a class="sourceLine" id="cb22-23" title="23">  <span class="kw">plot</span>(<span class="dt">x=</span>pred05<span class="op">$</span>flow[pred05<span class="op">$</span>year<span class="op">==</span><span class="dv">2005</span>],</a>
<a class="sourceLine" id="cb22-24" title="24">       <span class="dt">y=</span>pred05[,<span class="dv">3</span>], <span class="dt">type=</span><span class="st">&#39;l&#39;</span>,</a>
<a class="sourceLine" id="cb22-25" title="25">       <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">col=</span><span class="st">&#39;black&#39;</span>, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb22-26" title="26">       <span class="dt">xlab=</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&#39;Flow ( &#39;</span>,<span class="st">&#39;m&#39;</span><span class="op">^</span><span class="st">&#39;3&#39;</span>,<span class="st">&#39;\u00b7&#39;</span>,<span class="st">&#39;s&#39;</span><span class="op">^</span><span class="st">&#39;-1&#39;</span>,<span class="st">&#39; )&#39;</span>)),</a>
<a class="sourceLine" id="cb22-27" title="27">       <span class="dt">ylab =</span> <span class="st">&quot;p(Stillwater Branch | flow)&quot;</span></a>
<a class="sourceLine" id="cb22-28" title="28">       )</a>
<a class="sourceLine" id="cb22-29" title="29">  <span class="kw">lines</span>(<span class="dt">x=</span>pred05<span class="op">$</span>flow[pred05<span class="op">$</span>year<span class="op">==</span><span class="dv">2005</span>],  <span class="dt">y=</span>pred05[,<span class="dv">5</span>],</a>
<a class="sourceLine" id="cb22-30" title="30">        <span class="dt">type=</span><span class="st">&#39;l&#39;</span>, <span class="dt">lty=</span><span class="dv">2</span>, <span class="dt">col=</span><span class="st">&#39;black&#39;</span>)</a>
<a class="sourceLine" id="cb22-31" title="31">  <span class="kw">lines</span>(<span class="dt">x=</span>pred05<span class="op">$</span>flow[pred05<span class="op">$</span>year<span class="op">==</span><span class="dv">2005</span>],  <span class="dt">y=</span>pred05[,<span class="dv">6</span>],</a>
<a class="sourceLine" id="cb22-32" title="32">        <span class="dt">type=</span><span class="st">&#39;l&#39;</span>, <span class="dt">lty=</span><span class="dv">2</span>, <span class="dt">col=</span><span class="st">&#39;black&#39;</span>)</a></code></pre></div>
<p><img src="08_glm_logistic_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
</div>
<div id="bayesian-estimation" class="section level4">
<h4>Bayesian estimation</h4>
<p>We can also fit this logistic regression model using Bayesian estimation methods, and we should be able to obtain similar results. But, in this analytical framework it is easy to start looking at interactions (for example) between year and flow. In this context, we might wish to allow the effect of flow to be the same across years (main effects model), or we may wish to allow the influence of flow to vary between years. We will consider both (interaction).</p>
<div id="main-effects-model" class="section level5">
<h5>Main effects model</h5>
<p>This model is the equivalent of running the following line of code in R:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1"><span class="kw">glm</span>(path<span class="op">~</span>year<span class="op">+</span>flow, <span class="dt">family=</span><span class="st">&#39;binomial&#39;</span>, <span class="dt">data=</span>choice)</a></code></pre></div>
<p>We start by writing down our likelihood and our model. Here, we are saying that the observed successess and failures are drawn from a Bernoulli density with some probability of success (recall that the Bernoulli is just a special case of the binomial). We evaluate the likelihood for each individual observation and some value of <span class="math inline">\(p\)</span>, or probability of using the Stillwater Branch. This is the only parameter in the Bernoulli distribution, so our likelihood looks like:</p>
<p><span class="math display">\[C_i = Bernoulli(p_i)\]</span></p>
<p>The probability of using the Stillwater Branch is modeled as a linear function of alpha, beta, and observed flow in the river using the logit link function. Formally, we would write this as:</p>
<p><span class="math display">\[logit(p_i) = \alpha_j\ + \beta_1 \cdot Flow_i\]</span></p>
<p>or</p>
<p><span class="math display">\[logit(p_i) = \beta_{0j}\ + \beta_1 \cdot X_1\]</span></p>
<p>Now, we can write the model in BUGS language:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1">modelstring=<span class="st">&quot;                 </span></a>
<a class="sourceLine" id="cb24-2" title="2"><span class="st">  model {                       </span></a>
<a class="sourceLine" id="cb24-3" title="3"><span class="st">    # Likelihood</span></a>
<a class="sourceLine" id="cb24-4" title="4"><span class="st">      for(i in 1:nobs){          </span></a>
<a class="sourceLine" id="cb24-5" title="5"><span class="st">        C[i] ~ dbern(p[i])</span></a>
<a class="sourceLine" id="cb24-6" title="6"><span class="st">        logit(p[i]) &lt;- alpha[year[i]] + beta*flow[i]</span></a>
<a class="sourceLine" id="cb24-7" title="7"><span class="st">      }                         </span></a>
<a class="sourceLine" id="cb24-8" title="8"></a>
<a class="sourceLine" id="cb24-9" title="9"><span class="st">    # Priors</span></a>
<a class="sourceLine" id="cb24-10" title="10"><span class="st">      for(j in 1:nyears){</span></a>
<a class="sourceLine" id="cb24-11" title="11"><span class="st">        alpha[j] ~ dnorm(0, 0.01)</span></a>
<a class="sourceLine" id="cb24-12" title="12"><span class="st">      }</span></a>
<a class="sourceLine" id="cb24-13" title="13"></a>
<a class="sourceLine" id="cb24-14" title="14"><span class="st">      beta ~ dnorm(0, 0.01)               </span></a>
<a class="sourceLine" id="cb24-15" title="15"><span class="st">  }                             </span></a>
<a class="sourceLine" id="cb24-16" title="16"><span class="st">&quot;</span>                               </a>
<a class="sourceLine" id="cb24-17" title="17"><span class="kw">writeLines</span>(modelstring,<span class="dt">con=</span><span class="st">&quot;choice.txt&quot;</span>)</a></code></pre></div>
<p>Note that in this case, we have a separate value of alpha for each year, but only a single value of beta. This is akin to the ANCOVA that you have been working with, albeit computationally simpler, and implies that we are only looking at main effects.</p>
<p>Now, we go through our usual steps of packaging the data, specifying initial values, declaring parameters to be monitored, and specifying MCMC settings before we finally run our model:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1"><span class="co"># Package the data in a list</span></a>
<a class="sourceLine" id="cb25-2" title="2">  choice.data =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb25-3" title="3">    <span class="dt">nobs =</span> <span class="kw">nrow</span>(choice),</a>
<a class="sourceLine" id="cb25-4" title="4">    <span class="dt">C =</span> choice<span class="op">$</span>path,</a>
<a class="sourceLine" id="cb25-5" title="5">    <span class="dt">year =</span> <span class="kw">as.numeric</span>(<span class="kw">as.factor</span>(choice<span class="op">$</span>year)),</a>
<a class="sourceLine" id="cb25-6" title="6">    <span class="dt">nyears =</span> <span class="kw">length</span>(<span class="kw">unique</span>(choice<span class="op">$</span>year)),</a>
<a class="sourceLine" id="cb25-7" title="7">    <span class="dt">flow =</span> choice<span class="op">$</span>flow</a>
<a class="sourceLine" id="cb25-8" title="8">  )</a>
<a class="sourceLine" id="cb25-9" title="9"></a>
<a class="sourceLine" id="cb25-10" title="10"><span class="co"># Parameters monitored</span></a>
<a class="sourceLine" id="cb25-11" title="11">  parameters &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&#39;beta&#39;</span>)</a>
<a class="sourceLine" id="cb25-12" title="12"></a>
<a class="sourceLine" id="cb25-13" title="13"><span class="co"># Initial values</span></a>
<a class="sourceLine" id="cb25-14" title="14">  inits &lt;-<span class="st"> </span><span class="cf">function</span>(){<span class="kw">list</span>(</a>
<a class="sourceLine" id="cb25-15" title="15">    <span class="dt">alpha=</span><span class="kw">rnorm</span>(<span class="kw">length</span>(<span class="kw">unique</span>(choice<span class="op">$</span>year)),<span class="dv">0</span>,<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb25-16" title="16">    <span class="dt">beta=</span> <span class="kw">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb25-17" title="17">    )}</a>
<a class="sourceLine" id="cb25-18" title="18"></a>
<a class="sourceLine" id="cb25-19" title="19"><span class="co"># MCMC settings</span></a>
<a class="sourceLine" id="cb25-20" title="20">  ni &lt;-<span class="st"> </span><span class="dv">7500</span>     <span class="co"># Number of draws from posterior</span></a>
<a class="sourceLine" id="cb25-21" title="21">  nt &lt;-<span class="st"> </span><span class="dv">3</span>         <span class="co"># Thinning rate</span></a>
<a class="sourceLine" id="cb25-22" title="22">  nb &lt;-<span class="st"> </span><span class="dv">2500</span>      <span class="co"># Number of draws to discard as burn-in</span></a>
<a class="sourceLine" id="cb25-23" title="23">  nc &lt;-<span class="st"> </span><span class="dv">3</span>         <span class="co"># Number of chains</span></a></code></pre></div>
<p>Finally, we can run the model.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1"><span class="co"># Load the R2jags package</span></a>
<a class="sourceLine" id="cb26-2" title="2">  <span class="kw">library</span>(R2jags)</a>
<a class="sourceLine" id="cb26-3" title="3"></a>
<a class="sourceLine" id="cb26-4" title="4"><span class="co"># Call jags and run the model. </span></a>
<a class="sourceLine" id="cb26-5" title="5"><span class="co"># Note the use of inits=NULL because JAGS is</span></a>
<a class="sourceLine" id="cb26-6" title="6"><span class="co"># being really picky and won&#39;t take mine.</span></a>
<a class="sourceLine" id="cb26-7" title="7">  choice.model &lt;-<span class="st"> </span><span class="kw">jags</span>(choice.data, <span class="dt">inits=</span><span class="ot">NULL</span>, parameters, <span class="st">&quot;choice.txt&quot;</span>,</a>
<a class="sourceLine" id="cb26-8" title="8">    <span class="dt">n.chains =</span> nc, <span class="dt">n.thin =</span> nt, <span class="dt">n.iter =</span> ni, <span class="dt">n.burnin =</span> nb,</a>
<a class="sourceLine" id="cb26-9" title="9">    <span class="dt">working.directory =</span> <span class="kw">getwd</span>())</a></code></pre></div>
<p>And, print the model results.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1"><span class="kw">print</span>(choice.model, <span class="dt">digits=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb27-2" title="2">Inference <span class="cf">for</span> Bugs model at <span class="st">&quot;choice.txt&quot;</span>, fit using jags,</a>
<a class="sourceLine" id="cb27-3" title="3"> <span class="dv">3</span> chains, each with <span class="dv">7500</span> <span class="kw">iterations</span> (first <span class="dv">2500</span> discarded), n.thin =<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb27-4" title="4"> n.sims =<span class="st"> </span><span class="dv">5001</span> iterations saved</a>
<a class="sourceLine" id="cb27-5" title="5">         mu.vect sd.vect   <span class="fl">2.5</span><span class="op">%    25%</span><span class="st">    </span><span class="dv">50</span><span class="op">%    75%</span><span class="st">  </span><span class="fl">97.5</span>% Rhat n.eff</a>
<a class="sourceLine" id="cb27-6" title="6">alpha[<span class="dv">1</span>]   <span class="fl">-2.91</span>    <span class="fl">0.79</span>  <span class="fl">-4.48</span>  <span class="fl">-3.44</span>  <span class="fl">-2.89</span>  <span class="fl">-2.37</span>  <span class="fl">-1.39</span> <span class="fl">1.00</span>  <span class="dv">5000</span></a>
<a class="sourceLine" id="cb27-7" title="7">alpha[<span class="dv">2</span>]   <span class="fl">-3.45</span>    <span class="fl">0.48</span>  <span class="fl">-4.43</span>  <span class="fl">-3.77</span>  <span class="fl">-3.46</span>  <span class="fl">-3.12</span>  <span class="fl">-2.53</span> <span class="fl">1.00</span>  <span class="dv">5000</span></a>
<a class="sourceLine" id="cb27-8" title="8">alpha[<span class="dv">3</span>]   <span class="fl">-2.66</span>    <span class="fl">0.53</span>  <span class="fl">-3.72</span>  <span class="fl">-3.02</span>  <span class="fl">-2.65</span>  <span class="fl">-2.31</span>  <span class="fl">-1.65</span> <span class="fl">1.00</span>  <span class="dv">5000</span></a>
<a class="sourceLine" id="cb27-9" title="9">alpha[<span class="dv">4</span>]   <span class="fl">-2.96</span>    <span class="fl">0.34</span>  <span class="fl">-3.64</span>  <span class="fl">-3.19</span>  <span class="fl">-2.96</span>  <span class="fl">-2.73</span>  <span class="fl">-2.32</span> <span class="fl">1.00</span>  <span class="dv">2800</span></a>
<a class="sourceLine" id="cb27-10" title="10">alpha[<span class="dv">5</span>]   <span class="fl">-3.71</span>    <span class="fl">0.79</span>  <span class="fl">-5.30</span>  <span class="fl">-4.24</span>  <span class="fl">-3.72</span>  <span class="fl">-3.16</span>  <span class="fl">-2.21</span> <span class="fl">1.00</span>  <span class="dv">5000</span></a>
<a class="sourceLine" id="cb27-11" title="11">alpha[<span class="dv">6</span>]   <span class="fl">-3.69</span>    <span class="fl">0.66</span>  <span class="fl">-4.99</span>  <span class="fl">-4.13</span>  <span class="fl">-3.69</span>  <span class="fl">-3.24</span>  <span class="fl">-2.44</span> <span class="fl">1.00</span>  <span class="dv">5000</span></a>
<a class="sourceLine" id="cb27-12" title="12">beta        <span class="fl">0.00</span>    <span class="fl">0.00</span>   <span class="fl">0.00</span>   <span class="fl">0.00</span>   <span class="fl">0.00</span>   <span class="fl">0.00</span>   <span class="fl">0.00</span> <span class="fl">1.00</span>  <span class="dv">5000</span></a>
<a class="sourceLine" id="cb27-13" title="13">deviance  <span class="fl">558.00</span>    <span class="fl">5.14</span> <span class="fl">552.71</span> <span class="fl">555.25</span> <span class="fl">557.24</span> <span class="fl">559.98</span> <span class="fl">566.75</span> <span class="fl">1.01</span>  <span class="dv">3300</span></a>
<a class="sourceLine" id="cb27-14" title="14"></a>
<a class="sourceLine" id="cb27-15" title="15">For each parameter, n.eff is a crude measure of effective sample size,</a>
<a class="sourceLine" id="cb27-16" title="16">and Rhat is the potential scale reduction <span class="kw">factor</span> (at convergence, <span class="dt">Rhat=</span><span class="dv">1</span>).</a>
<a class="sourceLine" id="cb27-17" title="17"></a>
<a class="sourceLine" id="cb27-18" title="18">DIC <span class="kw">info</span> (using the rule, <span class="dt">pD =</span> <span class="kw">var</span>(deviance)<span class="op">/</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb27-19" title="19">pD =<span class="st"> </span><span class="fl">13.2</span> and DIC =<span class="st"> </span><span class="fl">571.2</span></a>
<a class="sourceLine" id="cb27-20" title="20">DIC is an estimate of expected predictive <span class="kw">error</span> (lower deviance is better).</a></code></pre></div>
<p>This week in lab, you will explore tools for model diagnostics similar to those we did for general linear models. For now, we will just skip to the good stuff that’s not in your textbook this week!</p>
<p>First, let’s plot a histogram for our flow parameter to see if the 95% CRI contains zero.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" title="1"><span class="co"># Make a graph of the coefficient of flow</span></a>
<a class="sourceLine" id="cb28-2" title="2"><span class="co"># for significance testing</span></a>
<a class="sourceLine" id="cb28-3" title="3">  <span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))  </a>
<a class="sourceLine" id="cb28-4" title="4">  <span class="kw">hist</span>(choice.model<span class="op">$</span>BUGSoutput<span class="op">$</span>sims.list<span class="op">$</span>beta,</a>
<a class="sourceLine" id="cb28-5" title="5">       <span class="dt">col=</span><span class="st">&#39;gray87&#39;</span>,</a>
<a class="sourceLine" id="cb28-6" title="6">       <span class="dt">yaxt=</span><span class="st">&#39;n&#39;</span>,</a>
<a class="sourceLine" id="cb28-7" title="7">       <span class="dt">ylab=</span><span class="st">&#39;&#39;</span>,</a>
<a class="sourceLine" id="cb28-8" title="8">       <span class="dt">xlab=</span><span class="kw">expression</span>(beta),</a>
<a class="sourceLine" id="cb28-9" title="9">       <span class="dt">main=</span><span class="st">&#39;&#39;</span></a>
<a class="sourceLine" id="cb28-10" title="10">       )  </a>
<a class="sourceLine" id="cb28-11" title="11"><span class="co"># Add lines for mean and 95% CRI</span></a>
<a class="sourceLine" id="cb28-12" title="12">  <span class="kw">abline</span>(<span class="dt">v=</span><span class="kw">quantile</span>(choice.model<span class="op">$</span>BUGSoutput<span class="op">$</span>sims.list<span class="op">$</span>beta,</a>
<a class="sourceLine" id="cb28-13" title="13">                    <span class="dt">probs=</span><span class="kw">c</span>(<span class="fl">0.025</span>,<span class="fl">0.5</span>,<span class="fl">0.975</span>)),</a>
<a class="sourceLine" id="cb28-14" title="14">         <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&#39;red&#39;</span>, <span class="st">&#39;blue&#39;</span>, <span class="st">&#39;red&#39;</span>),</a>
<a class="sourceLine" id="cb28-15" title="15">         <span class="dt">lwd=</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb28-16" title="16">         <span class="dt">lty=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb28-17" title="17">         ) </a></code></pre></div>
<p><img src="08_glm_logistic_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>We see that the 95% CRI, indicated by the dashed red lines, does not contain zero, so we can conclude that there is a significant effect of flow. Now, let’s work on communicating those effect sizes:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1"><span class="co"># Make some predictions from the model</span></a>
<a class="sourceLine" id="cb29-2" title="2">  newflow =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">2000</span>,<span class="dv">100</span>)</a>
<a class="sourceLine" id="cb29-3" title="3"></a>
<a class="sourceLine" id="cb29-4" title="4"><span class="co"># Collect the posterior estimates. </span></a>
<a class="sourceLine" id="cb29-5" title="5"><span class="co"># Note that we take the mean of all alphas</span></a>
<a class="sourceLine" id="cb29-6" title="6"><span class="co"># so we can get a marginal effect size for flow.</span></a>
<a class="sourceLine" id="cb29-7" title="7">  alpha =<span class="st"> </span><span class="kw">apply</span>(choice.model<span class="op">$</span>BUGSoutput<span class="op">$</span>sims.list<span class="op">$</span>alpha,<span class="dv">1</span>, mean)</a>
<a class="sourceLine" id="cb29-8" title="8">  beta =<span class="st"> </span>choice.model<span class="op">$</span>BUGSoutput<span class="op">$</span>sims.list<span class="op">$</span>beta</a>
<a class="sourceLine" id="cb29-9" title="9">  </a>
<a class="sourceLine" id="cb29-10" title="10"><span class="co"># Predict probability of using</span></a>
<a class="sourceLine" id="cb29-11" title="11"><span class="co"># Stillwater given flow across years</span></a>
<a class="sourceLine" id="cb29-12" title="12">  <span class="co"># Make a blank matrix to hold the predictions</span></a>
<a class="sourceLine" id="cb29-13" title="13">  preds =<span class="st"> </span><span class="kw">matrix</span>(<span class="dt">data =</span> <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb29-14" title="14">                 <span class="dt">nrow=</span><span class="kw">length</span>(alpha),</a>
<a class="sourceLine" id="cb29-15" title="15">                 <span class="dt">ncol=</span><span class="kw">length</span>(newflow)</a>
<a class="sourceLine" id="cb29-16" title="16">                 )</a>
<a class="sourceLine" id="cb29-17" title="17">  <span class="co"># Now make predictions for each new</span></a>
<a class="sourceLine" id="cb29-18" title="18">  <span class="co"># value of flow from each of the</span></a>
<a class="sourceLine" id="cb29-19" title="19">  <span class="co"># MCMC samples of alpha and beta.</span></a>
<a class="sourceLine" id="cb29-20" title="20">  <span class="co"># These predictions are on the logit scale</span></a>
<a class="sourceLine" id="cb29-21" title="21">  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(alpha)){</a>
<a class="sourceLine" id="cb29-22" title="22">    <span class="cf">for</span>(t <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(newflow)){</a>
<a class="sourceLine" id="cb29-23" title="23">      preds[i, t] =<span class="st"> </span>alpha[i] <span class="op">+</span><span class="st"> </span>beta[i] <span class="op">*</span><span class="st"> </span>newflow[t]</a>
<a class="sourceLine" id="cb29-24" title="24">    }</a>
<a class="sourceLine" id="cb29-25" title="25">  }</a>
<a class="sourceLine" id="cb29-26" title="26"></a>
<a class="sourceLine" id="cb29-27" title="27"><span class="co"># Define a function to invert the logit</span></a>
<a class="sourceLine" id="cb29-28" title="28">  inv.logit=<span class="cf">function</span>(x){<span class="kw">exp</span>(x)<span class="op">/</span>(<span class="dv">1</span><span class="op">+</span><span class="kw">exp</span>(x))}</a>
<a class="sourceLine" id="cb29-29" title="29">  </a>
<a class="sourceLine" id="cb29-30" title="30"><span class="co"># Convert predictions from logit scale to probability scale</span></a>
<a class="sourceLine" id="cb29-31" title="31">  ppreds =<span class="st"> </span><span class="kw">apply</span>(preds, <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), inv.logit)</a>
<a class="sourceLine" id="cb29-32" title="32"></a>
<a class="sourceLine" id="cb29-33" title="33"><span class="co"># Plot the predictions</span></a>
<a class="sourceLine" id="cb29-34" title="34">  <span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb29-35" title="35">  <span class="kw">plot</span>(newflow, ppreds[<span class="dv">1</span>, ], <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb29-36" title="36">       <span class="dt">yaxt=</span><span class="st">&#39;n&#39;</span>,</a>
<a class="sourceLine" id="cb29-37" title="37">       <span class="dt">xlab=</span><span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&#39;Flow (m&#39;</span><span class="op">^</span><span class="st">&#39;3&#39;</span>,<span class="st">&#39;s&#39;</span><span class="op">^</span><span class="st">&#39;-1&#39;</span>,<span class="st">&#39;)&#39;</span>)),</a>
<a class="sourceLine" id="cb29-38" title="38">       <span class="dt">ylab=</span><span class="st">&#39;p(Stillwater | flow)&#39;</span>,</a>
<a class="sourceLine" id="cb29-39" title="39">       <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">2000</span>), <span class="dt">axes =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb29-40" title="40">       <span class="dt">type=</span><span class="st">&#39;l&#39;</span>, <span class="dt">col=</span><span class="kw">rgb</span>(.<span class="dv">7</span>,.<span class="dv">7</span>,.<span class="dv">7</span>,.<span class="dv">05</span>),</a>
<a class="sourceLine" id="cb29-41" title="41">       <span class="dt">main=</span><span class="st">&#39;&#39;</span>)</a>
<a class="sourceLine" id="cb29-42" title="42"><span class="co"># Plot the posterior predictions</span></a>
<a class="sourceLine" id="cb29-43" title="43">  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(alpha)){</a>
<a class="sourceLine" id="cb29-44" title="44">    <span class="kw">lines</span>(<span class="dt">x =</span> newflow, <span class="dt">y =</span> ppreds[i, ],</a>
<a class="sourceLine" id="cb29-45" title="45">          <span class="dt">col=</span><span class="kw">rgb</span>(.<span class="dv">7</span>,.<span class="dv">7</span>,.<span class="dv">7</span>,.<span class="dv">05</span>), <span class="dt">lwd=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb29-46" title="46">  }</a>
<a class="sourceLine" id="cb29-47" title="47"><span class="co"># Calculate the mean and 95% CRIs for posterior predictions</span></a>
<a class="sourceLine" id="cb29-48" title="48">  muPred =<span class="st"> </span><span class="kw">apply</span>(ppreds, <span class="dv">2</span>, mean)</a>
<a class="sourceLine" id="cb29-49" title="49">  lowPred =<span class="st"> </span><span class="kw">apply</span>(ppreds, <span class="dv">2</span>, quantile, <span class="dt">probs=</span><span class="fl">0.025</span>)</a>
<a class="sourceLine" id="cb29-50" title="50">  upPred =<span class="st"> </span><span class="kw">apply</span>(ppreds, <span class="dv">2</span>, quantile, <span class="dt">probs=</span><span class="fl">0.975</span>)</a>
<a class="sourceLine" id="cb29-51" title="51"><span class="co"># Plot the mean and 95% CRI for predicted probability</span></a>
<a class="sourceLine" id="cb29-52" title="52">  <span class="kw">lines</span>(newflow, muPred, <span class="dt">col=</span><span class="st">&#39;blue&#39;</span>, <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">lty=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb29-53" title="53">  <span class="kw">lines</span>(newflow, upPred, <span class="dt">col=</span><span class="st">&#39;red&#39;</span>, <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">lty=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb29-54" title="54">  <span class="kw">lines</span>(newflow, lowPred, <span class="dt">col=</span><span class="st">&#39;red&#39;</span>, <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">lty=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb29-55" title="55">  <span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">pos=</span><span class="dv">0</span>, <span class="dt">at=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">2000</span>,<span class="dv">250</span>), <span class="dt">labels=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">2000</span>,<span class="dv">250</span>))</a>
<a class="sourceLine" id="cb29-56" title="56">  <span class="kw">axis</span>(<span class="dv">2</span>, <span class="dt">pos=</span><span class="dv">0</span>, <span class="dt">las=</span><span class="dv">2</span>)</a></code></pre></div>
<p><img src="08_glm_logistic_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>Hopefully the power of these tools is starting to become evident as we broaden them to include more datatypes. We will continue to explore GLMs next week, and will extend this framework to include models for counts (of stuff or events) and to deal with overdispersed and zero-inflated counts.</p>
</div>
</div>
</div>
</div>
</div>

<!DOCTYPE html>

<br>

<hr>

<p style="color:gray; text-align:center">This work is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/legalcode">Creative Commons Attribution 4.0 International License</a>. Data are provided for educational purposes only unless otherwise noted.</p>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
