<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title></title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<!DOCTYPE html>
<head>
<!-- Favicon for various operating systems -->
<link rel="apple-touch-icon" sizes="180x180" href="./favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="./favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="./favicon/favicon-16x16.png">
<!-- <link rel="manifest" href="./favicon/site.webmanifest"> -->
<link rel="mask-icon" href="./favicon/safari-pinned-tab.svg" color="#603cba">
<link rel="shortcut icon" href="./favicon/favicon.ico">
<meta name="msapplication-TileColor" content="#603cba">
<meta name="msapplication-config" content="./favicon/browserconfig.xml">
<meta name="theme-color" content="#382121">
</head>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code > span.dt { color: #204a87; } /* DataType */
code > span.dv { color: #0000cf; } /* DecVal */
code > span.bn { color: #0000cf; } /* BaseN */
code > span.fl { color: #0000cf; } /* Float */
code > span.ch { color: #4e9a06; } /* Char */
code > span.st { color: #4e9a06; } /* String */
code > span.co { color: #8f5902; font-style: italic; } /* Comment */
code > span.ot { color: #8f5902; } /* Other */
code > span.al { color: #ef2929; } /* Alert */
code > span.fu { color: #000000; } /* Function */
code > span.er { color: #a40000; font-weight: bold; } /* Error */
code > span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #000000; } /* SpecialChar */
code > span.vs { color: #4e9a06; } /* VerbatimString */
code > span.ss { color: #4e9a06; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #000000; } /* Variable */
code > span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code > span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code > span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code > span.ex { } /* Extension */
code > span.at { color: #c4a000; } /* Attribute */
code > span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code > span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="..\..\styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">BIOL 678</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Teaching
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../../teaching.html">Teaching home</a>
    </li>
    <li>
      <a href="../../classes/BIOL217/index.html">BIOL 217</a>
    </li>
    <li>
      <a href="../../classes/BIOL678/index.html">BIOL 678</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../research.html">Research</a>
</li>
<li>
  <a href="../../studentProjects.html">Current Students</a>
</li>
<li>
  <a href="../../publications.html">Publications</a>
</li>
<li>
  <a href="../../cv.html">CV</a>
</li>
<li>
  <a href="../../contact.html">Contact</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/danStich">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<h1 id="multi">
Linear mixed models (LMM)
<h1>
<p><img src="../../images/yp.jpg" alt=""></p>
<h2 id="multi">
Introduction
</h2>
<p>We introduced the linear mixed model this week, and we looked at examples of how to incorporate random effects in our inference within both frequentist and Bayesian frameworks for analysis. We will continue to probe these tools in our lab exercise this week and build some comfort working with these hierarchical models. By the end of this lab, you should be comfortable 1) specifying random effects in models, 2) running those models using restricted maximum likelihood (REML) estimation and Bayesian hierarchical models, 3) graphically dsiplaying results, and 4) communicating the methods and the results of this work through technical writing.</p>
<p><strong>Note</strong>: these models require using some code that we have not covered explicitly in class. We will be working with uncorrelated random slopes and intercepts this week. These are covered in <strong>Chapter 12</strong> in Kery (2010). Specifically, the code and tutorial you will need are in <strong>12.4.1</strong> and <strong>12.4.2</strong>.</p>
<div id="the-data" class="section level2">
<h2>The data</h2>
<p>This week we will play with Yellow Perch data from the New York State Department of Environmental Conservation (NYSDEC) statewide fisheries database. These data were collected by the NYSDEC and others throughout NY during the past few decades.</p>
<p>Let’s have a look:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Read in the data file</span>
<span class="co"># We are reading it in with the optional</span>
<span class="co"># argument because we don&#39;t want to deal</span>
<span class="co"># with code relicts when we start</span>
<span class="co"># dropping factor levels</span>
  fish =<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;allwaters.txt&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

<span class="co"># Look at the data structure</span>
  <span class="kw">str</span>(fish)
  
<span class="co"># And, have a look at the first few lines of data</span>
  <span class="kw">head</span>(fish)</code></pre></div>
<pre><code>&#39;data.frame&#39;:   64935 obs. of  15 variables:
 $ Water    : chr  &quot;Lake Ronkonkoma&quot; &quot;Lake Ronkonkoma&quot; &quot;Lake Ronkonkoma&quot; &quot;Lake Ronkonkoma&quot; ...
 $ County   : chr  &quot;Suffolk&quot; &quot;Suffolk&quot; &quot;Suffolk&quot; &quot;Suffolk&quot; ...
 $ Region   : int  1 1 1 1 1 1 1 1 1 1 ...
 $ Date     : chr  &quot;9/8/2004 0:00:00&quot; &quot;9/8/2004 0:00:00&quot; &quot;9/8/2004 0:00:00&quot; &quot;9/8/2004 0:00:00&quot; ...
 $ GearCd   : chr  &quot;1G0191&quot; &quot;1G0191&quot; &quot;1G0191&quot; &quot;1G0191&quot; ...
 $ IF_Key   : int  1467469506 17576464 -1806054190 -658875809 -1027593693 1548594411 654285523 573244617 1576250293 -216573083 ...
 $ Length   : int  611 260 281 423 492 264 452 462 265 488 ...
 $ Weight   : int  2268 133 168 693 1076 141 870 970 147 1087 ...
 $ SpeciesCd: int  626 626 626 626 626 626 626 626 626 626 ...
 $ Name     : chr  &quot;Walleye&quot; &quot;Walleye&quot; &quot;Walleye&quot; &quot;Walleye&quot; ...
 $ Age      : int  7 1 1 3 5 1 3 3 1 3 ...
 $ IF_ID    : int  1467469506 17576464 -1806054190 -658875809 -1027593693 1548594411 654285523 573244617 1576250293 -216573083 ...
 $ NYTME    : num  6583 6583 6583 6583 6583 ...
 $ NYTMN    : num  45211 45211 45211 45211 45211 ...
 $ Altitude : num  55 55 55 55 55 55 55 55 55 55 ...
            Water  County Region             Date GearCd      IF_Key Length Weight SpeciesCd    Name Age       IF_ID NYTME NYTMN Altitude
1 Lake Ronkonkoma Suffolk      1 9/8/2004 0:00:00 1G0191  1467469506    611   2268       626 Walleye   7  1467469506  6583 45211       55
2 Lake Ronkonkoma Suffolk      1 9/8/2004 0:00:00 1G0191    17576464    260    133       626 Walleye   1    17576464  6583 45211       55
3 Lake Ronkonkoma Suffolk      1 9/8/2004 0:00:00 1G0191 -1806054190    281    168       626 Walleye   1 -1806054190  6583 45211       55
4 Lake Ronkonkoma Suffolk      1 9/8/2004 0:00:00 1G0191  -658875809    423    693       626 Walleye   3  -658875809  6583 45211       55
5 Lake Ronkonkoma Suffolk      1 9/8/2004 0:00:00 1G0191 -1027593693    492   1076       626 Walleye   5 -1027593693  6583 45211       55
6 Lake Ronkonkoma Suffolk      1 9/8/2004 0:00:00 1G0191  1548594411    264    141       626 Walleye   1  1548594411  6583 45211       55</code></pre>
<p>As you can see, there are a <em>ton</em> of lakes in this dataset, and it contains information for both yellow perch (<em>Perca flavescens</em>) and walleye (<em>Sander vitreus</em>). We only want to work with lakes in Region 4, but the lakes are scattered throughout NY. So, before we can start working with the data we want, we need to get them out of this mess.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Remove observations for which we lack mass</span>
  fish =<span class="st"> </span>fish[fish<span class="op">$</span>Name<span class="op">==</span><span class="st">&#39;Yellow Perch&#39;</span> <span class="op">&amp;</span><span class="st"> </span>fish<span class="op">$</span>Region<span class="op">==</span><span class="dv">4</span>, ]

<span class="co"># Check to see how many rows we have left</span>
  <span class="kw">nrow</span>(fish)  
[<span class="dv">1</span>] <span class="dv">2786</span></code></pre></div>
<p>And the loss of data here is a sad reality. In any case, this is more than enough for what we will do this week.</p>
</div>
<div id="exercises" class="section level2">
<h2>Exercises</h2>
<p>Following in the footsteps of the great Kery (2010), we will play around with some length-weight relationships this week. Length-weight regression is a standard tool used in fishery assessment, but also has application to a wide variety of body condition metrics in other species (including people!). And, the methods that we will use to analyze length-weight relationships are more generally just one example of the linear mixed models we might use whenever we have normal or log-normal data that we want to use for inference.</p>
<p>This week, we are going to fit some random effects models in order to investigate relationships between length and mass for fish collected in different lakes. We will start with a random effect on the intercept, and you will push on to fit a model that includes random effects on both the intercepts and slopes.</p>
<p>For our first example, we will fit length-weight regressions for fish with random effects of age on the intercept.</p>
<p>We will start by taking a look at the data we have to work with. First, we want to see how many unique waterbodies we have, and what they are.</p>
<p>We see that we have thirteen waters left in the data that actually contain yellow perch and are in Region 4. Let’s also make ourselves a variable to store the number of lakes we have to make the programming below a little easier.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># How many unique lakes do we have left?</span>
  <span class="kw">sort</span>(<span class="kw">unique</span>(fish<span class="op">$</span>Water))
 [<span class="dv">1</span>] <span class="st">&quot;Blenheim Gilboa Reservoir&quot;</span> <span class="st">&quot;Burden Lake&quot;</span>               <span class="st">&quot;Canadarago Lake&quot;</span>           <span class="st">&quot;Dunham Reservoir&quot;</span>          <span class="st">&quot;Dyking Pond&quot;</span>               <span class="st">&quot;Goodyear Lake&quot;</span>             <span class="st">&quot;Kinderhook Lake&quot;</span>          
 [<span class="dv">8</span>] <span class="st">&quot;Mariaville Lake&quot;</span>           <span class="st">&quot;Rossman Pond&quot;</span>              <span class="st">&quot;Schenevus Lake&quot;</span>            <span class="st">&quot;Schoharie Reservoir&quot;</span>       <span class="st">&quot;Tomhannock Reservoir&quot;</span>      <span class="st">&quot;Unnamed Water&quot;</span>            

<span class="co"># Count the number of unique values and store it in an object</span>
  nwaters =<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(fish<span class="op">$</span>Water))  </code></pre></div>
<p>Okay, now that we know what we are working with here, we can specify our models in much the same way that we did in lecture this week.</p>
<div id="reml-implementation" class="section level3">
<h3>REML implementation</h3>
<p>We start by estimating the model with REML. The model converges quickly.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load the lme4 library</span>
  <span class="kw">library</span>(lme4)

<span class="co"># Fit the model</span>
  ypLME =<span class="st"> </span><span class="kw">lmer</span>(<span class="kw">I</span>(<span class="kw">log10</span>(Weight))<span class="op">~</span><span class="kw">I</span>(<span class="kw">log10</span>(Length)) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>Water), <span class="dt">data=</span>fish)
  
<span class="co"># Examine the fit</span>
  <span class="kw">summary</span>(ypLME)
Linear mixed model fit by REML [<span class="st">&#39;lmerMod&#39;</span>]
Formula<span class="op">:</span><span class="st"> </span><span class="kw">I</span>(<span class="kw">log10</span>(Weight)) <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(<span class="kw">log10</span>(Length)) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Water)
   Data<span class="op">:</span><span class="st"> </span>fish

REML criterion at convergence<span class="op">:</span><span class="st"> </span><span class="op">-</span><span class="fl">2384.8</span>

Scaled residuals<span class="op">:</span><span class="st"> </span>
<span class="st">    </span>Min      1Q  Median      3Q     Max 
<span class="op">-</span><span class="fl">5.5287</span> <span class="op">-</span><span class="fl">0.5322</span>  <span class="fl">0.0217</span>  <span class="fl">0.5541</span>  <span class="fl">5.5680</span> 

Random effects<span class="op">:</span>
<span class="st"> </span>Groups   Name        Variance Std.Dev.
 <span class="kw">Water</span>    (Intercept) <span class="fl">0.002782</span> <span class="fl">0.05274</span> 
 Residual             <span class="fl">0.004934</span> <span class="fl">0.07024</span> 
Number of obs<span class="op">:</span><span class="st"> </span><span class="dv">984</span>, groups<span class="op">:</span><span class="st">  </span>Water, <span class="dv">12</span>

Fixed effects<span class="op">:</span>
<span class="st">                 </span>Estimate Std. Error t value
(Intercept)      <span class="op">-</span><span class="fl">5.48908</span>    <span class="fl">0.04219</span>  <span class="op">-</span><span class="fl">130.1</span>
<span class="kw">I</span>(<span class="kw">log10</span>(Length))  <span class="fl">3.23911</span>    <span class="fl">0.01754</span>   <span class="fl">184.7</span>

Correlation of Fixed Effects<span class="op">:</span>
<span class="st">            </span>(Intr)
<span class="kw">I</span>(<span class="kw">lg10</span>(Ln)) <span class="op">-</span><span class="fl">0.927</span></code></pre></div>
<p>We see that we got a nice tight fit to the data in this case. Also notable in this specific model is the negative correlation between the fixed effects. This is a well-known phenomenon, but worth recognizing. If we wanted to go further, we could account for this correlation in our model structures directly.</p>
<p>For reporting, we could make a graph showing the mean of the regional relationship, or we could dig into the random coefficients for each model using the methods detailed in the lecture material from this week.</p>
</div>
<div id="bayesian-implementation" class="section level3">
<h3>Bayesian implementation</h3>
<p>Next, we will fit the model in JAGS.</p>
<p>Here, we tell JAGS that the response (mass) is a random variable that has a normal distribution with a mean of <span class="math inline">\(\mu\)</span>, and a precision of <span class="math inline">\(\tau\)</span>. Recall that <span class="math inline">\(\tau\)</span> is precision (the inverse of <span class="math inline">\(\sigma\)</span>). Next, we tell JAGS that the mean (expected value) of the response can be described as a linear function of waterbody and length. We specify waterbody-specific priors for the intercept term, <span class="math inline">\(\alpha\)</span>, each of which has a mean of <span class="math inline">\(\mu_int\)</span> and a standard deviation of <span class="math inline">\(\sigma_int\)</span>. The values of hyperparameters <span class="math inline">\(\mu_int\)</span> and <span class="math inline">\(\sigma_int\)</span> are drawn from hyperpriors on the regional mean and standard deviations for the length-weight relationship. Finally, we specify a single prior for <span class="math inline">\(\beta\)</span> to indicate that the slope (relationship between length and mass) is the same across all water bodies.</p>
<blockquote>
<p>Specify the model</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Write model</span>
  modelstring=<span class="st">&quot;</span>
<span class="st">    model {</span>
<span class="st">  </span>
<span class="st">    # Likelihood</span>
<span class="st">     for (i in 1:n) {</span>
<span class="st">        mass[i] ~ dnorm(mu[i], tau) # The random variable</span>
<span class="st">        mu[i] &lt;- alpha[water[i]] + beta* length[i] # Expectation</span>
<span class="st">     }</span>
<span class="st">    </span>
<span class="st">    # Priors</span>
<span class="st">     for (i in 1:nwaters){      </span>
<span class="st">        alpha[i] ~ dnorm(mu.int, tau.int) # Random intercepts</span>
<span class="st">     }</span>
<span class="st">    </span>
<span class="st">     mu.int ~ dnorm(0, 0.01)    # Mean hyperparameter for random intercepts</span>
<span class="st">     tau.int &lt;- 1 / (sigma.int * sigma.int)</span>
<span class="st">     sigma.int ~ dunif(0, 10)   # SD hyperparameter for random intercepts</span>
<span class="st">    </span>
<span class="st">     beta ~ dnorm(0, 0.01) # Slope</span>
<span class="st">     </span>
<span class="st">     tau &lt;- 1 / ( sigma * sigma) # Residual precision</span>
<span class="st">     sigma ~ dunif(0, 10)   # Residual standard deviation</span>

<span class="st">    }</span>
<span class="st">  &quot;</span>
  <span class="kw">writeLines</span>(modelstring, <span class="st">&quot;ypModel.txt&quot;</span>)</code></pre></div>
<blockquote>
<p>Make a list of the data for JAGS</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Bundle data</span>
  fish.data &lt;-<span class="st"> </span><span class="kw">list</span>(
    <span class="dt">mass =</span> <span class="kw">log10</span>(fish<span class="op">$</span>Weight),
    <span class="dt">water =</span> <span class="kw">as.numeric</span>(<span class="kw">as.factor</span>(fish<span class="op">$</span>Water)), 
    <span class="dt">length =</span> <span class="kw">log10</span>(fish<span class="op">$</span>Length),
    <span class="dt">nwaters =</span> <span class="kw">length</span>(<span class="kw">unique</span>(fish<span class="op">$</span>Water)),
    <span class="dt">n =</span> <span class="kw">nrow</span>(fish))</code></pre></div>
<blockquote>
<p>Specify initial values for each of the Markov chains</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Inits function</span>
inits &lt;-<span class="st"> </span><span class="cf">function</span>(){<span class="kw">list</span>(
  <span class="dt">mu.int =</span> <span class="kw">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>),
  <span class="dt">sigma.int =</span> <span class="kw">rlnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>),
  <span class="dt">beta =</span> <span class="kw">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>),
  <span class="dt">sigma =</span> <span class="kw">rlnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)
)}</code></pre></div>
<blockquote>
<p>Specify parameters to monitor</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Parameters to estimate</span>
parameters &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta&quot;</span>, <span class="st">&quot;mu.int&quot;</span>, <span class="st">&quot;sigma.int&quot;</span>, <span class="st">&quot;sigma&quot;</span>)</code></pre></div>
<blockquote>
<p>Define MCMC settings</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># MCMC settings</span>
ni &lt;-<span class="st"> </span><span class="dv">5000</span>
nb &lt;-<span class="st"> </span><span class="dv">1000</span>
nt &lt;-<span class="st"> </span><span class="dv">5</span>
nc &lt;-<span class="st"> </span><span class="dv">3</span></code></pre></div>
<blockquote>
<p>Calibrate the model</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load the R2jags library</span>
  <span class="kw">library</span>(R2jags)

<span class="co"># Start Gibbs sampling</span>
  ypModel &lt;-<span class="kw">jags</span>(fish.data, inits, parameters, <span class="st">&quot;ypModel.txt&quot;</span>, <span class="dt">n.thin=</span>nt, 
  <span class="dt">n.chains=</span>nc, <span class="dt">n.burnin=</span>nb, <span class="dt">n.iter=</span>ni)</code></pre></div>
<blockquote>
<p>Take a look at the output and diagnostics</p>
</blockquote>
<p>First, we can take a look at the model coefficients and diagnostics. Here, I am just going to print the model results for mean, sd, 95% CRI, and N<sub>eff</sub>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Get parameter estimates all by themselves</span>
  res =<span class="st"> </span>ypModel<span class="op">$</span>BUGSoutput<span class="op">$</span>summary[, <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>)]

<span class="co"># Inspect results</span>
  <span class="kw">print</span>(res, <span class="dt">digits =</span> <span class="dv">3</span>)</code></pre></div>
<p>After a quick look at the convergence diagnostics, things look more or less a-okay, but we may need to bump up our sampling to get a larger sample size if we ever want to get this sucker published.</p>
</div>
<div id="interpretting-the-results" class="section level3">
<h3>Interpretting the results</h3>
<p>Usually, we don’t get too sucked into the interpretation of results in this class, but the actual parameters of this equation have some pretty cool meaning in and of themselves. For length-weight regressions, the parameter <span class="math inline">\(\beta\)</span> actually is a measure of how fish rotundity changes throughout their life. For cases where <span class="math inline">\(\beta\)</span> &gt; 3, we say that the fish generally gets fatter as it increases in length. At <span class="math inline">\(\beta\)</span> &lt; 3, we assume that fish get skinnier as the grow in length. This can be really useful for monitoring population trends. For these data, it is clear that beta is “significantly” larger than 3 given that the 95% CRI for our estimate does not overlap zero. <strong>But</strong> what if some of these populations had <span class="math inline">\(\beta\)</span> &lt; 3.0 and we are just not picking it up because we only estimated one <span class="math inline">\(\beta\)</span>?!</p>
</div>
</div>
<div id="your-mission" class="section level2">
<h2>Your mission</h2>
<p>Did you see that one coming?</p>

<ol style="list-style-type: decimal">
<li>Choose REML or Bayesian methods for fitting a model.</li>
</ol>

<ol start="2" style="list-style-type: decimal">
<li>Fit a model that includes random effects on intercept <em>and</em> slope.</li>
</ol>

<ol start="3" style="list-style-type: decimal">
<li>Graph the mean overall relationship between length and mass based on the overall intercept and slope. Determine whether the overall slope parameter differs significantly from 3.00 based on the mean (<code>Estimate</code>) and standard errors (<code>Std. Error</code>) in the <code>Fixed effects</code> table in your model <code>summary()</code>.</li>
</ol>

<ol start="4" style="list-style-type: decimal">
<li>Compare each of the lake-specific <span class="math inline">\(\beta\)</span>s with 3.00 (isometric growth) and note any obvious patterns (tests of statistical significance not required).</li>
</ol>

<ol start="5" style="list-style-type: decimal">
<li>Write a brief methods and brief results section.</li>
</ol>
</div>

<!DOCTYPE html>

<br>

<hr>

<p style="color:gray; text-align:center">This work is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/legalcode">Creative Commons Attribution 4.0 International License</a>. Data are provided for educational purposes only unless otherwise noted.</p>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
