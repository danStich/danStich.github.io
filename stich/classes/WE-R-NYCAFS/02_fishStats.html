<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>02_fishStats.utf8</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<!DOCTYPE html>
<head>
<!-- Favicon for various operating systems -->
<link rel="apple-touch-icon" sizes="180x180" href="./favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="./favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="./favicon/favicon-16x16.png">
<!-- <link rel="manifest" href="./favicon/site.webmanifest"> -->
<link rel="mask-icon" href="./favicon/safari-pinned-tab.svg" color="#603cba">
<link rel="shortcut icon" href="./favicon/favicon.ico">
<meta name="msapplication-TileColor" content="#603cba">
<meta name="msapplication-config" content="./favicon/browserconfig.xml">
<meta name="theme-color" content="#382121">
</head>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="..\..\styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">We R NYCAFS</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="content.html">Workshop modules</a>
</li>
<li>
  <a href="software.html">Software needs</a>
</li>
<li>
  <a href="resources.html">Additional Resources</a>
</li>
<li>
  <a href="contact.html">Contact</a>
</li>
<li>
  <a href="https://newyork.fisheries.org/">NY Chapter AFS</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/danStich">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://www.youtube.com/channel/UCk9swndX8R02PVEvQGUKG-A">
    <span class="fa fa fa fa-youtube-play"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<div id="introductory-fisheries-statistics-in-r" class="section level1">
<h1>Introductory fisheries statistics in R</h1>
<h2 id="multi">
Introduction
</h2>
<p>Now that we have looked at some of the basic programming and common statistical tools in R, we can dive into some of the tools that have been created just for fish! There are a few packages for dealing with data from fish and fisheries, and we will just glance off the tip of the iceberg here to demonstrate some of the tools that we use all of the time in fisheries. Hopefully you find, like many of us, that once you’ve tackled the code the first time it is easy to translate from one species or data set to another. And next time, you’ll have a head-start!</p>
<div id="length-frequency-histograms" class="section level2">
<h2>Length-frequency histograms</h2>
<h3 id="multi">
Doing it ‘by hand’
</h3>
<p>Let’s start by reading in some data for Largemouth Bass in New York State so we can look at length-frequency histograms in R. We will walk through some basic steps that you should do pretty much every time you start working with a new dataset- <em>even if you are the one who collected and entered the data</em>. The reason for this is that we always want to know how R is treating our data.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Read in the data file</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>  bass =<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;lmblw.csv&#39;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co"># Have a quick look at the first ten lines of the data</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>  <span class="kw">head</span>(bass, <span class="dv">10</span>)</span>
<span id="cb1-6"><a href="#cb1-6"></a>              Name Length           Date                Water Weight</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="dv">1</span>  Largemouth Bass     <span class="dv">17</span> <span class="dv">6</span><span class="op">/</span><span class="dv">20</span><span class="op">/</span><span class="dv">1991</span> <span class="dv">0</span><span class="op">:</span><span class="dv">00</span>           Grant Pond      <span class="dv">1</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="dv">2</span>  Largemouth Bass     <span class="dv">28</span> <span class="dv">6</span><span class="op">/</span><span class="dv">18</span><span class="op">/</span><span class="dv">2008</span> <span class="dv">0</span><span class="op">:</span><span class="dv">00</span>          Lamoka Lake      <span class="dv">0</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="dv">3</span>  Largemouth Bass     <span class="dv">31</span> <span class="dv">6</span><span class="op">/</span><span class="dv">20</span><span class="op">/</span><span class="dv">1991</span> <span class="dv">0</span><span class="op">:</span><span class="dv">00</span>           Grant Pond      <span class="dv">1</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="dv">4</span>  Largemouth Bass     <span class="dv">31</span> <span class="dv">6</span><span class="op">/</span><span class="dv">20</span><span class="op">/</span><span class="dv">1991</span> <span class="dv">0</span><span class="op">:</span><span class="dv">00</span>           Grant Pond      <span class="dv">1</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="dv">5</span>  Largemouth Bass     <span class="dv">34</span> <span class="dv">6</span><span class="op">/</span><span class="dv">18</span><span class="op">/</span><span class="dv">2008</span> <span class="dv">0</span><span class="op">:</span><span class="dv">00</span>          Lamoka Lake      <span class="dv">0</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="dv">6</span>  Largemouth Bass     <span class="dv">35</span> <span class="dv">6</span><span class="op">/</span><span class="dv">24</span><span class="op">/</span><span class="dv">1991</span> <span class="dv">0</span><span class="op">:</span><span class="dv">00</span> Massapequa Reservoir      <span class="dv">1</span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="dv">7</span>  Largemouth Bass     <span class="dv">37</span> <span class="dv">6</span><span class="op">/</span><span class="dv">20</span><span class="op">/</span><span class="dv">1991</span> <span class="dv">0</span><span class="op">:</span><span class="dv">00</span>           Grant Pond      <span class="dv">1</span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="dv">8</span>  Largemouth Bass     <span class="dv">37</span> <span class="dv">6</span><span class="op">/</span><span class="dv">27</span><span class="op">/</span><span class="dv">1991</span> <span class="dv">0</span><span class="op">:</span><span class="dv">00</span> Massapequa Reservoir      <span class="dv">1</span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="dv">9</span>  Largemouth Bass     <span class="dv">37</span> <span class="dv">6</span><span class="op">/</span><span class="dv">27</span><span class="op">/</span><span class="dv">1991</span> <span class="dv">0</span><span class="op">:</span><span class="dv">00</span> Massapequa Reservoir      <span class="dv">1</span></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="dv">10</span> Largemouth Bass     <span class="dv">38</span> <span class="dv">8</span><span class="op">/</span><span class="dv">26</span><span class="op">/</span><span class="dv">1992</span> <span class="dv">0</span><span class="op">:</span><span class="dv">00</span>        Lake Abanakee      <span class="dv">1</span></span>
<span id="cb1-17"><a href="#cb1-17"></a>  </span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="co"># Take a quick look at the data structure</span></span>
<span id="cb1-19"><a href="#cb1-19"></a>  <span class="kw">str</span>(bass)</span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="st">&#39;data.frame&#39;</span><span class="op">:</span><span class="st">   </span><span class="dv">37354</span> obs. of  <span class="dv">5</span> variables<span class="op">:</span></span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="st"> </span><span class="er">$</span><span class="st"> </span>Name  <span class="op">:</span><span class="st"> </span>chr  <span class="st">&quot;Largemouth Bass&quot;</span> <span class="st">&quot;Largemouth Bass&quot;</span> <span class="st">&quot;Largemouth Bass&quot;</span> <span class="st">&quot;Largemouth Bass&quot;</span> ...</span>
<span id="cb1-22"><a href="#cb1-22"></a> <span class="op">$</span><span class="st"> </span>Length<span class="op">:</span><span class="st"> </span>int  <span class="dv">17</span> <span class="dv">28</span> <span class="dv">31</span> <span class="dv">31</span> <span class="dv">34</span> <span class="dv">35</span> <span class="dv">37</span> <span class="dv">37</span> <span class="dv">37</span> <span class="dv">38</span> ...</span>
<span id="cb1-23"><a href="#cb1-23"></a> <span class="op">$</span><span class="st"> </span>Date  <span class="op">:</span><span class="st"> </span>chr  <span class="st">&quot;6/20/1991 0:00&quot;</span> <span class="st">&quot;6/18/2008 0:00&quot;</span> <span class="st">&quot;6/20/1991 0:00&quot;</span> <span class="st">&quot;6/20/1991 0:00&quot;</span> ...</span>
<span id="cb1-24"><a href="#cb1-24"></a> <span class="op">$</span><span class="st"> </span>Water <span class="op">:</span><span class="st"> </span>chr  <span class="st">&quot;Grant Pond&quot;</span> <span class="st">&quot;Lamoka Lake&quot;</span> <span class="st">&quot;Grant Pond&quot;</span> <span class="st">&quot;Grant Pond&quot;</span> ...</span>
<span id="cb1-25"><a href="#cb1-25"></a> <span class="op">$</span><span class="st"> </span>Weight<span class="op">:</span><span class="st"> </span>int  <span class="dv">1</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> ...</span></code></pre></div>
<blockquote>
<p>We can even look at it like a spreadsheet!</p>
</blockquote>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">View</span>(bass)</span></code></pre></div>
<p>Now, let’s make a basic l-f histogram of the bass data</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Make a histogram with all of the arguments set to their defaults</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="kw">hist</span>(<span class="dt">x =</span> bass<span class="op">$</span>Length)</span></code></pre></div>
<p><img src="02_fishStats_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>This is pretty ugly, and it doesn’t do a whole lot for us in terms of biological meaning. We can modify this plot to use standard <code>breaks</code> or <code>bins</code> so that we can get, for example, 10-mm length bins that may have more biological meaning.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Make a histogram with all of the arguments set to their defaults</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="kw">hist</span>(<span class="dt">x =</span> bass<span class="op">$</span>Length,</span>
<span id="cb4-3"><a href="#cb4-3"></a>       <span class="dt">breaks =</span> <span class="kw">diff</span>(<span class="kw">range</span>(bass<span class="op">$</span>Length))<span class="op">/</span><span class="dv">10</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>       )</span></code></pre></div>
<p><img src="02_fishStats_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>Here, we told R to calculate the difference (<code>diff</code>) between the upper and lower values returned from the function <code>range</code>. Then, we divide that difference (250 mm) by 10 to get 25 10-mm length bins.</p>
<p>Okay, so this plot is better, but there is still a lot of ugly crap going on here. For one, the labels make no sense. The axes don’t cross at zero, we have no color, and we have an ugly main heading in our figure that we will virtually never use for papers. On top of that, we are working with bass from 320 lakes and reservoirs.</p>
<p>So, let’s fix it!!</p>
<p>Start by picking out a lake to work with. I am going to work with <code>Saratoga Lake</code> here because I know you have worked with data from that lake, and it is right up the road from my hometown. To get an alphabetical list of lakes in the data set, you can type <code>sort(unique(bass$Water))</code> in the console.</p>
<p>Once you have your lake picked out, we need to subset our data:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Get the data for the lake you want to use</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co"># Notice the comma inside the brackets here!!</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>  mybass =<span class="st"> </span>bass[bass<span class="op">$</span>Water <span class="op">==</span><span class="st"> &#39;Saratoga Lake&#39;</span>, ]</span></code></pre></div>
<p>Make sure you have enough data for this to work</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Check number of rows in the data set</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="kw">nrow</span>(mybass)</span>
<span id="cb6-3"><a href="#cb6-3"></a>[<span class="dv">1</span>] <span class="dv">251</span></span></code></pre></div>
<p>Now, let’s make a better looking histogram.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Make a histogram with 10-mm length</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="co"># bins that looks much better than the</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co"># previous one if only because it&#39;s gray.</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="kw">hist</span>(<span class="dt">x =</span> mybass<span class="op">$</span>Length,</span>
<span id="cb7-5"><a href="#cb7-5"></a>       <span class="dt">breaks =</span> <span class="kw">diff</span>(<span class="kw">range</span>(mybass<span class="op">$</span>Length))<span class="op">/</span><span class="dv">10</span>,</span>
<span id="cb7-6"><a href="#cb7-6"></a>       <span class="dt">yaxt =</span> <span class="st">&#39;n&#39;</span>,  <span class="co"># Don&#39;t print y-axis yet</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>       <span class="dt">xaxt =</span> <span class="st">&#39;n&#39;</span>,  <span class="co"># Don&#39;t print x-axis yet</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>       <span class="dt">col =</span> <span class="st">&#39;gray87&#39;</span>,</span>
<span id="cb7-9"><a href="#cb7-9"></a>       <span class="dt">main =</span> <span class="st">&#39;&#39;</span>,</span>
<span id="cb7-10"><a href="#cb7-10"></a>       <span class="dt">xlab =</span> <span class="st">&#39;Fork length (mm)&#39;</span></span>
<span id="cb7-11"><a href="#cb7-11"></a>       )</span>
<span id="cb7-12"><a href="#cb7-12"></a>  <span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">pos =</span> <span class="dv">0</span>)</span>
<span id="cb7-13"><a href="#cb7-13"></a>  <span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">2</span>, <span class="dt">pos =</span> <span class="kw">min</span>(bass<span class="op">$</span>Length), <span class="dt">las =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="02_fishStats_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>There, that looks a lot better. We might even think about putting this in a report or an article.</p>
<div id="doing-it-in-the-fsa-package" class="section level3">
<h3>Doing it in the <code>FSA</code> package</h3>
<p>So, we can make some pretty nice figures by hand, but this can be a lot to learn and not everyone is into it. If we want a faser solution, there are a number of <strong>packages</strong> that are maintained in R specifically for fish data. The most comprehensive toolsets is are <code>FSA</code> and the <code>fishmethods</code> packages. Here we will start to play with some of the tools in <code>FSA</code>, with examples from the package documentation, to see how some of the more common fish population assessment tools work.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Load the FSA library</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="kw">library</span>(FSA)</span></code></pre></div>
<p>The <code>FSA</code> package contains a lot of really cool tools that make life a lot easier. And, you can even get an <a href="http://derekogle.com/IFAR/">introductory fish stats book</a> that goes along with it. We will cover some basic applications here, but realize that this package can be used for a whole lot of other stuff, and now includes much of what previously was housed exclusively in the <code>fishmethods</code> package.</p>
<p>For example, if we wanted to create a length-frequency histogram that shows some of the Gabelhouse length categories, we could do it like this:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="co"># Make an l-f histogram that includes Gabelhouse lengths</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="kw">psdPlot</span>(<span class="op">~</span>Length,    <span class="co"># Tell R the name of your length data          </span></span>
<span id="cb9-4"><a href="#cb9-4"></a>        <span class="dt">data=</span>mybass, <span class="co"># Tell it the name of the data frame</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>        <span class="dt">species=</span><span class="st">&quot;Largemouth Bass&quot;</span>, <span class="co"># Pass species</span></span>
<span id="cb9-6"><a href="#cb9-6"></a>        <span class="dt">w=</span><span class="dv">10</span>) <span class="co"># Tell R how wide length-bins are</span></span></code></pre></div>
<p><img src="02_fishStats_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>This is a heck of a lot easier than going through all of that other stuff if what we want is an l-f histogram with all of this stuff on it. But, if that’s not what you want then you have to do it by hand or customize the code from <code>FSA</code>, so it’s good to know both.</p>
</div>
</div>
<div id="psd-calculations-and-graphing" class="section level2">
<h2>PSD calculations and graphing</h2>
<p>The plots we used above are neat, but if what we are really after are the numbers or a tic-tac-toe graph for multiple species, then this is only going to give us part of what we want. Luckily, there are other tools for that stuff in the <code>FSA</code> package.</p>
<p>We will demonstrate PSD calculations in R using the <code>FSA</code> package here. Note that these functions are for convenience only, and you could do it by hand in R if you were inclined…<strong>ha!</strong></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Calculate PSD for Gabelhouse length categories</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="co"># and each of the intervals</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>  <span class="kw">psdCalc</span>(<span class="op">~</span>Length,</span>
<span id="cb10-4"><a href="#cb10-4"></a>          <span class="dt">data=</span>mybass,</span>
<span id="cb10-5"><a href="#cb10-5"></a>          <span class="dt">species=</span><span class="st">&quot;Largemouth Bass&quot;</span>,</span>
<span id="cb10-6"><a href="#cb10-6"></a>          <span class="dt">digits=</span><span class="dv">1</span>)</span>
<span id="cb10-7"><a href="#cb10-7"></a>        Estimate <span class="dv">95</span><span class="op">% LCI 95%</span><span class="st"> </span>UCI</span>
<span id="cb10-8"><a href="#cb10-8"></a>PSD<span class="op">-</span>Q       <span class="fl">84.5</span>    <span class="fl">78.0</span>    <span class="fl">91.1</span></span>
<span id="cb10-9"><a href="#cb10-9"></a>PSD<span class="op">-</span>P       <span class="fl">28.0</span>    <span class="fl">19.9</span>    <span class="fl">36.2</span></span>
<span id="cb10-10"><a href="#cb10-10"></a>PSD<span class="op">-</span>M        <span class="fl">0.4</span>     <span class="fl">0.0</span>     <span class="fl">1.6</span></span>
<span id="cb10-11"><a href="#cb10-11"></a>PSD S<span class="op">-</span>Q     <span class="fl">15.5</span>     <span class="fl">8.9</span>    <span class="fl">22.0</span></span>
<span id="cb10-12"><a href="#cb10-12"></a>PSD Q<span class="op">-</span>P     <span class="fl">56.5</span>    <span class="fl">47.5</span>    <span class="fl">65.5</span></span>
<span id="cb10-13"><a href="#cb10-13"></a>PSD P<span class="op">-</span>M     <span class="fl">27.6</span>    <span class="fl">19.5</span>    <span class="fl">35.7</span></span>
<span id="cb10-14"><a href="#cb10-14"></a>PSD M<span class="op">-</span>T      <span class="fl">0.4</span>     <span class="fl">0.0</span>     <span class="fl">1.6</span></span></code></pre></div>
<p>If you take a close look at the output, you can see that we not only get point estimates for each of the standard length categories we normally care about, but we also get 95% confidence intervals from those estimates! Very cool…how long do you think that would have taken you in Excel?</p>
<div id="tic-tac-toe-graphs" class="section level4">
<h4>Tic-tac-toe graphs</h4>
<p>The <code>psdCalc</code> function is really great for getting PSD for one species, but we are often interested in PSDs of predator and prey simultaneously for gauging things like ‘balance’ in fish communities.</p>
<p>So, let’s pretend we have some predator-prey data for which we have already calculated psDs. If we want to make a tic-tac-toe graph, all we have to do is:</p>
<p>Let’s start by making up (er, simulating) data for predator PSD and prey SD with 95% Confidence intervals.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Make up mean and 95% CI of PSD for each species</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>  prey &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">45.4</span>, <span class="fl">30.2</span>, <span class="fl">56.8</span>)</span>
<span id="cb11-3"><a href="#cb11-3"></a>  pred &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">24.5</span>, <span class="fl">10.2</span>, <span class="fl">36.7</span>)</span>
<span id="cb11-4"><a href="#cb11-4"></a>  </span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="co"># Give names to the values in each of those objects  </span></span>
<span id="cb11-6"><a href="#cb11-6"></a>  <span class="kw">names</span>(prey) &lt;-<span class="st"> </span><span class="kw">names</span>(pred) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Estimate&quot;</span>, <span class="st">&quot;95% LCI&quot;</span>, <span class="st">&quot;95% UCI&quot;</span>)</span>
<span id="cb11-7"><a href="#cb11-7"></a>  </span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="co"># Print predator and prey objects to see what they look like</span></span>
<span id="cb11-9"><a href="#cb11-9"></a>  prey</span>
<span id="cb11-10"><a href="#cb11-10"></a>Estimate  <span class="dv">95</span><span class="op">% LCI  95%</span><span class="st"> </span>UCI </span>
<span id="cb11-11"><a href="#cb11-11"></a>    <span class="fl">45.4</span>     <span class="fl">30.2</span>     <span class="fl">56.8</span> </span>
<span id="cb11-12"><a href="#cb11-12"></a>  pred</span>
<span id="cb11-13"><a href="#cb11-13"></a>Estimate  <span class="dv">95</span><span class="op">% LCI  95%</span><span class="st"> </span>UCI </span>
<span id="cb11-14"><a href="#cb11-14"></a>    <span class="fl">24.5</span>     <span class="fl">10.2</span>     <span class="fl">36.7</span> </span></code></pre></div>
<p>Next, we will make a blank plotting window for our tic-tac-toe graph.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">tictactoe</span>(<span class="dt">predobj =</span> <span class="kw">c</span>(<span class="dv">30</span>, <span class="dv">70</span>),</span>
<span id="cb12-2"><a href="#cb12-2"></a>          <span class="dt">preyobj =</span> <span class="kw">c</span>(<span class="dv">30</span>, <span class="dv">70</span>),</span>
<span id="cb12-3"><a href="#cb12-3"></a>          <span class="dt">predlab =</span> <span class="st">&quot;Predator PSD&quot;</span>,</span>
<span id="cb12-4"><a href="#cb12-4"></a>          <span class="dt">preylab =</span> <span class="st">&quot;Prey PSD&quot;</span>, <span class="dt">obj.col =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb12-5"><a href="#cb12-5"></a>          <span class="dt">obj.trans =</span> <span class="fl">0.2</span>,</span>
<span id="cb12-6"><a href="#cb12-6"></a>          <span class="dt">bnd.col =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb12-7"><a href="#cb12-7"></a>          <span class="dt">bnd.lwd =</span> <span class="dv">1</span>,</span>
<span id="cb12-8"><a href="#cb12-8"></a>          <span class="dt">bnd.lty =</span> <span class="dv">2</span></span>
<span id="cb12-9"><a href="#cb12-9"></a>          )</span></code></pre></div>
<p><img src="02_fishStats_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Now, that gives us a really nice blank plot! What about the data?</p>
<p>Well, we can add the data on our tic-tac-toe graph, of course.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># Load the `plotrix` package for the</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="co"># `plotCI` function first. You may need</span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="co"># to install this if it didn&#39;t automatically</span></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="co"># install with `FSA`</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>  <span class="kw">library</span>(plotrix)</span>
<span id="cb13-6"><a href="#cb13-6"></a></span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="co"># Plot the PSD and the confidence intervals</span></span>
<span id="cb13-8"><a href="#cb13-8"></a>  <span class="kw">plotCI</span>(prey[<span class="dv">1</span>],pred[<span class="dv">1</span>],<span class="dt">li=</span>prey[<span class="dv">2</span>],<span class="dt">ui=</span>prey[<span class="dv">3</span>],</span>
<span id="cb13-9"><a href="#cb13-9"></a>         <span class="dt">err=</span><span class="st">&quot;x&quot;</span>,<span class="dt">pch=</span><span class="dv">16</span>,<span class="dt">add=</span><span class="ot">TRUE</span>)</span>
<span id="cb13-10"><a href="#cb13-10"></a>  <span class="kw">plotCI</span>(prey[<span class="dv">1</span>],pred[<span class="dv">1</span>],<span class="dt">li=</span>pred[<span class="dv">2</span>],<span class="dt">ui=</span>pred[<span class="dv">3</span>],</span>
<span id="cb13-11"><a href="#cb13-11"></a>         <span class="dt">err=</span><span class="st">&quot;y&quot;</span>,<span class="dt">pch=</span><span class="dv">16</span>,<span class="dt">add=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="02_fishStats_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>Beautiful…</p>
</div>
</div>
<div id="estimating-growth-curves" class="section level2">
<h2>Estimating growth curves</h2>
<p>Individual growth, based on length-at-age data can be really useful information when we are developing stock assessments on which we will eventually base fishery management decisions. There are a number of different tools that we can use to estimate growth curves.</p>
<p>The most commonly used kind of growth curve for length-at-age data is the von Bertalanffy growth model, but there are a whole bunch of others that may be way better depending on the biology of the fish you are studying. We can estimate these models using either individual length-at-age data, or by using population averages. If we have the data, the former is preferred, and R is a great way to do this.</p>
<p>Let’s look at an example of how to do this. There are a couple of different ways we can go about this. All of them require that we pick some kind of growth model, and that we provide starting values for the parameters in that model. The <strong>parameters</strong> are quantities that govern the shape of the growth curve, and that we (usually) need to estimate from the data.</p>
<p>I know, sounds confusing, but the math is actually more straightforward than the funny polynomial lines you may have fit to length-age data in Excel when nobody was looking (don’t do that!!).</p>
<p>Let’s start by reading in a new data set. This one has American shad <em>Alosa sapidissima</em> lengths and ages in the Susquehanna River. We have around 10,000 paired fork lengths and otolith ages. Side note: these are real data that we are working with right now for the 2020 ASMFC stock assessment for the species.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># Read in the shad data</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>  shad &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;sus_shad.csv&#39;</span>)</span></code></pre></div>
<p>Next, we need to define the von Bertalanffy growth model as an object so R can see it. <strong>Important</strong>: I am using <code>FL</code> and <code>Age</code> below because those are the names of the columns in my data that hold length and age data. You will need to change that if you have different names for those columns in your data!</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Define von Bertalanffy growth function</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>  vbmod &lt;-<span class="st"> </span>FL <span class="op">~</span><span class="st"> </span>Linf <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>( <span class="op">-</span>K <span class="op">*</span><span class="st"> </span>(Age <span class="op">-</span><span class="st"> </span>t0) ) )</span></code></pre></div>
<p>Now, we can pass this on to a non-linear optimizer, just like you might do with the Solver Add-in for Excel. But first, we need to come up with some starting values. Without any prior knowledge of the study population this can be tough. But, we can get some starting values for our parameters (<code>Linf</code>, <code>K</code>, and <code>t0</code>) using the <code>FSA</code> package.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># Get starting values for each of your</span></span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="co"># parameters using the `vbStarts` function</span></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="co"># from `FSA`</span></span>
<span id="cb16-4"><a href="#cb16-4"></a>  starts =<span class="st"> </span><span class="kw">vbStarts</span>(<span class="dt">formula=</span>FL<span class="op">~</span>Age, <span class="dt">data=</span>shad)</span></code></pre></div>
<p>Now, we have a <code>list</code> of starting values that we can use to start estimating the growth function.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># Have a look at the starting values for </span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="co"># the parameters.</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>  starts</span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="op">$</span>Linf</span>
<span id="cb17-5"><a href="#cb17-5"></a>[<span class="dv">1</span>] <span class="fl">473.1499</span></span>
<span id="cb17-6"><a href="#cb17-6"></a></span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="op">$</span>K</span>
<span id="cb17-8"><a href="#cb17-8"></a>[<span class="dv">1</span>] <span class="fl">0.8690361</span></span>
<span id="cb17-9"><a href="#cb17-9"></a></span>
<span id="cb17-10"><a href="#cb17-10"></a><span class="op">$</span>t0</span>
<span id="cb17-11"><a href="#cb17-11"></a>[<span class="dv">1</span>] <span class="fl">0.7090241</span></span></code></pre></div>
<p>With these in hand, we can finally estimate the parameters for the von Bertalanffy growth function for these fishies:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># Fit the von Bertalanffy growth function using</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="co"># nonlinear least squares (nls) optimization</span></span>
<span id="cb18-3"><a href="#cb18-3"></a>  mymod =<span class="st"> </span><span class="kw">nls</span>(vbmod, <span class="dt">data =</span> shad, <span class="dt">start =</span> starts)</span></code></pre></div>
<p>And, at long last we can have a look at the parameter estimates like this:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># Show model summary</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>  <span class="kw">summary</span>(mymod)</span>
<span id="cb19-3"><a href="#cb19-3"></a></span>
<span id="cb19-4"><a href="#cb19-4"></a>Formula<span class="op">:</span><span class="st"> </span>FL <span class="op">~</span><span class="st"> </span>Linf <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>K <span class="op">*</span><span class="st"> </span>(Age <span class="op">-</span><span class="st"> </span>t0)))</span>
<span id="cb19-5"><a href="#cb19-5"></a></span>
<span id="cb19-6"><a href="#cb19-6"></a>Parameters<span class="op">:</span></span>
<span id="cb19-7"><a href="#cb19-7"></a><span class="st">      </span>Estimate Std. Error t value <span class="kw">Pr</span>(<span class="op">&gt;</span><span class="er">|</span>t<span class="op">|</span>)    </span>
<span id="cb19-8"><a href="#cb19-8"></a>Linf <span class="fl">4.793e+02</span>  <span class="fl">1.864e+00</span>  <span class="fl">257.08</span>   <span class="op">&lt;</span><span class="fl">2e-16</span> <span class="op">**</span><span class="er">*</span></span>
<span id="cb19-9"><a href="#cb19-9"></a>K    <span class="fl">5.023e-01</span>  <span class="fl">7.587e-03</span>   <span class="fl">66.20</span>   <span class="op">&lt;</span><span class="fl">2e-16</span> <span class="op">**</span><span class="er">*</span></span>
<span id="cb19-10"><a href="#cb19-10"></a>t0   <span class="fl">5.030e-01</span>  <span class="fl">6.020e-03</span>   <span class="fl">83.56</span>   <span class="op">&lt;</span><span class="fl">2e-16</span> <span class="op">**</span><span class="er">*</span></span>
<span id="cb19-11"><a href="#cb19-11"></a><span class="op">---</span></span>
<span id="cb19-12"><a href="#cb19-12"></a>Signif. codes<span class="op">:</span><span class="st">  </span><span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb19-13"><a href="#cb19-13"></a></span>
<span id="cb19-14"><a href="#cb19-14"></a>Residual standard error<span class="op">:</span><span class="st"> </span><span class="fl">30.23</span> on <span class="dv">10328</span> degrees of freedom</span>
<span id="cb19-15"><a href="#cb19-15"></a></span>
<span id="cb19-16"><a href="#cb19-16"></a>Number of iterations to convergence<span class="op">:</span><span class="st"> </span><span class="dv">4</span> </span>
<span id="cb19-17"><a href="#cb19-17"></a>Achieved convergence tolerance<span class="op">:</span><span class="st"> </span><span class="fl">1.065e-06</span></span></code></pre></div>
<p>If we make a new sequence of ages, we can even predict mean length at age:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># New sequence of ages with tiny steps</span></span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="co"># to make the line look smooth</span></span>
<span id="cb20-3"><a href="#cb20-3"></a>  newage &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">13</span>, <span class="fl">.5</span>)</span>
<span id="cb20-4"><a href="#cb20-4"></a></span>
<span id="cb20-5"><a href="#cb20-5"></a><span class="co"># Get parameters</span></span>
<span id="cb20-6"><a href="#cb20-6"></a>  params =<span class="st"> </span><span class="kw">summary</span>(mymod)<span class="op">$</span>coefficients</span>
<span id="cb20-7"><a href="#cb20-7"></a></span>
<span id="cb20-8"><a href="#cb20-8"></a><span class="co"># Predict mean length at age:</span></span>
<span id="cb20-9"><a href="#cb20-9"></a>  pred =<span class="st"> </span>params[<span class="dv">1</span>,<span class="dv">1</span>]<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span><span class="kw">exp</span>(<span class="op">-</span>params[<span class="dv">2</span>,<span class="dv">1</span>]<span class="op">*</span>(newage<span class="op">-</span>params[<span class="dv">3</span>,<span class="dv">1</span>])))</span></code></pre></div>
<p>And finally, we can plot this against the raw data:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># Plot the raw data</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>  <span class="kw">plot</span>(shad<span class="op">$</span>Age,</span>
<span id="cb21-3"><a href="#cb21-3"></a>       shad<span class="op">$</span>FL,</span>
<span id="cb21-4"><a href="#cb21-4"></a>       <span class="dt">pch=</span><span class="dv">21</span>, </span>
<span id="cb21-5"><a href="#cb21-5"></a>       <span class="dt">bg=</span><span class="kw">rgb</span>(<span class="fl">0.8</span>, <span class="fl">0.8</span>, <span class="fl">0.8</span>, <span class="fl">0.15</span>),</span>
<span id="cb21-6"><a href="#cb21-6"></a>       <span class="dt">col=</span><span class="kw">rgb</span>(<span class="fl">0.8</span>, <span class="fl">0.8</span>, <span class="fl">0.8</span>, <span class="fl">0.15</span>),</span>
<span id="cb21-7"><a href="#cb21-7"></a>       <span class="dt">xlab =</span> <span class="st">&#39;Age (years)&#39;</span>,</span>
<span id="cb21-8"><a href="#cb21-8"></a>       <span class="dt">ylab =</span> <span class="st">&#39;Fork length (mm)&#39;</span>,</span>
<span id="cb21-9"><a href="#cb21-9"></a>       <span class="dt">yaxt=</span><span class="st">&#39;n&#39;</span></span>
<span id="cb21-10"><a href="#cb21-10"></a>       )</span>
<span id="cb21-11"><a href="#cb21-11"></a>  <span class="kw">axis</span>(<span class="dv">2</span>, <span class="dt">las=</span><span class="dv">2</span>)</span>
<span id="cb21-12"><a href="#cb21-12"></a>       </span>
<span id="cb21-13"><a href="#cb21-13"></a><span class="co"># Add the mean length at age predictions</span></span>
<span id="cb21-14"><a href="#cb21-14"></a>  <span class="kw">lines</span>(<span class="dt">x=</span>newage, <span class="dt">y=</span>pred, <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">col=</span><span class="st">&#39;gray40&#39;</span>)</span></code></pre></div>
<p><img src="02_fishStats_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<div id="closing-remarks" class="section level3">
<h3>Closing remarks</h3>
<p>Okay, if that’s not all we have time for we can poke around with some other stuff when we meet. But, this should at least demystify a little bit of R for you, and hopefully it gives you the chance to get into some of this on your own. When in doubt, remember that good information is still available in those paper objects called books, but Google is really your BFF when it comes to getting help with R.</p>
<!--  -->
<!-- One more useful aspect of these estimates is that we can estimate annual mortality rate (Z) from the von Bertalanffy growth parameters. A simple way to do this is to use the method of Jensen (1996) and estimate Z as $1.5 x k$: -->
<!--  -->
<!-- ```{r} -->
<!-- # Estimate mortality of pinfish -->
<!--   1.5*0.3781 -->
<!-- ``` -->
<!--  -->
<!-- ## Survival and mortality -->
<!-- One other piece of information that we might be very interested in using for fishery stock assessment is mortality. Of course, we can think of mortality both in terms of annual rates, and in terms of instantaneous rates.  -->
<!-- One of the easiest tools with which we can estimate mortality is the catch curve. We can use catch curves to estimate mortality based on a linear regression of abundance on age. This can be kind of a pain to do by hand, and there are a lot of different methods that we can use to do this. -->
<!-- Thankfully, a lot of this stuff has been packaged in R within the `fishmethods` package for us. The basic tool for estimating mortality from catch curves allows us to choose a single method, or a bunch of different methods. All we need to know is the age of fish in a sample and how many there were! -->
<!-- Here is an example:  -->
<!--  -->
<!-- ```{r} -->
<!-- # Load the built-in rockbass data -->
<!--   data(rockbass) -->
<!-- # Calculate both annual survival and -->
<!-- # instantaneous mortality rates using -->
<!-- # a variety of estimators. -->
<!--   agesurv(age=rockbass$age, full=6) -->
<!-- ``` -->
<!--  -->
<!-- You'll notice here that the instantaneous mortality rates can be greater than one because this is actually the same as `-log(S)`, as you may remember from other classes- so, no need to freak out because you are getting numbers > 1.00. -->
<!-- As a sanity check, we could even go back and estimate the annual mortality of pinfish from our example above and compare it to the value of 0.567 that we got from the von Bertalanffy growth parameters: -->
<!--  -->
<!-- ```{r} -->
<!-- # Estimate mortality of pinfish using -->
<!-- # catch-curve analysis assuming full  -->
<!-- # recruitment to gear by age 2: -->
<!-- agesurv(age=round(pinfish$age), full=2) -->
<!-- ``` -->
<!--  -->
<!-- Here, we can see that the estimates are pretty close because most estimates of annual survival are about `0.43` or `0.44`, and `1-0.43 = 0.57`! -->
<!--  -->
<!-- ## Exercise -->
<!-- Now, it is time for you to take the steering wheel. Try some of the following exercises to test your skills. -->
<!--  -->
<!-- ### Read in the data -->
<!-- Read in the data contained in `cando.csv` and save it to a named object. -->
<!-- ```{r} -->
<!-- cando = read.csv('cando.csv') -->
<!-- ``` -->
<!--  -->
<!-- This file contains lengths and ages for walleye and yellow perch in Canadarago Lake. There are 3854 individual fish. We will use these for the exercises below. For the sake of demonstration, let's just pretend that these data come from a set of years during which we might not have expected to see much change in population demographics (maybe not the case for Canadarago!) -->
<!--  -->
<!-- ### L-f histogram -->
<!-- Make a length-frequency histogram of walleye using one of the methods described above. About how many age classes does it look like you have here? -->
<!--  -->
<!-- ### PSD -->
<!-- Calculate PSD seperately for walleye and yellow perch in Canadarago Lake using the psdCalc function in the FSA package. Note that you will have to use only those data for the species you want to work with. For example, you could make a yellow perch dataframe like this: -->
<!--  -->
<!-- ```{r} -->
<!-- # Make a new df containing only yellow perch -->
<!-- yp = cando[cando$Name=='Yellow Perch', ] -->
<!-- ``` -->
<!--  -->
<!-- ```{r, eval=FALSE, echo=FALSE} -->
<!-- yp = cando[cando$Name=='Yellow Perch', ] -->
<!-- wae = cando[cando$Name=='Walleye', ] -->
<!-- psdCalc(~Length, data=yp, species="Yellow perch",digits=1) -->
<!-- psdCalc(~Length, data=wae, species="Walleye",digits=1) -->
<!-- ``` -->
<!--  -->
<!-- Plot the tic-tac-toe graph of PSD values for walleye and yellow perch. What does the graph indicate with respect to the balance in this fishery? -->
<!--  -->
<!-- ```{r, eval = FALSE, echo=FALSE} -->
<!-- prey <- c(53.5, 48.5, 58.6) -->
<!-- pred <- c(78.3, 75.6, 81.1) -->
<!-- tictactoe(predobj = c(30, 70), preyobj = c(30, 70), predlab = "Predator PSD", preylab = "Prey PSD", obj.col = "black", obj.trans = 0.2, bnd.col = "black", bnd.lwd = 1, bnd.lty = 2)  -->
<!-- tictactoe() -->
<!-- if (require(plotrix)) { -->
<!--   plotCI(prey[1],pred[1],li=prey[2],ui=prey[3],err="x",pch=16,add=TRUE) -->
<!--   plotCI(prey[1],pred[1],li=pred[2],ui=pred[3],err="y",pch=16,add=TRUE) -->
<!-- }   -->
<!-- ``` -->
<!--  -->
<!-- ### Growth -->
<!--  -->
<!-- Estimate growth parameters of the von Bertalanffy growth model for walleye and yellow perch using the ```growth``` function in the ```fishmethods``` package. Note that you might need to supply new starting values for Sinf... -->
<!-- ```{r, eval=FALSE, echo=FALSE} -->
<!-- # Fit a growth curve for yellow perch -->
<!--   growth(intype=1, unit=1, size=yp$Length, age=yp$Age, -->
<!--   calctype=1, wgtby=1, error=1, Sinf=300, K=0.3, t0=-1) -->
<!-- # Fit a growth curve for walleye -->
<!--   growth(intype=1,unit=1,size=wae$Length,age=wae$Age, -->
<!--   calctype=1, wgtby=1, error=1, Sinf=600,K=0.3, t0=-1) -->
<!-- ``` -->
<!--  -->
<!-- What are the expected annual mortality rates for yellow perch and walleye in this system based on the von Bertalanffy growth parameters? -->
<!-- ### Mortality -->
<!--  -->
<!-- Finally, wrap this up by estimating mortality of yellow perch and walleye using catch-curve analysis. Let's assume that both yellow perch and walleye are both fully recruited to our sampling gear by age 3. -->
<!--  -->
<!-- ```{r, eval=FALSE, echo=FALSE} -->
<!-- agesurv(age=round(wae$Age),full=7) -->
<!-- ``` -->
<!--  -->
<!-- How do these values compare to the life-history estimates from the von Bertalanffy growth model? What do you think might be causing this discrepancy? -->
<!--  -->
<!--  -->
</div>
</div>
</div>

<!DOCTYPE html>

<br>

<hr>

<p style="color:gray; text-align:center">This work is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/legalcode">Creative Commons Attribution 4.0 International License</a>. Data are provided for educational purposes only unless otherwise noted.</p>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
