<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Intermediate R</title>

<script src="site_libs/header-attrs-2.17/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<!DOCTYPE html>
<head>
<!-- Favicon for various operating systems -->
<link rel="apple-touch-icon" sizes="180x180" href="./favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="./favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="./favicon/favicon-16x16.png">
<!-- <link rel="manifest" href="./favicon/site.webmanifest"> -->
<link rel="mask-icon" href="./favicon/safari-pinned-tab.svg" color="#603cba">
<link rel="shortcut icon" href="./favicon/favicon.ico">
<meta name="msapplication-TileColor" content="#603cba">
<meta name="msapplication-config" content="./favicon/browserconfig.xml">
<meta name="theme-color" content="#382121">
</head>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R4NALMS</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="software.html">Before the workshop</a>
</li>
<li>
  <a href="morning.html">Introductory</a>
</li>
<li>
  <a href="afternoon.html">Intermediate</a>
</li>
<li>
  <a href="resources.html">Resources</a>
</li>
<li>
  <a href="instructors.html">Instructors</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://www.youtube.com/channel/UCcQsWXjTXYIfGTAJyxDaAyw/">
    <span class="fa fa-youtube"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/danStich/danStich.github.io/tree/master/r4nalms">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Intermediate R</h1>

</div>


<p><img src="images/secchi.jpg" alt=""></p>
<h2 top-margin:10px;><b> Introduction </b></h2>
<p>As folks learned in the Introductory session, once we have a basic
grasp on how R works, and how and where to find help, the learning
process becomes a lot less painful, and we can start to build an
appreciation for how convenient it is to have a script we can come back
to again and again. To show off this convenience, and the power of R as
a statistics program, we will spend the afternoon session walking
through some applied analyses and data visualization tools.</p>
<p>The plan for the Intermediate session is to work through two a
combination of long-term and seasonal examples of common analyses in
lake management. We will start with the Otsego Lake data from the
Introductory session and do some data manipulation, statistical
analyses, and visualization of long-term changes in a single lake. We’ll
then look at how this can be applied to many lakes at once using the
same tools. Finally, we’ll wrap things up by investigating seasonal
changes in the Otsego Lake water column throughout the year by making
some isopleths.</p>
<p>We will work with functions from a bunch of packages within the
<code>tidyverse</code> for this session. You can go ahead and load that
now. We will load a few others as we go along in this module, and during
the workshop.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<div id="data-overview-and-management" class="section level2">
<h2><strong>Data overview and management</strong></h2>
<p>Before we ever get into a statistical analysis, it is always good
practice to have a good, long look at the data we are working with to
make sure everything makes sense, and to note issues that may rear their
heads down the road. Let’s start by reading in the Otsego Lake data and
getting reacquainted. This data set is part of a long-term monitoring
data set collected by the SUNY Oneonta Biological Field Station at
Otsego Lake in Cooperstown, NY. We read the data in with the argument
<code>stringsAsFactors = FALSE</code> because there are a lot of string
variables in the data, and factors can add extra handling time to our
workflow (see <a href="introductory.html"> Introductory session tutorial
</a>).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>otsego <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/physical.csv&quot;</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>So, what are we working with here? Let’s have a look. Remember from
the Introductory session that it might be useful to understand how R
sees your data first and foremost. The most reliable method for doing
this with dataframes is to look at the <strong>structure</strong> of
your data using <code>str()</code> or the <code>glimpse()</code>
function from the <code>tidyverse</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Like this:</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(otsego)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>Rows<span class="sc">:</span> <span class="dv">11</span>,<span class="dv">339</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>Columns<span class="sc">:</span> <span class="dv">9</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span> date    <span class="sc">&lt;</span>chr<span class="sc">&gt;</span> <span class="st">&quot;1/29/1988&quot;</span>, <span class="st">&quot;1/29/1988&quot;</span>, <span class="st">&quot;1/29/1988&quot;</span>, <span class="st">&quot;1/29/1988&quot;</span>, <span class="st">&quot;1/29/1988…</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="st">$ year    &lt;int&gt; 1988, 1988, 1988, 1988, 1988, 1988, 1988, 1988, 1988, 1988, 19…</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="st">$ month   &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2,…</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="st">$ depth   &lt;dbl&gt; 48.0, 46.0, 44.0, 40.0, 35.0, 42.0, 30.0, 25.0, 20.0, 18.0, 16…</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="st">$ temp    &lt;dbl&gt; 2.84, 2.65, 2.52, 2.44, 2.43, 2.41, 2.38, 2.16, 1.94, 1.86, 1.…</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="st">$ ph      &lt;dbl&gt; 7.56, 7.71, 7.76, 7.77, 7.79, 7.77, 7.79, 7.80, 7.82, 7.82, 7.…</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="st">$ do_mgl  &lt;dbl&gt; 8.4, 9.8, 10.4, 10.5, 10.6, 10.6, 10.7, 10.9, 11.3, 11.3, 11.5…</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="st">$ sp_cond &lt;dbl&gt; 0.320, 0.308, 0.310, 0.308, 0.307, 0.307, 0.302, 0.308, 0.311,…</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="st">$ do_sat  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span></span></code></pre></div>
<p>Now that we have an idea of what the data set looks like, let’s take
a little closer look. First, there are a couple of things that we can do
that will clean up our code down the road a little bit. Let’s have a
quick look at our column names again.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(otsego)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;date&quot;</span>    <span class="st">&quot;year&quot;</span>    <span class="st">&quot;month&quot;</span>   <span class="st">&quot;depth&quot;</span>   <span class="st">&quot;temp&quot;</span>    <span class="st">&quot;ph&quot;</span>      <span class="st">&quot;do_mgl&quot;</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">8</span>] <span class="st">&quot;sp_cond&quot;</span> <span class="st">&quot;do_sat&quot;</span> </span></code></pre></div>
<p>Most of these are nice and clean, but there are some things that
happen when we read data into R from Excel files (like replacing special
characters with <code>...</code>). Plus, the less we have to change when
it comes time to plot the better off we’ll be.</p>
<p>We are not going to replace all of the names, because we are not
going to work with all of the columns, but let’s replace a couple of
these that we are definitely going to use (if only to show how this
works). For now, let’s just change the name for <code>temp</code> so
that it is easier to recognize as temperature.</p>
<p>Remember that the result of <code>names(otsego)</code> is a vector,
and we can replace individual elements of that vector. We just need to
know the index of the element we wish to replace. In this case,
<code>temp</code> is the 3rd column of the dataframe
<code>otsego</code>.</p>
<p>Here is how it works:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, we replace temp with Temperature</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(otsego)[<span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Temperature&quot;</span></span></code></pre></div>
<p>Have a quick look to make sure you are happy with the new names.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the names of the df</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># to the console so we can</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># see them.</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(otsego)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;date&quot;</span>        <span class="st">&quot;year&quot;</span>        <span class="st">&quot;month&quot;</span>       <span class="st">&quot;depth&quot;</span>       <span class="st">&quot;Temperature&quot;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">6</span>] <span class="st">&quot;ph&quot;</span>          <span class="st">&quot;do_mgl&quot;</span>      <span class="st">&quot;sp_cond&quot;</span>     <span class="st">&quot;do_sat&quot;</span>     </span></code></pre></div>
</div>
<div id="data-manipulation" class="section level2">
<h2><strong>Data manipulation</strong></h2>
<p>Now that we have had a quick look at our data, and we have made some
changes for the sake of convenience, let’s dig a little deeper. This
afternoon, we are going to use <code>Temperature</code> as our
<strong>response</strong>, or <strong>dependent variable</strong> to
demonstrate some basic statistical techniques in R. Before we can do any
actual statistics, though, it is good practice to scrutinize the data we
intend to use.</p>
<p>First, we’ll need to go ahead and do some work to get variables like
<code>month</code> and <code>year</code> out of our <code>date</code>
column. To do this, we’ll use functions from the <code>lubridate</code>
package.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get date in a standard, unambiguous format</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>otsego<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(otsego<span class="sc">$</span>date, <span class="at">format =</span> <span class="st">&quot;%m/%d/%Y&quot;</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a variable to hold year in the df</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>otsego<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">year</span>(otsego<span class="sc">$</span>date)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert month to a factor so it can be easily re-leveled and ordered</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>otsego<span class="sc">$</span>month <span class="ot">&lt;-</span> month.abb[otsego<span class="sc">$</span>month]</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>otsego<span class="sc">$</span>month <span class="ot">&lt;-</span> <span class="fu">factor</span>(otsego<span class="sc">$</span>month, <span class="at">levels =</span> month.abb)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s make an ordinal date variable to get day of year as well</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>otsego<span class="sc">$</span>doy <span class="ot">&lt;-</span> <span class="fu">yday</span>(otsego<span class="sc">$</span>date)</span></code></pre></div>
<div id="data-exploration" class="section level3">
<h3><strong>Data exploration</strong></h3>
<p>Now that we at least have a handle on where our data come from, we
can start to poke around a bit more.</p>
<p>To start with, let’s take a quick look at <code>Temperature</code> in
our original <code>otsego</code> dataset using a histogram. If we were
going to do some statistical analyses, this would be our response of
interest in the data set!</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(otsego, <span class="fu">aes</span>(<span class="at">x =</span> Temperature)) <span class="sc">+</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>)</span></code></pre></div>
<p><img src="intermediate_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>From this plot alone, there are a few things that should be
obvious.</p>
<p>First, we can see that the distribution of our response is
<strong>right-skewed</strong>, with many more observations between 4 and
10 degrees Celsius than at the extremes. This should make intuitive
sense based on the depth of the lake (about 50 m) and the fact that this
lake is temperately located.</p>
<p>Second, perhaps more nuanced, is that there are a few zero values and
even a couple of negatives. Since we know that fresh water freezes at
zero degrees, then we can probably afford to get rid of these for our
purposes. If we had the ability, however, we would want to confirm that
this was appropriate to do.</p>
<p>We will need to think about both of these characteristics as we move
into statistical analyses. One of the central assumptions of modern
regression tools relates to normality of residuals, which in the absence
of heterogeneous groups, can initially be approximated using a histogram
of the response. And, transformations that we might wish to use to
achieve normality can be sensitive to the presence of zeroes or negative
values.</p>
</div>
</div>
<div id="data-transformations" class="section level2">
<h2><strong>Data transformations</strong></h2>
<p>We can handle both of these problems by log-transforming our response
variable like this:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>otsego<span class="sc">$</span>log_temperature <span class="ot">&lt;-</span> <span class="fu">log</span>(otsego<span class="sc">$</span>Temperature)</span></code></pre></div>
<p>We can plot histogram of the residuals again to see what it did:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(otsego, <span class="fu">aes</span>(<span class="at">x =</span> log_temperature)) <span class="sc">+</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>)</span></code></pre></div>
<p><img src="intermediate_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>Our residuals look more like a normal distribution now, although
there is still some skew. Now it is just going in the other direction
[eye roll].</p>
<p>As you can see, our response variable is no longer constrained to be
greater than zero on the log scale, so we don’t have to worry about
getting negative predictions from any of the statistical models that we
make now either. We’ll just have to deal with that on the back end.</p>
<p>You should also notice that in both cases now, you’ve gotten warnings
to let you know that we have some missing or non-finite values. We’ll be
sure to remove these prior to any analyses to make our lives easier down
the road. Let’s filter the data set to get only those observations with
non-zero temperatures to make our lives a little easier:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>otsego <span class="ot">&lt;-</span> otsego <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Temperature) <span class="sc">&amp;</span> Temperature <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code></pre></div>
<p>Now we can move forward with some statistics!</p>
</div>
<div id="introductory-statistics-in-r" class="section level2">
<h2><strong>Introductory statistics in R</strong></h2>
<p>Let’s start with the simple case of comparing
<code>Temperature</code> between the epilimnion and hypolimnion of the
lake. If you have a basic understanding of statistics, you might
immediately realize that this is a comparison of a continuous variable
between two groups. We have a couple of paths forward here. We could
either set aside distributional assumptions and use
<strong>non-parametric</strong> methods, or we could assume some
distribution for our error structure and proceed using
<strong>parametric</strong> or <strong>semi-parametric</strong>
statistics. Please note that these assumptions should not necessarily be
based on the histogram of the data that we created above.</p>
<p>In either case, we are going to have to make sure we assign each
observation to either the epilimnion or hypolimnion before we can
start.</p>
<p>To do this, we’ll create a new variable in the data set.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>otsego<span class="sc">$</span>layer <span class="ot">&lt;-</span> <span class="st">&quot;epilimnion&quot;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>otsego<span class="sc">$</span>layer[otsego<span class="sc">$</span>depth <span class="sc">&gt;</span> <span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="st">&quot;hypolimnion&quot;</span> </span></code></pre></div>
<div id="wilcoxon-rank-sums-test" class="section level3">
<h3><strong>Wilcoxon rank-sums test</strong></h3>
<p>Let’s start by fitting a quick Wilcoxon rank-sums test (aka
Mann-Whitney U-test). While our options for non-parametric statistics
are limited in complexity, they do not require distributional
assumptions, and they tend to be more <strong>conservative</strong> than
parametric tests, especially under limited sample sizes (not the case
here).</p>
<p>Here is how we do it:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Wilcox test to assess the null hypothesis</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># that there is no difference in temperature between</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># epilimnion and hypolimnion.</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(Temperature <span class="sc">~</span> layer, <span class="at">data =</span> otsego)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    Wilcoxon rank sum test with continuity correction</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>data<span class="sc">:</span>  Temperature by layer</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>W <span class="ot">=</span> <span class="dv">25639031</span>, p<span class="sc">-</span>value <span class="sc">&lt;</span> <span class="fl">2.2e-16</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>alternative hypothesis<span class="sc">:</span> true location shift is not equal to <span class="dv">0</span></span></code></pre></div>
<p>Okay, if you have never done a Wilcox test by hand, or even in Excel,
please appreciate how <strong>ridiculously easy</strong> this is. But,
more importantly, what is going in the output here?</p>
<p>We can see that we have conducted a Wilcoxon rank sum test. Second, R
gives us a friendly reminder of what our data were that went into this.
Next, we have the actual statistics for the test, including the test
statistic <code>W</code> and the <code>p-value</code> for the
comparison. With the handy-dandy <code>alternative hypothesis</code>
that R provides us, we can conclude that since p &lt; 0.05 we reject the
null hypothesis that there is no difference between groups.</p>
<p>While this is useful for making inference, we don’t get a good sense
of how the group means actually differed from this test (although we
could graph it). For that, we need to start making some assumptions
about our data and the shape of the error associated with those
data.</p>
</div>
<div id="parametric-statistics-in-r" class="section level3">
<h3><strong>Parametric statistics in R</strong></h3>
<p>Parametric statistics rely on some basic <strong>assumptions</strong>
about or data and the error structure around our observations. There are
a number of fundamental assumptions that guide our forays into what is
essentially “the rest of statistics”. How we deal with these assumptions
can range from doing nothing, to data transformation, to use of
alternative model structures that allow us to shift or relax them.</p>
<p>What are these assumptions? Glad you ask!</p>
</div>
<div id="assumptions-of-linear-models" class="section level3">
<h3><strong>Assumptions of linear models</strong></h3>
<p>Linear models you say? Yes. While we don’t have time to go in the
ugly math behind this (ahem, <strong>the beautiful, unifying
math</strong> behind this), suffice to say that most of the statistics
we use in aquatic research are special cases, or generalizations, of the
linear model. This includes things like t-tests, linear regression,
ANOVA, ANCOVA, GLM, GLMM, GLS, GEE, and even multivariate statistics.
The same holds true whether we are working with classical frequentist
tools relying on least-squares estimation and maximum likelihood, or
Bayesian methods using MCMC estimation. That means we always need to
have these assumptions in mind.</p>
<p>Briefly, these assumptions include:</p>
<p><strong>1.</strong> Independence of observations.</p>
<p><strong>2.</strong> Normality of residuals (with mean=0).</p>
<p><strong>3.</strong> Homogeneity of variances
(i.e. homoscedasticity).</p>
<p>We will discuss quickly in the afternoon session, but a more detailed
explanation of each can be found <a href="assumptions.html"> here </a>.
This is definitely something you should be comfortable with before
getting crazy with the stats.</p>
</div>
<div id="the-t-test" class="section level3">
<h3><strong>The t-test</strong></h3>
<p>The t-test is our go-to tool for comparing two group means with
parametric statistics. Even when we use analysis of variance (ANOVA) to
test for differences in means between more than two groups, we still
need to use t-tests to follow up and determine pair-wise differences
(usually using a Tukey HSD or analagous test to control family-wise
error rates).</p>
<p>Using a t-test in R is pretty straightforward. For this example, we
will use a t-test to test the null hypothesis that there is no
difference in <code>Secchi</code> between <code>Lake</code> and
<code>Reservoir</code> classes. To do this, we use the function
<code>t.test()</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># T-test to assess the null hypothesis</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># that there is no difference in temperature</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># between the epilimnion and hypolimnion in Otsego Lake.</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># We use log_temperature to meet assumptions</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># of normality.</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># We can specify this one using a formula.</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># To be conservative here, we will assume</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co"># that we have unequal variances using</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># one of the optional arguments. Note that</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co"># the default in R is to assume that variances</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co"># are not equal, and this defaults to</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co"># a Welch&#39;s t-test that uses a calculated df</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co"># to adjust the calculated test statistic.</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(log_temperature <span class="sc">~</span> layer, <span class="at">data =</span> otsego, <span class="at">equal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    Welch Two Sample t<span class="sc">-</span>test</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>data<span class="sc">:</span>  log_temperature by layer</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>t <span class="ot">=</span> <span class="fl">54.947</span>, df <span class="ot">=</span> <span class="dv">6136</span>, p<span class="sc">-</span>value <span class="sc">&lt;</span> <span class="fl">2.2e-16</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>alternative hypothesis<span class="sc">:</span> true difference <span class="cf">in</span> means between group epilimnion and group hypolimnion is not equal to <span class="dv">0</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="dv">95</span> percent confidence interval<span class="sc">:</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a> <span class="fl">0.6318867</span> <span class="fl">0.6786428</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>sample estimates<span class="sc">:</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a> mean <span class="cf">in</span> group epilimnion mean <span class="cf">in</span> group hypolimnion </span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>                 <span class="fl">2.289787</span>                  <span class="fl">1.634522</span> </span></code></pre></div>
<p>Yay, more output!</p>
<p>Similar to the <code>wilcox.test</code>, the output of our
<code>t.test</code> gives us the test that was used, the data provided
to the function, the test statistics (now with <code>df</code>), and the
<code>alternative hypothesis</code> to be accepted if p &lt; 0.05. But,
in contrast to the Wilcox, we have a little more information to go
on.</p>
<p>This time, we get an actual confidence interval our estimate of the
difference between groups. Here, we see that we are 95% confident that
the true difference in <code>Temperature</code> between
<code>epilimnion</code> and <code>hypolimnion</code> is between 0.63 and
0.68. Note that this difference is positive because of the alphabetical
ordering of the layers. If we had reversed this, our 95% confidence
interval on the estimated difference would have used negative values. In
either case, we can now say that the epilimnion is warmer than the
hypolimnion…shocker.</p>
<p>R also tells us that the mean of <code>log_temperature</code> is 2.29
for <code>epilimnion</code> and 1.63 for <code>hypolimnion</code>. We
can bring these back to the real scale using the function
<code>exp</code> to say that the mean of <code>Temperature</code> is
9.87 for <code>epilimnion</code> and 5.13 for
<code>hypolimnion</code>.</p>
<p>We could go about showing these differences graphically using (for
example) a violin plot.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> otsego,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> layer, <span class="at">y =</span> log_temperature, <span class="at">color =</span> layer, <span class="at">fill =</span> layer)) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">alpha =</span> <span class="fl">0.10</span>, <span class="at">draw_quantiles =</span> <span class="fl">0.50</span>)</span></code></pre></div>
<p><img src="intermediate_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>This plot shows us that there is clearly a lot more variability in
epilimnetic temperatures, as well! This is because we haven’t begun to
touch seasonal or long-term differences. We could start to tease apart
seasonal differences with another test from this same family.</p>
</div>
<div id="analysis-of-variance" class="section level3">
<h3><strong>Analysis of variance</strong></h3>
<p>It is only a small step to move from a t-test to analysis of variance
(ANOVA) conceptually, and this also requires only a small change to code
in R. In theory, ANOVA is usually used to compare means of a continuous
response when we have three or more groups. In practice, it is
mathematically equivelant to a t-test if we have only two groups (the
F-statistic is, in fact, just the sqaure of the t-statistic).</p>
<p>To demonstrate this, and to keep ourselves from being swept afield
with another data set, let’s demonstrate ANOVA by investigating seasonal
changes in lake-wide temperature.</p>
<p>It can be more convenient to store the results of ANOVA in an object
than just dumping the output to the console, so let’s start there.
First, we will fit our ANOVA with the <code>lm</code> function (stands
for linear model) because this is the most general tool for us.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit an ANOVA to test for differences in</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># means between groups</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(Temperature) <span class="sc">~</span> month, <span class="at">data =</span> otsego)</span></code></pre></div>
<p>Now, before we get into looking at p-values here, it is
<strong>important</strong> that <strong>we diagnose the model
first</strong>. But, we’ve only got a few hours to get through this so
we’ll skip it until the end of this analysis. I’m trying to tell a story
for now, bear with me.</p>
<p>We can make an ANOVA summary table in R using the lowercase
<code>anova</code> function to get overall factor significance.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get ANOVA summary for the model</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>Analysis of Variance Table</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>Response<span class="sc">:</span> <span class="fu">log</span>(Temperature)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>             Df Sum Sq Mean Sq F value    <span class="fu">Pr</span>(<span class="sc">&gt;</span>F)    </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>month        <span class="dv">11</span> <span class="fl">2187.7</span> <span class="fl">198.884</span>  <span class="fl">853.15</span> <span class="sc">&lt;</span> <span class="fl">2.2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>Residuals <span class="dv">11300</span> <span class="fl">2634.2</span>   <span class="fl">0.233</span>                      </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span></code></pre></div>
<p>Here, we can see that our factor <code>month</code> had a significant
effect on <code>Temperature</code>, and we can reject the null
hypothesis that there is no difference between any of the group
means.</p>
<p>From there, we can go on to make group-specific boxplots of the
response to make the difference clearer for the reader.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(otsego, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> Temperature)) <span class="sc">+</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="intermediate_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
</div>
<div id="linear-regression" class="section level3">
<h3><strong>Linear Regression</strong></h3>
<p>Non-parametric statistics, t-tests, and ANOVAs are great for testing
hypotheses about differences between groups, but they don’t really allow
us to examine changes that occur along continual gradients. In our
fields, those kinds of changes are often the things in which we are
actually interested. For example, we may wish to understand how
temperature or Secchi depth change with year to quantify long-term
trends. To do this, we will rely on linear regression.</p>
<p>Linear regression takes the familiar form of the equation for a
line:</p>
<p><span class="math inline">\(y = mx + b\)</span></p>
<p>Where <span class="math inline">\(y\)</span> is the dependent
variable, <span class="math inline">\(b\)</span> is the y-intercept,
<span class="math inline">\(m\)</span> is the slope of the line, and
<span class="math inline">\(X\)</span> is the independent variable.</p>
<p>In statistics, we write this as</p>
<p><span class="math inline">\(y_{i} = \beta_{0} + \beta_{j} \cdot
X_{j,i} + \epsilon_{i}\)</span></p>
<p>Where <span class="math inline">\(y_{i}\)</span> is the
<em>i</em><sup>th</sup> value of the dependent variable, <span
class="math inline">\(\beta_{0}\)</span> is the y-intercept, <span
class="math inline">\(\beta_{j}\)</span> is the slope of the line, <span
class="math inline">\(X_{j,i}\)</span> is an independent variable, and
<span class="math inline">\(\epsilon_{i}\)</span> is our error (assumed
to have a mean of zero so it can be dropped- that’s why it is important
to check).</p>
<p>More generally, we could extend this to have an arbitrarily large
number of slopes and independent variables (i.e., multiple
regression):</p>
<p><span class="math inline">\(y_{i} = \beta_{0} +
\sum_{\substack{j=0}}^k (\beta_{j} \cdot X_{j,i}, ..., \beta_{k} \cdot
X_{k,i}) + \epsilon_{i}\)</span></p>
<p>What fun!</p>
<p>How about fitting this kind of model in R? It will take us less time
than it did to write out the equations.</p>
<p>Here, we will fit a linear regression to test the effects of
<code>year</code> on <code>Temperature</code>. To do this, we can stick
with the <code>lm()</code> function.</p>
<p>Next, we will fit the model using the same <code>lm()</code> function
that we used for ANOVA above. The reason we can do this is that ANOVA,
t-tests, and linear regressions are all just specific cases of the
linear model.</p>
<p>We will fit a model testing the effect of <code>year</code> on
<code>Temperature</code>.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>lmod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(Temperature) <span class="sc">~</span> year, <span class="at">data =</span> otsego)</span></code></pre></div>
<p>We can get the regression coefficients for our model directly from a
summary of a fitted model object.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmod)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> <span class="fu">log</span>(Temperature) <span class="sc">~</span> year, <span class="at">data =</span> otsego)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    Min      1Q  Median      3Q     Max </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">5.8032</span> <span class="sc">-</span><span class="fl">0.3608</span> <span class="sc">-</span><span class="fl">0.0943</span>  <span class="fl">0.3745</span>  <span class="fl">1.3695</span> </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>              Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>(Intercept) <span class="sc">-</span><span class="fl">4.6433230</span>  <span class="fl">1.2440197</span>  <span class="sc">-</span><span class="fl">3.733</span> <span class="fl">0.000191</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>year         <span class="fl">0.0032721</span>  <span class="fl">0.0006207</span>   <span class="fl">5.271</span> <span class="fl">1.38e-07</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">0.6522</span> on <span class="dv">11310</span> degrees of freedom</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.002451</span>,  Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.002363</span> </span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">27.79</span> on <span class="dv">1</span> and <span class="dv">11310</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="fl">1.379e-07</span></span></code></pre></div>
<p>Here, <code>(Intercept)</code> is the y-intercept for our model, and
<code>year</code> is our “slope”. In this case, we see that our
y-intercept is significantly different from zero (p = 0.00019), and we
detected a significant effect of <code>Latitude</code> on
<code>logSecchi</code> (p = 1.4e-07). The interpretation of the latter
is that the slope is not equal to zero.</p>
<p>Looking a little closer at the output, we can also see that we have
only explained about 0.2% of the variability in <code>Temperature</code>
using <code>year</code> as the only explanatory variable (R<sup>2</sup>
= 0.002). But, let’s plot the result anyway.</p>
<p>In order to plot the result of our model, we need to make some
predictions from it first. This is super easy to do in R. You’ll get a
warning that you are making predictions from the observed data even
though this is supposed to be fore future predictions on new data - fine
for now, can talk about that one when we have more time!</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>log_preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(lmod, <span class="at">interval =</span> <span class="st">&quot;prediction&quot;</span>)</span></code></pre></div>
<p>We just need to undo our log transformation once we have our
predictions so we can plot them:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert back to real scale</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>real_preds <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="at">X =</span> log_preds, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> exp)</span></code></pre></div>
<p>Let’s have a look at what our predictions look like:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a look at the first few</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># rows of the preds dataframe</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(real_preds)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>     fit     lwr      upr</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="fl">6.4346</span> <span class="fl">1.79168</span> <span class="fl">23.10908</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="fl">6.4346</span> <span class="fl">1.79168</span> <span class="fl">23.10908</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="fl">6.4346</span> <span class="fl">1.79168</span> <span class="fl">23.10908</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="fl">6.4346</span> <span class="fl">1.79168</span> <span class="fl">23.10908</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="fl">6.4346</span> <span class="fl">1.79168</span> <span class="fl">23.10908</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> <span class="fl">6.4346</span> <span class="fl">1.79168</span> <span class="fl">23.10908</span></span></code></pre></div>
<p>Now we can smash them back together with the raw data:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>otsego_preds <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(otsego, real_preds)</span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(otsego_preds, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> Temperature)) <span class="sc">+</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.10</span>) <span class="sc">+</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> fit), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lwr, <span class="at">ymax =</span> upr),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;gray87&quot;</span>,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> .<span class="dv">5</span>,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">lty =</span> <span class="dv">2</span>,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">lwd =</span> .<span class="dv">5</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="intermediate_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>Wow, this graph is almost as underwhelming as the R<sup>2</sup> for
the model that was used to create it. If we had just reported p-values,
this would have gone un-noticed and someone might have misused the
result. The graph and the R<sup>2</sup> tell us that our model, while
statistically significant, doesn’t do a great job capturing the trends
in our data. You can even see in this graph that we are uncertain about
the actual slope of the line by looking at the lower, mean, and upper
prediction intervals. If you have been paying attention, or if you spend
much time on glacial lakes above latitude 42 N, then you know that this
is because 1) there is a ton of seasonal variability that we haven’t
captured in this regression and 2) we are looking at depths throughout
the lake, which are not likely to change in temperature the same way.
How to fix this?</p>
</div>
<div id="analysis-of-covariance" class="section level3">
<h3>Analysis of covariance</h3>
<p>Analysis of covariance (ANCOVA) is as complex as we’ll get with data
analysis today. And, it is a great tool for understanding effects of
multiple explanatory variables as continuous responses. Without getting
into the math, it can accommodate both continuous explanatory variables
like <code>year</code> and categorical explanatory variables like
<code>month</code> names. We’ll wrap up this section by combining our
other examples to simultaneously model <code>Temperature</code> as a
function of <code>year</code> and <code>month</code>. This model tests
the hypothesis that temperature has changed across years since the
1990s, while accounting for variation among months.</p>
<p>To simplify, we will work just with the top 5 meters of the water
column so we don’t have to argue about how best to incorporate depth in
what time remains.</p>
<p>Filter the data to get just the first 5 meters.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>surface <span class="ot">&lt;-</span> otsego <span class="sc">%&gt;%</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(depth <span class="sc">&lt;=</span> <span class="dv">5</span>)</span></code></pre></div>
<p>Now we can fit the statistical model:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>surface_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(Temperature) <span class="sc">~</span> year <span class="sc">+</span> month, <span class="at">data =</span> surface) </span></code></pre></div>
<p>Typically, here we would do statistical inference next using
p-values, model selection, or cross-validation. And then, finally, We
can make predictions from this model the same way that we did for linear
regression and ANOVA. We’ll take some time to make this pretty during
the workshop, of course</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions from the model on the log scale</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>lpreds <span class="ot">&lt;-</span> <span class="fu">predict</span>(surface_mod, <span class="at">interval =</span> <span class="st">&quot;prediction&quot;</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Back-transform fit, lwr, upr to the real scale by exponentiating</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>rpreds <span class="ot">&lt;-</span> <span class="fu">apply</span>(lpreds, <span class="dv">2</span>, exp)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Smash it together with the original data.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Yes R, we know these are not future responses, just do it</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>lake_preds <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(surface, rpreds)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the predictions against the observed data</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(lake_preds, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> Temperature)) <span class="sc">+</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.10</span>) <span class="sc">+</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> fit)) <span class="sc">+</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">xmax =</span> year, <span class="at">ymin =</span> lwr, <span class="at">ymax =</span> upr), <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>month) <span class="sc">+</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="intermediate_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
</div>
</div>
<div id="response-surfaces-isopleths" class="section level2">
<h2><strong>Response surfaces (isopleths)</strong></h2>
<p>When we have more than one continuous variable in a regression model,
it can be helpful to think about <strong>surfaces</strong> instead of
<strong>lines</strong>. While it sounds difficult conceptually, these
are actually fairly common tools in our everyday lives. Elevation
contours are one such example of a response surface (think
<code>lm(elevation~latitude*longitude)</code> in the simplest sense now
that you are fluent in R).</p>
<p>In lake management, we frequently run across these kinds of
applications when we create <strong>bathymetric maps</strong> and
<strong>isopleths</strong>.</p>
<p>Here, we will investigate some basic tools for visualizing response
surfaces, and specifically, we will create some isopleths.</p>
<p>For this example, we will go back to the <code>otsego</code> data and
start by making an isopleth of <code>Temperature</code> for a single
year. In this crowd, the concept probably requires less explanation than
any of the statistics we’ve used so far, but basically we want to come
up with a 3-dimensional way to visualize changes in temperature across
time (days) and space (depth).</p>
<p><strong>NOTE</strong> that if we had just read this data set in, one
of the first things that we are going to have to deal with is the
formatting of dates in this data set. We have done this already.</p>
<p>Let’s start by creating a column with inverted depths so we can plot
the lake from surface to bottom and make the graph easier to read.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set this aside as a new object</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We&#39;ll drop any observations that lack data</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>lim <span class="ot">&lt;-</span> otsego <span class="sc">%&gt;%</span> </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(depth) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(doy) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(Temperature))</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiply depth column by -1 so depth will</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co"># plot from top to bottom.</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>lim<span class="sc">$</span>depth <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> lim<span class="sc">$</span>depth</span></code></pre></div>
<p>Now, we are ready to do the math behind the isopleth and plot it. To
do the math, we need to load the <code>akima</code> package:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(akima)</span></code></pre></div>
<p>Next, we interpolate <code>temp</code> across <code>date</code> and
<code>depth</code>. The interpolation we are using is basically just a
bunch of linear regressions to predict <code>temp</code> for values of
<code>date</code> and <code>temp</code> across a regular grid.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame containing the</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># x, y, and z variables of interest</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>plotter <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> lim<span class="sc">$</span>doy, <span class="at">y =</span> lim<span class="sc">$</span>depth, <span class="at">z =</span> lim<span class="sc">$</span>Temperature)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort it so we have ascending values of x and y</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>plotter <span class="ot">&lt;-</span> plotter[<span class="fu">with</span>(plotter, <span class="fu">order</span>(x, y)), ]</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a regularly spaced x, y, z grid using</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co"># linear interpolation from the akima package</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>im <span class="ot">&lt;-</span> <span class="fu">with</span>(</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  plotter,</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  akima<span class="sc">::</span><span class="fu">interp</span>(x, y, z,</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">duplicate =</span> <span class="st">&quot;mean&quot;</span>,</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">nx =</span> <span class="dv">360</span>,<span class="co">#length(unique(lim$doy)),</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">ny =</span> <span class="dv">50</span> <span class="co">#length(unique(lim$depth))</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>To wrap it all up, we can make the plot. This looks like a lot of
code, but it is mostly comments.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the isopleth</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># filled.contour is the function that actually</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co"># makes the contour plot. This is the same function</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># that is used in the wtr.heat.map function in the</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># RLakeAnalyzer package, but it is executed from</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co"># within a convenience wrapper there, so it is</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co"># hard to customize.</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co"># I tend to work with the filled.contour</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co"># function from the graphics package (included</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co"># in base R and loaded by default). This is</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co"># just a preference driven by need for</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co"># more flexibility.</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up plotting window margins</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">8</span>))</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the graph</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="fu">filled.contour</span>(</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>  im<span class="sc">$</span>x, <span class="co"># Variable on x-axis (date)</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>  im<span class="sc">$</span>y, <span class="co"># Variable on y-axis (depth)</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>  im<span class="sc">$</span>z, <span class="co"># Response (water quality parameter)</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Could also choose &#39;grey.colors&#39; or &#39;terrain.colors&#39;.</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If you want the ramp to go the other way,</span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># just delete the &#39;rev&#39;. Note that you will</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># need to change the 26 in parentheses to match</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the number of levels that you actually have or</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># want to display.</span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">topo.colors</span>(<span class="dv">30</span>),</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># I don&#39;t like in-figure titles.</span></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># You can add one, though. You will, however,</span></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># need to change the &#39;mar&#39; argument in the call</span></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># to par above.</span></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Temperature (&quot;</span>, degree, <span class="st">&quot;C)&quot;</span>)),</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Specify y-axis limits.</span></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">min</span>(im<span class="sc">$</span>y), <span class="fu">max</span>(im<span class="sc">$</span>y)),</span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Specify x-axis limits. In this case, we are &quot;zooming in&quot; on year 2017</span></span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Can use this one instead if date formatting throws error</span></span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># xlim = c(as.numeric(as.Date(&quot;2017/05/01&quot;)), max(im$x)),</span></span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">366</span>),</span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># X-axis label</span></span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;Day of Year&quot;</span>,</span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Y-axis label</span></span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;Depth (m)&quot;</span>,</span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This next block of code controls the lines that are overlaid. The interpolation</span></span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># is the same, so the axes and the number of levels need to be the same, too.</span></span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.axes =</span> {</span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">contour</span>(</span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a>      im<span class="sc">$</span>x, im<span class="sc">$</span>y, im<span class="sc">$</span>z, <span class="co"># X, Y, Z values (same)</span></span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a>      <span class="at">nlevels =</span> <span class="dv">26</span>, <span class="co"># Need to change this with the No. on line 37 to be same!</span></span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">26</span>, <span class="dv">1</span>), <span class="co"># Will need to change for different parameters</span></span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">drawlabels =</span> <span class="cn">FALSE</span>, <span class="co"># Don&#39;t want R to draw the labels, they are ugly</span></span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a>      <span class="at">add =</span> <span class="cn">TRUE</span>); <span class="co"># Add the lines to the existing plot</span></span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># X-axis to assign month abbreviation at first ordinal day of each month</span></span>
<span id="cb32-56"><a href="#cb32-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">32</span>, <span class="dv">61</span>, <span class="dv">92</span>, <span class="dv">122</span>, <span class="dv">153</span>, <span class="dv">183</span>, <span class="dv">214</span>, <span class="dv">245</span>, <span class="dv">275</span>, <span class="dv">306</span>, <span class="dv">336</span>),</span>
<span id="cb32-57"><a href="#cb32-57" aria-hidden="true" tabindex="-1"></a>         <span class="at">labels =</span> month.abb, <span class="at">cex.axis=</span><span class="fl">1.10</span></span>
<span id="cb32-58"><a href="#cb32-58" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb32-59"><a href="#cb32-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Y-axis</span></span>
<span id="cb32-60"><a href="#cb32-60" aria-hidden="true" tabindex="-1"></a>    <span class="do">### Change to match range of data</span></span>
<span id="cb32-61"><a href="#cb32-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axis</span>(<span class="at">side=</span><span class="dv">2</span>, <span class="at">at=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">50</span>, <span class="dv">0</span>, <span class="dv">5</span>), <span class="fu">seq</span>(<span class="dv">50</span>, <span class="dv">0</span>, <span class="sc">-</span><span class="dv">5</span>), <span class="at">las=</span><span class="dv">2</span>, <span class="at">yaxt=</span><span class="st">&#39;l&#39;</span>, <span class="at">cex.axis=</span><span class="fl">1.1</span>);</span>
<span id="cb32-62"><a href="#cb32-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add sampling points to x-axis</span></span>
<span id="cb32-63"><a href="#cb32-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(<span class="fu">unique</span>(lim<span class="sc">$</span>doy), </span>
<span id="cb32-64"><a href="#cb32-64" aria-hidden="true" tabindex="-1"></a>           <span class="fu">rep</span>(<span class="sc">-</span><span class="dv">50</span>, <span class="fu">length</span>(<span class="fu">unique</span>(lim<span class="sc">$</span>doy))), </span>
<span id="cb32-65"><a href="#cb32-65" aria-hidden="true" tabindex="-1"></a>           <span class="at">pch=</span><span class="dv">21</span>, <span class="at">bg=</span><span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">05</span>), <span class="at">xpd=</span>T)</span>
<span id="cb32-66"><a href="#cb32-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-67"><a href="#cb32-67" aria-hidden="true" tabindex="-1"></a>  })</span></code></pre></div>
<p><img src="intermediate_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<p>One of the things we have to be careful about with these graphs is
that they are models, and if we are missing data at critical time
periods, then our models are only as good as our data allow. This can be
seen in the plot above. There are some odd artifacts in these estimates
that can show up where we are missing data or when lake surface
elevation changes due to ice (in the case above) or drawdown. Likewise,
this is a composite across nearly 40 years so there are few gaps from
January through December, which is not usually the case. If we miss key
seasonal events like mixing in spring or fall, these graphs can provide
incorrect approximations of the real in-lake phenomena.</p>
<p>Have a go at these isopleths again, substituting DO or pH or looking
at just one year at a time. You should find that the only code that
needs to be changed is the variable used for <code>z</code> when you
create the <code>plotter</code> data above, and the title of the
plot.</p>
</div>

<!DOCTYPE html>

<br>

<hr>

<p style="color:gray; text-align:center">This work is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/legalcode">Creative Commons Attribution 4.0 International License</a>. Data are provided for educational purposes only unless otherwise noted.</p>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
