<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Intermediate R</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<!DOCTYPE html>
<head>
<!-- Favicon for various operating systems -->
<link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
<link rel="manifest" href="favicon/site.webmanifest">
<link rel="mask-icon" href="favicon/safari-pinned-tab.svg" color="#603cba">
<link rel="shortcut icon" href="favicon/favicon.ico">
<meta name="msapplication-TileColor" content="#603cba">
<meta name="msapplication-config" content="favicon/browserconfig.xml">
<meta name="theme-color" content="#382121">
</head>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code > span.dt { color: #204a87; } /* DataType */
code > span.dv { color: #0000cf; } /* DecVal */
code > span.bn { color: #0000cf; } /* BaseN */
code > span.fl { color: #0000cf; } /* Float */
code > span.ch { color: #4e9a06; } /* Char */
code > span.st { color: #4e9a06; } /* String */
code > span.co { color: #8f5902; font-style: italic; } /* Comment */
code > span.ot { color: #8f5902; } /* Other */
code > span.al { color: #ef2929; } /* Alert */
code > span.fu { color: #000000; } /* Function */
code > span.er { color: #a40000; font-weight: bold; } /* Error */
code > span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #000000; } /* SpecialChar */
code > span.vs { color: #4e9a06; } /* VerbatimString */
code > span.ss { color: #4e9a06; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #000000; } /* Variable */
code > span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code > span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code > span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code > span.ex { } /* Extension */
code > span.at { color: #c4a000; } /* Attribute */
code > span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code > span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R4NALMS</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="software.html">Software needs</a>
</li>
<li>
  <a href="morning.html">Morning session</a>
</li>
<li>
  <a href="afternoon.html">Afternoon session</a>
</li>
<li>
  <a href="instructors.html">Instructors</a>
</li>
<li>
  <a href="contact.html">Contact</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Intermediate R</h1>

</div>


<style>
pre code, pre, code {
  white-space: pre !important;
  overflow-x: scroll !important;
  word-break: keep-all !important;
  word-wrap: initial !important;
}

.column {
    float: left;
    padding: 15px;
}

.clearfix::after {
    content: "";
    clear: both;
    display: table;
}

.content {
    width: 75%;
}

</style>
<p><br></p>
<p><img src="images/roboshad.png" alt=""></p>
<p><br></p>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>Once we have a basic grasp on how R works, and how and where to find help, the learning process becomes a lot less painful, and we can start to build an appreciation for how convenient it is to have a script we can come back to again and again. To show off this convenience, and the power of R as a statistics program, we will spend the afternoon session walking through some applied analyses and spend a little more time with data visualization tools.</p>
<p>The plan for the afternoon is to introduce a subset of the Secchi Dip-In data to do a standard statistical analysis with individual data points from many lakes, and then switch back to data visualization tools to create some isopleths of physical parameters measured at multiple times and depths over time in a single lake using the Otsego Lake data from the morning session.</p>
<p><br></p>
</div>
<div id="data-overview-and-management" class="section level2">
<h2>Data overview and management</h2>
<p>Before we ever get into a statistical analysis, it is always good practice to have a good, long look at the data we are working with to make sure everything makes sense, and to note issues that may rear their heads down the road.</p>
<p>Let’s start by reading in the Secchi Dip-In data. This particular data set is a subset of the whole, and contains only those data that were collected in the state of Ohio.</p>
<p>We read the data in with the argument <code>stringsAsFactors = FALSE</code> because there are a lot of string variables in the data, and factors can add extra handling time to our workflow (see <a href="introductory.html"> morning session tutorial </a>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ohio &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;ohio.csv&#39;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><br></p>
<p>So, what are we working with here? Let’s have a look.</p>
<p>Remember from the morning session that it might be useful to understand how R sees your data first and foremost. The most reliable method for doing this with dataframes is to look at the <strong>structure</strong> of your data using <code>str</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Like this:</span>
<span class="kw">str</span>(ohio)</code></pre></div>
<p><img src="images/ohio.PNG" alt=""></p>
<p><br></p>
<p>Now that we have an idea of what the data set looks like, let’s take a little closer look. First, there are a couple of things that we can do that will clean up our code down the road a little bit. Let’s have a quick look at our column names again.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(ohio)</code></pre></div>
<pre><code>##  [1] &quot;Country&quot;                  &quot;Latitude&quot;                
##  [3] &quot;Longitude&quot;                &quot;Year&quot;                    
##  [5] &quot;Month&quot;                    &quot;Day&quot;                     
##  [7] &quot;Secchi..m.&quot;               &quot;NLA..&quot;                   
##  [9] &quot;State&quot;                    &quot;Water.Body&quot;              
## [11] &quot;County..Borough.Parrish.&quot; &quot;GNIS.ID&quot;                 
## [13] &quot;GNIS.Feature.Name&quot;        &quot;GNIS.Class&quot;              
## [15] &quot;GNIS.County&quot;              &quot;GNIS.Latitude&quot;           
## [17] &quot;GNIS.Longitude&quot;           &quot;GNIS.Elevation..m.&quot;</code></pre>
<p><br></p>
<p>Most of these are nice and clean, but there are some things that happen when we read data into R from Excel files. One of the things that R does is to replace all spaces and special characters with periods (<code>.</code>). This can make things a little difficult to read when we write code. For example, the column that said <code>Secchi (m)</code> in our Excel spreadsheet now says <code>Secchi..m.</code>. This confusion is compounded by the fact that some programming languages and R functions rely on the <code>.</code> for special purposes.</p>
<p>We are not going to replace all of the names, because we are not going to work with all of the columns, but let’s replace a couple of these that we are definitely going to use.</p>
<p>For now, let’s change the names for <code>Secchi..m.</code> and for <code>County..Borough.Parrish.</code>. Remember that the result of <code>names(ohio)</code> is a vector, and that we can replace individual elements of that vector. We just need to know the index of the element we wish to replace. In this case, <code>Secchi..m.</code> is the 7th column of the dataframe <code>ohio</code>, and <code>County..Borough.Parrish.</code> is the 11th.</p>
<p>Here is how it works:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># First, we replace Secchi..m. with Secchi</span>
<span class="kw">names</span>(ohio)[<span class="dv">7</span>] &lt;-<span class="st"> &quot;Secchi&quot;</span>

<span class="co"># Next, we replace County..Borough.Parrish.</span>
<span class="co"># with just County because we are working in a </span>
<span class="co"># single state in this case, not becuase we are</span>
<span class="co"># County-centric :)</span>
<span class="kw">names</span>(ohio)[<span class="dv">11</span>] &lt;-<span class="st"> &quot;County&quot;</span></code></pre></div>
<p><br></p>
<p>Of course, we could always do this in one fell swoop:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Replace names of both at once</span>
<span class="co"># because that is cooler than one</span>
<span class="co"># at a time.</span>
<span class="kw">names</span>(ohio)[<span class="kw">c</span>(<span class="dv">7</span>,<span class="dv">11</span>)] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;Secchi&#39;</span>, <span class="st">&#39;County&#39;</span>)</code></pre></div>
<p><br></p>
<p>Notice that above, we need to put indices inside of a call to <code>c</code> (the concatenate function) because otherwise R tries to interpret these as row and column indices and the program will return an error.</p>
<p><br></p>
</div>
<div id="data-exploration" class="section level2">
<h2>Data exploration</h2>
<p>Now that we have had a quick look at our data, and we have made some changes for the sake of convenience, let’s dig a little deeper.</p>
<p>For this afternoon, we are going to use <code>Secchi</code> as our <strong>response</strong>, or <strong>independent</strong> variable to demonstrate some basic statistical techniques in R. Before we can do any actual statistics, though, it is good practice to scrutinize the data we intend to use.</p>
<p>To start with, let’s take a quick look at Secchi depth using a histogram.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Make the histogram</span>
<span class="kw">hist</span>(ohio<span class="op">$</span>Secchi, 
     <span class="dt">col=</span><span class="st">&#39;gray87&#39;</span>,
     <span class="dt">yaxt=</span><span class="st">&#39;n&#39;</span>, <span class="dt">xaxt=</span><span class="st">&#39;n&#39;</span>,
     <span class="dt">xlab=</span><span class="st">&#39;Secchi depth (m)&#39;</span>,
     <span class="dt">main=</span><span class="st">&#39;&#39;</span>)
<span class="kw">axis</span>(<span class="dt">side=</span><span class="dv">1</span>, <span class="dt">pos=</span><span class="dv">0</span>)
<span class="kw">axis</span>(<span class="dt">side=</span><span class="dv">2</span>, <span class="dt">las=</span><span class="dv">2</span>, <span class="dt">pos=</span><span class="dv">0</span>)</code></pre></div>
<p><img src="intermediate_files/figure-html/unnamed-chunk-8-1.png" width="672" /> <br></p>
<p>From this plot alone, there are a few things that should be obvious.</p>
<p>First, we can see that the distribution of our response is <strong>right-skewed</strong>, with many more observations near zero than near the maximum.</p>
<p>Second, perhaps more nuanced, is that there are no values less than zero. For anyone who has spent some time using a Secchi disk, the reason for this is probably obvious. We can’t have negative values for light penetration into the water column<sup>[citation needed]</sup>. This variable is <strong>positive definitive</strong>. This is actually common for a lot of parameters we measure in lake management because we frequently are interested in concentrations, depths, areas, and other non-negative quantities.</p>
<p>We will need to think about both of these characteristics as we move into statistical analyses. One of the central assumptions of modern regression tools relates to normality of residuals, which in the absence of heterogenous groups, can initially be approximated using a histogram of the response. To show this, we can plot the residuals:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Make the histogram, this time</span>
<span class="co"># subtracting the mean from each </span>
<span class="co"># value. Is the result normal?</span>
<span class="kw">hist</span>(ohio<span class="op">$</span>Secchi<span class="op">-</span><span class="kw">mean</span>(ohio<span class="op">$</span>Secchi),
     <span class="dt">col=</span><span class="st">&#39;gray87&#39;</span>, 
     <span class="dt">yaxt=</span><span class="st">&#39;n&#39;</span>, <span class="dt">xaxt=</span><span class="st">&#39;n&#39;</span>,
     <span class="dt">xlab=</span><span class="st">&#39;Error&#39;</span>,
     <span class="dt">main=</span><span class="st">&#39;&#39;</span>)
<span class="kw">axis</span>(<span class="dt">side=</span><span class="dv">1</span>, <span class="dt">pos=</span><span class="dv">0</span>)
<span class="kw">axis</span>(<span class="dt">side=</span><span class="dv">2</span>, <span class="dt">las=</span><span class="dv">2</span>, <span class="dt">pos=</span><span class="op">-</span><span class="dv">1</span>)</code></pre></div>
<p><img src="intermediate_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p><br></p>
<p>This looks pretty much the same as the one above, but the x-axis has changed. We should know, at this point that the distribution above is decidedly <em>not</em> normal.</p>
<p><br></p>
</div>
<div id="transformations" class="section level2">
<h2>Transformations</h2>
<p>We can handle both of these problems by log-transforming our data like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ohio<span class="op">$</span>logSecchi &lt;-<span class="st"> </span><span class="kw">log</span>(ohio<span class="op">$</span>Secchi)</code></pre></div>
<p><br></p>
<p>We can plot histogram of the residuals again to see what it did:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Make the histogram,</span>
<span class="co"># subtracting the mean from each </span>
<span class="co"># value. Is the result normal?</span>
<span class="kw">hist</span>(ohio<span class="op">$</span>logSecchi<span class="op">-</span><span class="kw">mean</span>(ohio<span class="op">$</span>logSecchi),
     <span class="dt">col=</span><span class="st">&#39;gray87&#39;</span>, 
     <span class="dt">yaxt=</span><span class="st">&#39;n&#39;</span>, <span class="dt">xaxt=</span><span class="st">&#39;n&#39;</span>,
     <span class="dt">xlab=</span><span class="st">&#39;Error&#39;</span>,
     <span class="dt">main=</span><span class="st">&#39;&#39;</span>)
<span class="kw">axis</span>(<span class="dt">side=</span><span class="dv">1</span>, <span class="dt">pos=</span><span class="dv">0</span>)
<span class="kw">axis</span>(<span class="dt">side=</span><span class="dv">2</span>, <span class="dt">las=</span><span class="dv">2</span>, <span class="dt">pos=</span><span class="op">-</span><span class="fl">3.5</span>)</code></pre></div>
<p><img src="intermediate_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p><br></p>
<p>Clear to see here that our residuals look much more like a normal distribution now.</p>
<p><br></p>
<p>What has this done to our data, though? Let’s have a look:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Make the histogram.</span>
<span class="kw">hist</span>(ohio<span class="op">$</span>logSecchi<span class="op">-</span><span class="kw">mean</span>(ohio<span class="op">$</span>logSecchi),
     <span class="dt">col=</span><span class="st">&#39;gray87&#39;</span>, 
     <span class="dt">yaxt=</span><span class="st">&#39;n&#39;</span>, <span class="dt">xaxt=</span><span class="st">&#39;n&#39;</span>,
     <span class="dt">xlab=</span><span class="st">&#39;Error&#39;</span>,
     <span class="dt">main=</span><span class="st">&#39;&#39;</span>)
<span class="kw">axis</span>(<span class="dt">side=</span><span class="dv">1</span>, <span class="dt">pos=</span><span class="dv">0</span>)
<span class="kw">axis</span>(<span class="dt">side=</span><span class="dv">2</span>, <span class="dt">las=</span><span class="dv">2</span>, <span class="dt">pos=</span><span class="op">-</span><span class="fl">3.5</span>)</code></pre></div>
<p><img src="intermediate_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p><br></p>
<p>As you can see, our response variable is no longer constrained to be greater than zero on the log scale, so we don’t have to worry about how that influences normality in our residuals anymore, and we won’t get negative predictions from any of the statistical models that we make.</p>
<p>Now we can move forward with some statistics!</p>
<p><br></p>
</div>
<div id="introductory-statistics-in-r" class="section level2">
<h2>Introductory statistics in R</h2>
<p>Let’s start with the simple case of comparing <code>Secchi</code> between lakes and reservoirs. If you have a basic understanding of statistics, you might immediately realize that this is a comparison of a continuous variable between two groups. We have a couple of paths forward here. We could either set aside distributional assumpstions and use <strong>non-parametric</strong> methods, or we could assume some distribution for our error structure and proceed using <strong>parametric</strong> or <strong>semi-parametric</strong> statistics.</p>
<p>In either case, we are going to have to make sure we only have data for lakes and reservoirs first. (If you looked closely at the data you will have realized that there are also records for <code>Dam</code> in our dataset.)</p>
<p>To get rid of the observations related to <code>Dam</code> for now, let’s just drop that level from our <code>GNIS.Class</code> variable in the <code>ohio</code> data set.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ohioT &lt;-<span class="st"> </span>ohio[ohio<span class="op">$</span>GNIS.Class<span class="op">==</span><span class="st">&quot;Lake&quot;</span> <span class="op">|</span><span class="st"> </span>ohio<span class="op">$</span>GNIS.Class<span class="op">==</span><span class="st">&quot;Reservoir&quot;</span>, ]</code></pre></div>
<p><br></p>
<div id="wilcoxon-rank-sums-test" class="section level3">
<h3>Wilcoxon rank-sums test</h3>
<p>Let’s start by</p>
</div>
</div>

<!DOCTYPE html>
<p>Copyright &copy; 2018 Dan Stich. All rights reserved.</p>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
